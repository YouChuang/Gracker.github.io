<!doctype html>
<html class="theme-next use-motion theme-next-next">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>




  <link rel="stylesheet" type="text/css" href="vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="css/main.css?v=0.4.0"/>





    <meta name="keywords" content="Android,Performance" />



    <link rel="alternate" href="atom.xml" title="Android Perofrmance" type="application/atom+xml" />



    <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.0" />




  <title> Android Perofrmance </title>
</head>

<body>
  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Android Perofrmance</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首页
        </a>
      </li>
    
      
      <li class="menu-item menu-item-categories">
        <a href="/categories">
          <i class="menu-item-icon icon-categories"></i> <br />
          分类
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          归档
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          标签
        </a>
      </li>
    
      
      <li class="menu-item menu-item-about">
        <a href="/about">
          <i class="menu-item-icon icon-about"></i> <br />
          关于
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
            
          

          <div id="posts" class="posts-expand">
            
  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2015/03/15/android-tips-round-up-5/">
                [译]Android小技巧(5)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-03-14
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/Android/">Android</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/03/15/android-tips-round-up-5/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/03/15/android-tips-round-up-5/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="前言">前言</h2><p>本文是一篇译文,这篇是这个系列的第五篇.讲述的是Android开发中遇到的一些好用的小技巧,或者一些实用的API,很多人都知道,但也有人不知道,记录下来,如果能帮助到大家,也是极好的.由于不是严格的博文,所以翻译也不那么严格,有些工具和类我也会经常用,所以我会根据自己的想法去写.有些地方坐在并没有将这个工具的作用讲出来,我会补充上去.</p>
<h2 id="正文">正文</h2><p><a href="https://developer.android.com/reference/android/support/v4/widget/ViewDragHelper.html" target="_blank" rel="external">ViewDragHelper</a> ——视图拖动是一个比较复杂的问题。这个类可以帮助解决不少问题。如果你需要一个例子，<a href="https://developer.android.com/reference/android/support/v4/widget/DrawerLayout.html" target="_blank" rel="external">DrawerLayout</a>就是利用它实现扫滑。Flavient Laurent 还写了一些关于这方面的<a href="http://flavienlaurent.com/blog/2013/08/28/each-navigation-drawer-hides-a-viewdraghelper/" target="_blank" rel="external">优秀文章</a>。</p>
<p><a href="https://developer.android.com/reference/android/widget/PopupWindow.html" target="_blank" rel="external">PopupWindow</a>——Android到处都在使用PopupWindow ，甚至你都没有意识到（标题导航条ActionBar，自动补全AutoComplete，编辑框错误提醒Edittext Errors）。这个类是创建浮层内容的主要方法。</p>
<p><a href="https://developer.android.com/reference/android/app/ActionBar.htmlgetThemedContext%28%29" target="_blank" rel="external">Actionbar.getThemrContext()</a>——导航栏的主题化是很复杂的（不同于Activity其他部分的主题化）。你可以得到一个上下文（Context），用这个上下文创建的自定义组件可以得到正确的主题。</p>
<p><a href="https://developer.android.com/reference/android/media/ThumbnailUtils.html" target="_blank" rel="external">ThumbnailUtils</a>——帮助创建缩略图。通常我都是用现有的图片加载库（比如，Picasso 或者 Volley），不过这个ThumbnaiUtils可以创建视频缩略图。<strong>译者注：</strong>该API从V8才开始支持。</p>
<p><a href="https://developer.android.com/reference/android/content/Context.htmlgetExternalFilesDir%28java.lang.String%29" target="_blank" rel="external">Context.getExternalFilesDir()</a>———— 申请了SD卡写权限后，你可以在SD的任何地方写数据，把你的数据写在设计好的合适位置会更加有礼貌。这样数据可以及时被清理，也会有更好的用户体验。此外，Android 4.0 Kitkat中在这个文件夹下写数据是不需要权限的，每个用户有自己的独立的数据存储路径。<strong>译者注：</strong>该API从V8才开始支持。</p>
<p><a href="https://developer.android.com/reference/android/util/SparseArray.html" target="_blank" rel="external">SparseArray</a>——Map的高效优化版本。推荐了解姐妹类SparseBooleanArray、SparseIntArray和SparseLongArray。</p>
<p><a href="https://developer.android.com/reference/android/content/pm/PackageManager.htmlsetComponentEnabledSetting%28android.content.ComponentName,%20int,%20int%29" target="_blank" rel="external">PackageManager.setComponentEnabledSetting()</a>——可以用来启动或者禁用程序清单中的组件。对于关闭不需要的功能组件是非常赞的，比如关掉一个当前不用的广播接收器。</p>
<p><a href="https://developer.android.com/reference/android/database/sqlite/SQLiteDatabase.htmlyieldIfContendedSafely%28%29" target="_blank" rel="external">SQLiteDatabase.yieldIfContendedSafely()</a>——让你暂时停止一个数据库事务， 这样你可以就不会占用太多的系统资源。</p>
<p><a href="https://developer.android.com/reference/android/os/Environment.html#getExternalStoragePublicDirectory%28java.lang.String%29" target="_blank" rel="external">Environment.getExternalStoragePublicDirectory()</a>——还是那句话，用户期望在SD卡上得到统一的用户体验。用这个方法可以获得在用户设备上放置指定类型文件（音乐、图片等）的正确目录。</p>
<p><a href="https://developer.android.com/reference/android/view/View.htmlgenerateViewId%28%29" target="_blank" rel="external">View.generateViewId()</a>——每次我都想要推荐动态生成控件的ID。需要注意的是，不要和已经存在的控件ID或者其他已经生成的控件ID重复。</p>
<p><a href="https://developer.android.com/reference/android/app/ActivityManager.htmlclearApplicationUserData%28%29" target="_blank" rel="external">ActivityManager.clearApplicationUserData()</a>—— 一键清理你的app产生的用户数据，可能是做用户退出登录功能，有史以来最简单的方式了。</p>
<p><a href="http://developer.android.com/reference/android/content/Context.htmlcreateConfigurationContext%28android.%E2%80%94%E2%80%94ontent.res.Configuration%29" target="_blank" rel="external">Context.createConfigurationContext()</a> ——自定义你的配置环境信息。我通常会遇到这样的问题：强制让一部分显示在某个特定的环境下（倒不是我一直这样瞎整，说来话长，你很难理解）。用这个实现起来可以稍微简单一点。</p>
<p><a href="http://developer.android.com/reference/android/app/ActivityOptions.html" target="_blank" rel="external">ActivityOptions</a> ——方便的定义两个Activity切换的动画。 使用<a href="http://developer.android.com/reference/android/support/v4/app/ActivityOptionsCompat.html" target="_blank" rel="external">ActivityOptionsCompat</a> 可以很好解决旧版本的兼容问题。</p>
<p><a href="http://developer.android.com/reference/android/widget/AdapterViewFlipper.htmlfyiWillBeAdvancedByHostKThx%28%29" target="_blank" rel="external">AdapterViewFlipper.fyiWillBeAdvancedByHostKThx()</a>——仅仅因为很好玩，没有其他原因。在整个安卓开源项目中（AOSP the Android ——pen Source Project Android开放源代码项目）中还有其他很有意思的东西（比如<br><a href="http://developer.android.com/reference/android/hardware/SensorManager.htmlGRAVITY_DEATH_STAR_I" target="_blank" rel="external">GRAVITY_DEATH_STAR_I</a>）。不过，都不像这个这样，这个确实有用</p>
<p><a href="http://developer.android.com/reference/android/view/ViewParent.htmlrequestDisallowInterceptTouchEvent%28boolean%29" target="_blank" rel="external">ViewParent.requestDisallowInterceptTouchEvent()</a> ——Android系统触摸事件机制大多时候能够默认处理，不过有时候你需要使用这个方法来剥夺父级控件的控制权（顺便说一下，如果你想对Android触摸机制了解更多，<a href="https://www.youtube.com/watch?v=EZAoJU-nUyI" target="_blank" rel="external">这个演讲</a>会令你惊叹不已。）</p>
<h2 id="备忘">备忘</h2><p>More: <a href="http://www.androidperformance.com/android-tips-round-up.html" target="_blank" rel="external">Part1</a> , <a href="http://www.androidperformance.com/android-tips-round-up-2.html" target="_blank" rel="external">Part2</a> , <a href="http://www.androidperformance.com/android-tips-round-up-3.html" target="_blank" rel="external">Part3</a> , <a href="http://www.androidperformance.com/android-tips-round-up-4.html" target="_blank" rel="external">Part4</a>, <a href="http://www.androidperformance.com/android-tips-round-up-5.html" target="_blank" rel="external">Part5</a><br>原文地址:<a href="http://blog.danlew.net/2014/03/30/android-tips-round-up-part-5/" target="_blank" rel="external">http://blog.danlew.net/2014/03/30/android-tips-round-up-part-5/</a><br>原文作者:<a href="http://blog.danlew.net/about/" target="_blank" rel="external">http://blog.danlew.net/about/</a><br>本文地址:<a href="http://www.androidperformance.com/android-tips-round-up-5.html" target="_blank" rel="external">http://www.androidperformance.com/android-tips-round-up-5.html</a> 转载请注明.</p>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2015/03/15/android-tips-round-up-4/">
                [译]Android小技巧(4)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-03-14
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/Android/">Android</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/03/15/android-tips-round-up-4/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/03/15/android-tips-round-up-4/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="前言">前言</h2><p>本文是一篇译文,这篇是这个系列的第四篇.讲述的是Android开发中遇到的一些好用的小技巧,或者一些实用的API,很多人都知道,但也有人不知道,记录下来,如果能帮助到大家,也是极好的.由于不是严格的博文,所以翻译也不那么严格,有些工具和类我也会经常用,所以我会根据自己的想法去写.有些地方坐在并没有将这个工具的作用讲出来,我会补充上去.</p>
<h2 id="正文">正文</h2><p><a href="http://developer.android.com/reference/android/app/Activity.html#isChangingConfigurations%28%29" target="_blank" rel="external">Activity.isChangingConfigurations ()</a>——如果在 Activity 中 configuration 会经常改变的话，使用这个方法就可以不用手动做保存状态的工作了。</p>
<p><a href="http://developer.android.com/reference/android/content/SearchRecentSuggestionsProvider.html" target="_blank" rel="external">SearchRecentSuggestionsProvider</a>——可以创建最近提示效果的 provider，是一个简单快速的方法。</p>
<p><a href="http://developer.android.com/reference/android/view/ViewTreeObserver.html" target="_blank" rel="external">ViewTreeObserver</a>——这是一个很棒的工具。可以进入到 VIew 里面，并监控 View 结构的各种状态，通常我都用来做 View 的测量操作（自定义视图中经常用到）。</p>
<p><a href="https://www.timroes.de/2013/09/12/speed-up-gradle/" target="_blank" rel="external">org.gradle.daemon=true</a>——这句话可以帮助减少 Gradle 构建的时间，仅在命令行编译的时候用到，因为 Android Studio 已经这样使用了。</p>
<p><a href="http://developer.android.com/reference/android/database/DatabaseUtils.html" target="_blank" rel="external">DatabaseUtils</a>——一个包含各种数据库操作的使用工具。</p>
<p><a href="http://developer.android.com/reference/android/widget/LinearLayout.html#attr_android:weightSum" target="_blank" rel="external">android:weightSum (LinearLayout)</a>——如果想使用 layout weights，但是却不想填充整个 LinearLayout 的话，就可以用 weightSum 来定义总的 weight 大小。</p>
<p><a href="http://developer.android.com/reference/android/view/View.html#attr_android:duplicateParentState" target="_blank" rel="external">android:duplicateParentState (View)</a>——此方法可以使得子 View 可以复制父 View 的状态。比如如果一个 ViewGroup 是可点击的，那么可以用这个方法在它被点击的时候让它的子 View 都改变状态。</p>
<p><a href="http://developer.android.com/reference/android/view/ViewGroup.html#attr_android:clipChildren" target="_blank" rel="external">android:clipChildren (ViewGroup)</a>——如果此属性设置为不可用，那么 ViewGroup 的子 View 在绘制的时候会超出它的范围，在做动画的时候需要用到。</p>
<p><a href="http://developer.android.com/reference/android/widget/ScrollView.html#attr_android:fillViewport" target="_blank" rel="external">android:fillViewport (ScrollView)</a>——在这片文章中有详细介绍<a href="http://www.curious-creature.org/2010/08/15/scrollviews-handy-trick/" target="_blank" rel="external">文章链接</a>，可以解决在 ScrollView 中当内容不足的时候填不满屏幕的问题。</p>
<p><a href="http://developer.android.com/guide/topics/resources/drawable-resource.html#Bitmap" target="_blank" rel="external">android:tileMode (BitmapDrawable)</a>——可以指定图片使用重复填充的模式。</p>
<p><a href="http://developer.android.com/reference/android/R.attr.html#exitFadeDuration" target="_blank" rel="external">android:enterFadeDuration/android:exitFadeDuration (Drawables)</a>——此属性在 Drawable 具有多种状态的时候，可以定义它展示前的淡入淡出效果。</p>
<p><a href="http://developer.android.com/reference/android/widget/ImageView.html#attr_android:scaleType" target="_blank" rel="external">android:scaleType (ImageView)</a>——定义在 ImageView 中怎么缩放/剪裁图片，一般用的比较多的是“centerCrop”和“centerInside”。</p>
<p><a href="http://developer.android.com/training/improving-layouts/reusing-layouts.html#Merge" target="_blank" rel="external">Merge</a>——此标签可以在另一个布局文件中包含别的布局文件，而不用再新建一个 ViewGroup，对于自定义 ViewGroup 的时候也需要用到；可以通过载入一个带有标签的布局文件来自动定义它的子部件。</p>
<p><a href="http://developer.android.com/reference/android/util/AtomicFile.html" target="_blank" rel="external">AtomicFile</a>——通过使用备份文件进行文件的原子化操作。这个知识点之前我也写过，不过最好还是有出一个官方的版本比较好。</p>
<h2 id="备忘">备忘</h2><p>More: <a href="http://www.androidperformance.com/android-tips-round-up.html" target="_blank" rel="external">Part1</a> , <a href="http://www.androidperformance.com/android-tips-round-up-2.html" target="_blank" rel="external">Part2</a> , <a href="http://www.androidperformance.com/android-tips-round-up-3.html" target="_blank" rel="external">Part3</a> , <a href="http://www.androidperformance.com/android-tips-round-up-4.html" target="_blank" rel="external">Part4</a>, <a href="http://www.androidperformance.com/android-tips-round-up-5.html" target="_blank" rel="external">Part5</a><br>原文地址:<a href="http://blog.danlew.net/2014/03/30/android-tips-round-up-part-4/" target="_blank" rel="external">http://blog.danlew.net/2014/03/30/android-tips-round-up-part-4/</a><br>原文作者:<a href="http://blog.danlew.net/about/" target="_blank" rel="external">http://blog.danlew.net/about/</a><br>本文地址:<a href="http://www.androidperformance.com/android-tips-round-up-4.html" target="_blank" rel="external">http://www.androidperformance.com/android-tips-round-up-4.html</a> 转载请注明.</p>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2015/03/15/android-tips-round-up-3/">
                [译]Android小技巧(3)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-03-14
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/Android/">Android</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/03/15/android-tips-round-up-3/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/03/15/android-tips-round-up-3/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="前言">前言</h2><p>本文是一篇译文,这篇是这个系列的第三篇.讲述的是Android开发中遇到的一些好用的小技巧,或者一些实用的API,很多人都知道,但也有人不知道,记录下来,如果能帮助到大家,也是极好的.由于不是严格的博文,所以翻译也不那么严格,有些工具和类我也会经常用,所以我会根据自己的想法去写.有些地方坐在并没有将这个工具的作用讲出来,我会补充上去.</p>
<h2 id="正文">正文</h2><p><a href="http://developer.android.com/reference/android/net/UrlQuerySanitizer.html" target="_blank" rel="external">UrlQuerySanitizer</a>——使用这个工具可以方便对 URL 进行检查。</p>
<p><a href="http://developer.android.com/reference/android/app/Fragment.html#setArguments%28android.os.Bundle%29" target="_blank" rel="external">Fragment.setArguments</a>——因为在构建 Fragment 的时候不能加参数，所以这是个很好的东西，可以在创建 Fragment 之前设置参数（即使在 configuration 改变的时候仍然会导致销毁/重建）。</p>
<p><a href="http://developer.android.com/reference/android/app/DialogFragment.html#setShowsDialog%28boolean%29" target="_blank" rel="external">DialogFragment.setShowsDialog ()</a>—— 这是一个很巧妙的方式，DialogFragment 可以作为正常的 Fragment 显示！这里可以让 Fragment 承担双重任务。我通常在创建 Fragment 的时候把 onCreateView ()和 onCreateDialog ()都加上，就可以创建一个具有双重目的的 Fragment。</p>
<p><a href="http://developer.android.com/reference/android/app/FragmentManager.html#enableDebugLogging%28boolean%29" target="_blank" rel="external">FragmentManager.enableDebugLogging ()</a>——在需要观察 Fragment 状态的时候会有帮助。</p>
<p><a href="http://developer.android.com/reference/android/support/v4/content/LocalBroadcastManager.html" target="_blank" rel="external">LocalBroadcastManager</a>——这个会比全局的 broadcast 更加安全，简单，快速。像 <a href="http://square.github.io/otto/" target="_blank" rel="external">otto</a> 这样的 Event buses 机制对你的应用场景更加有用。</p>
<p><a href="http://developer.android.com/reference/android/telephony/PhoneNumberUtils.html#formatNumber%28java.lang.String%29" target="_blank" rel="external">PhoneNumberUtils.formatNumber ()</a>——顾名思义，这是对数字进行格式化操作的时候用的。</p>
<p><a href="http://developer.android.com/reference/android/graphics/Region.html#op%28android.graphics.Region,%20android.graphics.Region,%20android.graphics.Region.Op%29" target="_blank" rel="external">Region.op()</a>——我发现在对比两个渲染之前的区域的时候很实用，如果你有两条路径，那么怎么知道它们是不是会重叠呢？使用这个方法就可以做到。</p>
<p><a href="http://developer.android.com/reference/android/app/Application.html#registerActivityLifecycleCallbacks%28android.app.Application.ActivityLifecycleCallbacks%29" target="_blank" rel="external">Application.registerActivityLifecycleCallbacks</a>——虽然缺少官方文档解释，不过我想它就是注册 Activity 的生命周期的一些回调方法（顾名思义），就是一个方便的工具。</p>
<p><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Types" target="_blank" rel="external">versionNameSuffix</a>——这个 gradle 设置可以让你在基于不同构建类型的 manifest 中修改版本名这个属性，例如，如果需要在在 debug 版本中以”-SNAPSHOT”结尾，那么就可以轻松的看出当前是 debug 版还是 release 版。</p>
<p><a href="http://developer.android.com/reference/android/database/CursorJoiner.html" target="_blank" rel="external">CursorJoiner</a>——如果你是只使用一个数据库的话，使用 SQL 中的 join 就可以了，但是如果收到的数据是来自两个独立的 ContentProvider，那么 CursorJoiner 就很实用了。</p>
<p><a href="http://www.genymotion.com/" target="_blank" rel="external">Genymotion</a>——一个非常快的 Android 模拟器，本人一直在用。</p>
<p><a href="http://developer.android.com/guide/practices/screens_support.html#qualifiers" target="_blank" rel="external">-nodpi</a>——在没有特别定义的情况下，很多修饰符(-mdpi,-hdpi,-xdpi等等)都会默认自动缩放 assets/dimensions，有时候我们需要保持显示一致，这种情况下就可以使用 -nodpi。</p>
<p><a href="http://developer.android.com/reference/android/content/BroadcastReceiver.html#setDebugUnregister%28boolean%29" target="_blank" rel="external">BroadcastRecevier.setDebugUnregister ()</a>——又一个方便的调试工具。</p>
<p><a href="http://developer.android.com/reference/android/app/Activity.html#recreate%28%29" target="_blank" rel="external">Activity.recreate ()</a>——强制让 Activity 重建。</p>
<p><a href="http://developer.android.com/reference/android/content/pm/PackageManager.html#checkSignatures%28java.lang.String,%20java.lang.String%29" target="_blank" rel="external">PackageManager.checkSignatures ()</a>——如果同时安装了两个 app 的话，可以用这个方法检查。如果不进行签名检查的话，其他人可以轻易通过使用一样的包名来模仿你的 app。</p>
<h2 id="备忘">备忘</h2><p>More: <a href="http://www.androidperformance.com/android-tips-round-up.html" target="_blank" rel="external">Part1</a> , <a href="http://www.androidperformance.com/android-tips-round-up-2.html" target="_blank" rel="external">Part2</a> , <a href="http://www.androidperformance.com/android-tips-round-up-3.html" target="_blank" rel="external">Part3</a> , <a href="http://www.androidperformance.com/android-tips-round-up-4.html" target="_blank" rel="external">Part4</a>, <a href="http://www.androidperformance.com/android-tips-round-up-5.html" target="_blank" rel="external">Part5</a><br>原文地址:<a href="http://blog.danlew.net/2014/03/30/android-tips-round-up-part-3/" target="_blank" rel="external">http://blog.danlew.net/2014/03/30/android-tips-round-up-part-3/</a><br>原文作者:<a href="http://blog.danlew.net/about/" target="_blank" rel="external">http://blog.danlew.net/about/</a><br>本文地址:<a href="http://www.androidperformance.com/android-tips-round-up-3.html" target="_blank" rel="external">http://www.androidperformance.com/android-tips-round-up-3.html</a> 转载请注明.</p>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2015/02/04/build-rom-for-nexus5/">
                为Nexus5编译AndroidL固件
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-02-04
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/Android/">Android</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/02/04/build-rom-for-nexus5/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/04/build-rom-for-nexus5/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <p>接前一篇文章<a href="http://www.androidperformance.com/view-android-source-code-with-androidstudio.html" target="_blank" rel="external">使用Android Studio查看Android Lollipop源码</a>, 我们知道,仅仅看代码,提高是比较有限的,而且理解起来也比较肤浅,往往过目就忘. 而自己写过的代码,往往会印象比较深刻,在写的时候也会比较容易理解流程. 所以我们在看代码的同时, 如果能修改代码, 在手机上跑起来并看到修改的效果,这无疑会加快看代码的效率和积极性. 所以这篇文章,就讲解一下如何自己编译AndroidL的源码,并且在Nexus5上跑起来. 至于为何需要自己编译固件,而不是直接安装Google给出的工厂固件?原因是Google给出的工厂固件是User版本,是没法随心所欲Push东西进去的. 所以我们需要编译自己的Userdebug版本.</p>
<p>本文假设你已经下载了AndroidL的源码,并且有一台Nexus5手机(手机系统开发人员必备), 如果你还没有AndroidL的源码,或者你有源码但是没有配置编译的环境,那么 <a href="https://source.android.com/source/initializing.html" target="_blank" rel="external">Initializing a Build Environment</a> 和<a href="https://source.android.com/source/downloading.html" target="_blank" rel="external">Downloading the Source</a>这两篇文章你应该先去看一下(我又一次假设你会翻墙,如果你不会翻墙,那么下代码也是一个痛苦的事情). 这后面的教程Google官网也有教程.所以我只针对Nexus5进行讲解.</p>
<p>另外你需要知道AOSP,AOSP即Android Open Source Project 汉语意思是：谷歌开放源代码项目.我们通过Google官方下载的源代码,就是AOSP的代码, 其中是不包含Google开发的那些个应用的,各个厂商拿到的也是这个版本,在这个版本的基础上进行修改. 而Google发布的工厂固件则是包含全套Google服务的. 厂商如果想安装Google服务,就需要过Google的那一套认证,比较麻烦,而且价格不菲,鉴于Google在国内的尴尬地位,国内很多厂商都没有过这个认证.</p>
<h3 id="1-_初始化编译环境">1. 初始化编译环境</h3><pre class="lang:java decode:true "> . build/envsetup.sh</pre>

<h3 id=""> </h3><h3 id="2-_加载机型">2. 加载机型</h3><pre class="lang:java decode:true ">lunch</pre>

<h3 id="-1"> </h3><h3 id="3-_选择要编译的机器">3. 选择要编译的机器</h3><pre class="lang:java decode:true">You're building on Linux

Lunch menu... pick a combo:
     1\. aosp_arm-eng
     2\. aosp_arm64-eng
     3\. aosp_mips-eng
     4\. aosp_mips64-eng
     5\. aosp_x86-eng
     6\. aosp_x86_64-eng
     7\. aosp_shamu-userdebug
     8\. aosp_manta-userdebug
     9\. full_fugu-userdebug
     10\. aosp_fugu-userdebug
     11\. aosp_grouper-userdebug
     12\. aosp_tilapia-userdebug
     13\. aosp_deb-userdebug
     14\. aosp_flo-userdebug
     15\. aosp_mako-userdebug
     16\. aosp_hammerhead-userdebug
     17\. aosp_flounder-userdebug
     18\. mini_emulator_x86_64-userdebug
     19\. mini_emulator_arm-userdebug
     20\. mini_emulator_x86-userdebug
     21\. mini_emulator_mips-userdebug
     22\. mini_emulator_arm64-userdebug</pre>

<h4 id="3-1_机型对照表">3.1 机型对照表</h4><table>
<thead>
<tr>
<th>DEVICE</th>
<th>CODE NAME</th>
<th>BUILD CONFIGURATION</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nexus 6</td>
<td>shamu</td>
<td>aosp_shamu-userdebug</td>
</tr>
<tr>
<td>Nexus Player</td>
<td>fugu</td>
<td>aosp_fugu-userdebug</td>
</tr>
<tr>
<td>Nexus 9</td>
<td>volantis (flounder)</td>
<td>aosp_flounder-userdebug</td>
</tr>
<tr>
<td>Nexus 5 (GSM/LTE)</td>
<td>hammerhead</td>
<td>aosp_hammerhead-userdebug</td>
</tr>
<tr>
<td>Nexus 7 (Wi-Fi)</td>
<td>razor (flo)</td>
<td>aosp_flo-userdebug</td>
</tr>
<tr>
<td>Nexus 7 (Mobile)</td>
<td>razorg (deb)</td>
<td>aosp_deb-userdebug</td>
</tr>
<tr>
<td>Nexus 10</td>
<td>mantaray (manta)</td>
<td>full_manta-userdebug</td>
</tr>
<tr>
<td>Nexus 4</td>
<td>occam (mako)</td>
<td>full_mako-userdebug</td>
</tr>
<tr>
<td>Nexus 7 (Wi-Fi)</td>
<td>nakasi (grouper)</td>
<td>full_grouper-userdebug</td>
</tr>
<tr>
<td>Nexus 7 (Mobile)</td>
<td>nakasig (tilapia)</td>
<td>full_tilapia-userdebug</td>
</tr>
<tr>
<td>Galaxy Nexus (GSM/HSPA+)</td>
<td>yakju (maguro)</td>
<td>full_maguro-userdebug</td>
</tr>
<tr>
<td>Galaxy Nexus (Verizon)</td>
<td>mysid (toro)</td>
<td>aosp_toro-userdebug</td>
</tr>
<tr>
<td>Galaxy Nexus (Experimental)</td>
<td>mysidspr (toroplus)</td>
<td>aosp_toroplus-userdebug</td>
</tr>
<tr>
<td>PandaBoard (Archived)</td>
<td>panda</td>
<td>aosp_panda-userdebug</td>
</tr>
<tr>
<td>Motorola Xoom (U.S. Wi-Fi)</td>
<td>wingray</td>
<td>full_wingray-userdebug</td>
</tr>
<tr>
<td>Nexus S</td>
<td>soju (crespo)</td>
<td>full_crespo-userdebug</td>
</tr>
<tr>
<td>Nexus S 4G</td>
<td>sojus (crespo4g)</td>
<td>full_crespo4g-userdebug3.2</td>
</tr>
</tbody>
</table>
<h4 id="3-2_三个版本说明版本">3.2 三个版本说明版本</h4><table>
<thead>
<tr>
<th>BUILDTYPE</th>
<th>USE</th>
</tr>
</thead>
<tbody>
<tr>
<td>user</td>
<td>limited access; suited for production</td>
</tr>
<tr>
<td>userdebug</td>
<td>like “user” but with root access and debuggability; preferred for debugging</td>
</tr>
<tr>
<td>eng</td>
<td>development configuration with additional debugging tools</td>
</tr>
</tbody>
</table>
<p>选择aosp_hammerhead-userdebug之后,会有下面的确认信息:</p>
<pre class="lang:java decode:true ">============================================
PLATFORM_VERSION_CODENAME=REL
PLATFORM_VERSION=5.0.50.50.50.50
TARGET_PRODUCT=aosp_hammerhead
TARGET_BUILD_VARIANT=userdebug
TARGET_BUILD_TYPE=release
TARGET_BUILD_APPS=
TARGET_ARCH=arm
TARGET_ARCH_VARIANT=armv7-a-neon
TARGET_CPU_VARIANT=krait
TARGET_2ND_ARCH=
TARGET_2ND_ARCH_VARIANT=
TARGET_2ND_CPU_VARIANT=
HOST_ARCH=x86_64
HOST_OS=linux
HOST_OS_EXTRA=Linux-3.13.0-37-generic-x86_64-with-Ubuntu-14.10-utopic
HOST_BUILD_TYPE=release
BUILD_ID=AOSP
OUT_DIR=out
============================================</pre>

<h3 id="4-_生成驱动目录">4. 生成驱动目录</h3><p>接下来需要在<a href="https://developers.google.com/android/nexus/drivers#hammerheadlrx22c" target="_blank" rel="external">Android官网</a>下载 Nexus5所需要的驱动:</p>
<table>
<thead>
<tr>
<th>HARDWARE COMPONENT</th>
<th>COMPANY</th>
<th>DOWNLOAD</th>
<th>MD5 CHECKSUM</th>
<th>SHA-1 CHECKSUM</th>
</tr>
</thead>
<tbody>
<tr>
<td>NFC, Bluetooth, Wi-Fi</td>
<td>Broadcom</td>
<td><a href="https://dl.google.com/dl/android/aosp/broadcom-hammerhead-lrx22c-964d941e.tgz" target="_blank" rel="external">Link</a></td>
<td>2c398994e37093df51b105d63f0eb611</td>
<td>991346159c95ae75f760014a6822b8b3e8667700</td>
</tr>
<tr>
<td>Camera, Sensors, Audio</td>
<td>LG</td>
<td><a href="https://dl.google.com/dl/android/aosp/lge-hammerhead-lrx22c-95a9d465.tgz" target="_blank" rel="external">Link</a></td>
<td>74cf8235e6bb04da28b2ff738b13eee9</td>
<td>175dd5bae81bb54030d072cb0f0b4ec81eb3f71f</td>
</tr>
<tr>
<td>Graphics, GSM, Camera, GPS, Sensors, Media, DSP, USB</td>
<td>Qualcomm</td>
<td><a href="https://dl.google.com/dl/android/aosp/lge-hammerhead-lrx22c-95a9d465.tgz" target="_blank" rel="external">Link</a></td>
<td>0a43395e175d3de3dc312d8abdcb4f20</td>
<td>007cf9d49f0409d5c703e7f2811fd153fee22353</td>
</tr>
</tbody>
</table>
<p>下载完成后,解压出来是三个.sh文件,放到Android源码目录下面,然后执行.会将相关驱动放到vender目录下面.</p>
<h3 id="5-_执行编译命令">5. 执行编译命令</h3><pre class="lang:java decode:true">make -j8</pre>
如果没有出错的话,在经过漫长的时间之后,编译成功:
<pre class="lang:java decode:true " title="编译成功">Installed file list: out/target/product/hammerhead/installed-files.txt
Target system fs image: out/target/product/hammerhead/obj/PACKAGING/systemimage_intermediates/system.img
Running:  mkuserimg.sh -s out/target/product/hammerhead/system out/target/product/hammerhead/obj/PACKAGING/systemimage_intermediates/system.img ext4 system 1073741824 -L system out/target/product/hammerhead/root/file_contexts
make_ext4fs -s -T -1 -S out/target/product/hammerhead/root/file_contexts -L system -l 1073741824 -a system out/target/product/hammerhead/obj/PACKAGING/systemimage_intermediates/system.img out/target/product/hammerhead/system
Creating filesystem with parameters:
    Size: 1073741824
    Block size: 4096
    Blocks per group: 32768
    Inodes per group: 8192
    Inode size: 256
    Journal blocks: 4096
    Label: system
    Blocks: 262144
    Block groups: 8
    Reserved block group size: 63
Created filesystem with 1445/65536 inodes and 85879/262144 blocks
Install system fs image: out/target/product/hammerhead/system.img
out/target/product/hammerhead/system.img+out/target/product/hammerhead/obj/PACKAGING/recovery_patch_intermediates/recovery_from_boot.p maxsize=1096212480 blocksize=135168 total=336629666 reserve=11083776
</pre>

<h3 id="-2"> </h3><h3 id="6-_刷机命令">6. 刷机命令</h3><p>Nexus5关机状态下,长按音量下+电源,即可进入recovery模式, 然后在源码根目录下执行下面命令:</p>
<pre class="lang:java decode:true">fastboot -w flashall</pre>
刷机成功后会自动重启
<pre class="lang:java decode:true">~/Android-SourceCode fastboot -w flashall
target reported max download size of 1073741824 bytes
Creating filesystem with parameters:
    Size: 13725835264
    Block size: 4096
    Blocks per group: 32768
    Inodes per group: 8144
    Inode size: 256
    Journal blocks: 32768
    Label: 
    Blocks: 3351034
    Block groups: 103
    Reserved block group size: 823
Created filesystem with 11/838832 inodes and 93654/3351034 blocks
Creating filesystem with parameters:
    Size: 734003200
    Block size: 4096
    Blocks per group: 32768
    Inodes per group: 7472
    Inode size: 256
    Journal blocks: 2800
    Label: 
    Blocks: 179200
    Block groups: 6
    Reserved block group size: 47
Created filesystem with 11/44832 inodes and 5813/179200 blocks
--------------------------------------------
Bootloader Version...: HHZ12d
Baseband Version.....: M8974A-2.0.50.2.22
Serial Number........: 08ade1a513dc087b
--------------------------------------------
checking product...
OKAY [  0.100s]
sending 'boot' (8950 KB)...
OKAY [  0.500s]
writing 'boot'...
OKAY [  0.784s]
sending 'recovery' (9672 KB)...
OKAY [  0.556s]
writing 'recovery'...
OKAY [  0.814s]
erasing 'system'...
OKAY [  1.166s]
sending 'system' (328187 KB)...
OKAY [ 10.501s]
writing 'system'...
OKAY [ 23.623s]
erasing 'userdata'...
OKAY [ 14.657s]
sending 'userdata' (137318 KB)...
OKAY [  4.520s]
writing 'userdata'...
OKAY [  9.776s]
erasing 'cache'...
OKAY [  0.618s]
sending 'cache' (13348 KB)...
OKAY [  0.630s]
writing 'cache'...
OKAY [  1.070s]
rebooting...

finished. total time: 70.095s
</pre>

<h3 id="7-_秀桌面">7. 秀桌面</h3><h3 id="-3"> </h3><h3 id="-4"><img src="http://www.androidperformance.com/wp-content/uploads/2015/02/Nexus5.png" alt="image"></h3>
          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2015/01/30/android-performance-tools-systrace-1/">
                Android性能优化之Systrace工具介绍(一)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-01-30
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/Android/">Android</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/01/30/android-performance-tools-systrace-1/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/30/android-performance-tools-systrace-1/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <p> 本文是Android性能优化工具系列的第一篇，这个系列主要介绍Android性能优化过程中会使用到的一些工具，以及如何用这些工具来发现问题和解决问题。在性能优化方面，Android有不少性能工具供大家来使用，按照我们一贯地 “发现问题-解决问题”的思路来看，发现问题才是最主要的，一上来就想着如何去解决问题，反而会事倍功半。</p>
<p>这一篇先来简单介绍一下Systrace这个工具。</p>
<h2 id="0-Systrace简单介绍">0.Systrace简单介绍</h2><p>Systrace是Android4.1中新增的性能数据采样和分析工具。它可帮助开发者收集Android关键子系统（如surfaceflinger、WindowManagerService等Framework部分关键模块、服务，View系统等）的运行信息，从而帮助开发者更直观的分析系统瓶颈，改进性能。</p>
<p>Systrace的功能包括跟踪系统的I/O操作、内核工作队列、CPU负载以及Android各个子系统的运行状况等。在Android平台中，它主要由3部分组成：</p>
<ul>
<li>内核部分：Systrace利用了Linux Kernel中的ftrace功能。所以，如果要使用Systrace的话，必须开启kernel中和ftrace相关的模块。</li>
<li>数据采集部分：Android定义了一个Trace类。应用程序可利用该类把统计信息输出给ftrace。同时，Android还有一个atrace程序，它可以从ftrace中读取统计信息然后交给数据分析工具来处理。</li>
<li>数据分析工具：Android提供一个systrace.py（python脚本文件，位于Android SDK目录/tools/systrace中，其内部将调用atrace程序）用来配置数据采集的方式（如采集数据的标签、输出文件名等）和收集ftrace统计数据并生成一个结果网页文件供用户查看。 从本质上说，Systrace是对Linux Kernel中ftrace的封装。应用进程需要利用Android提供的Trace类来使用Systrace.<br>关于Systrace的官方介绍和使用可以看这里：<a href="http://developer.android.com/tools/help/systrace.html" title="SysTrace官方介绍" target="_blank" rel="external">Systrace</a></li>
</ul>
<h2 id="1-Systrace简单使用">1.Systrace简单使用</h2><p>使用Systrace前，要先了解一下Systrace在各个平台上的使用方法，鉴于大家使用Eclipse和Android Studio的居多，所以直接摘抄官网关于这个的使用方法，不过不管是什么工具，流程是一样的：</p>
<ul>
<li>手机准备好你要进行抓取的界面</li>
<li>点击开始抓取（命令行的话就是开始执行命令）</li>
<li>手机上开始操作</li>
<li>设定好的时间到了之后，会将生成Trace文件，使用Chrome将这个文件打开进行分析</li>
</ul>
<h3 id="Using_Eclipse">Using <strong>Eclipse</strong></h3><ol>
<li><p>In Eclipse, open an Android application project.</p>
<ol>
<li>Switch to the DDMS perspective, by selecting Window &gt; Perspectives &gt; DDMS.</li>
<li>In the Devices tab, select the device on which to run a trace. If no devices are listed, make sure your device is connected via USB cable and that debugging is enabled on the device.</li>
<li>Click the Systrace icon at the top of the Devices panel to configure tracing.</li>
<li>Set the tracing options and click OK to start the trace.</li>
</ol>
</li>
</ol>
<h3 id="Using_Android_Studio">Using <strong> Android Studio</strong></h3><ol>
<li><p>In Android Studio, open an Android application project.</p>
<ol>
<li>Open the Device Monitor by selecting Tools &gt; Android &gt; Monitor.</li>
<li>In the Devices tab, select the device on which to run a trace. If no devices are listed, make sure your device is connected via USB cable and that debugging is enabled on the device.</li>
<li>Click the Systrace icon at the top of the Devices panel to configure tracing.</li>
<li>Set the tracing options and click OK to start the trace.</li>
</ol>
</li>
</ol>
<h3 id="Using_Device_Monitor">Using <strong>Device Monitor</strong></h3><ol>
<li><p>Navigate to your SDK tools/ directory.</p>
<ol>
<li>Run the monitor program.</li>
<li>In the Devices tab, select the device on which to run a trace. If no devices are listed, make sure your device is connected via USB cable and that debugging is enabled on the device.</li>
<li>Click the Systrace icon at the top of the Devices panel to configure tracing.</li>
<li>Set the tracing options and click OK to start the trace.</li>
</ol>
</li>
</ol>
<h3 id="Command_Line_Usage">Command Line Usage</h3><p>命令行形式比较灵活，速度也比较快，一次性配置好之后，以后再使用的时候就会很快就出结果（<strong>强烈推荐</strong>）</p>
<p><pre class="lang:java decode:true ">$ cd android-sdk/platform-tools/systrace<br>$ python systrace.py —time=10 -o mynewtrace.html sched gfx view wm</pre><br>从上面的命令可以看到Systrace工具的位置，只需要在Bash中配置好对应的路径和Alias，使用起来还是很快速的。另外User版本是不可以抓Trace的，只有ENG版本或者Userdebug版本才可以。</p>
<p>抓取结束后，会生成对应的Trace文件，注意这个文件只能被Chrome打开。关于如何分析Trace文件，我们下面的章节会讲。不论使用那种工具，在抓取之前都会让选择参数，下面说一下这些参数的意思：</p>
<ul>
<li>-h, —help Show the help message.（帮助）</li>
<li>-o  Write the HTML trace report to the specified file.（即输出文件名，）</li>
<li>-t N, —time=N Trace activity for N seconds. The default value is 5 seconds. （Trace抓取的时间，一般是 ： -t 8）</li>
<li>-b N, —buf-size=N Use a trace buffer size of N kilobytes. This option lets you limit the total size of the data collected during a trace.</li>
<li>-k</li>
<li>—ktrace= Trace the activity of specific kernel functions, specified in a comma-separated list.</li>
<li><p>-l, —list-categories List the available tracing category tags. The available tags are(下面的参数不用翻译了估计大家也看得懂，贴官方的解释也会比较权威，后面分析的时候我们会看到这些参数的作业的):</p>
<ul>
<li><strong>gfx</strong> - Graphics</li>
<li><strong>input</strong> - Input</li>
<li><strong>view</strong> - View</li>
<li>webview - WebView</li>
<li><strong>wm</strong> - Window Manager</li>
<li><strong>am</strong> - Activity Manager</li>
<li>audio - Audio</li>
<li>video - Video</li>
<li>camera - Camera</li>
<li>hal - Hardware Modules</li>
<li>res - Resource Loading</li>
<li><strong>dalvik</strong> - Dalvik VM</li>
<li>rs - RenderScript</li>
<li><strong>sched</strong> - CPU Scheduling</li>
<li><strong>freq</strong> - CPU Frequency</li>
<li><strong>membus</strong> - Memory Bus Utilization</li>
<li><strong>idle</strong> - CPU Idle</li>
<li><strong>disk</strong> - Disk input and output</li>
<li><strong>load</strong> - CPU Load</li>
<li><strong>sync</strong> - Synchronization Manager</li>
<li><strong>workq</strong> - Kernel Workqueues Note: Some trace categories are not supported on all devices. Tip: If you want to see the names of tasks in the trace output, you must include the sched category in your command parameters.</li>
</ul>
</li>
<li><p>-a</p>
</li>
<li>—app= Enable tracing for applications, specified as a comma-separated list of package names. The apps must contain tracing instrumentation calls from the Trace class. For more information, see Analyzing Display and Performance.</li>
<li>—link-assets Link to the original CSS or JavaScript resources instead of embedding them in the HTML trace report.</li>
<li>—from-file= Create the interactive Systrace report from a file, instead of running a live trace.</li>
<li>—asset-dir= Specify a directory for the trace report assets. This option is useful for maintaining a single set of assets for multiple Systrace reports.</li>
<li>-e</li>
<li>—serial= Conduct the trace on a specific connected device, identified by its device serial number.<br>上面的参数虽然比较多，但使用工具的时候不需考虑这么多，在对应的项目前打钩即可，命令行的时候才会去手动加参数：</li>
</ul>
<p>我们一般会把这个命令配置成Alias，配置如下：</p>
<p><pre class="lang:java decode:true">alias st-start=’python /home/gaojianwu/Software/android-studio/sdk/platform-tools/systrace/systrace.py’<br>alias st-start-gfx-mx4 = ‘st-start -t 8 gfx input view sched freq wm am hwui workq res dalvik sync disk load perf hal rs idle mmc’</pre><br>&nbsp;</p>
<p><div class="highlighted-data monokai"></div><br>这样在使用的时候，可以直接敲 <strong>st-start-gfx-mx4</strong> 即可，当然为了区分和保持各个文件，还需要加上 <strong>-o xxx.Trace</strong> .上面的命令和参数不必一次就理解，只需要记住如何简单使用即可，在分析的过程中，这些东西都会慢慢熟悉的。</p>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2015/01/16/view-android-source-code-with-androidstudio/">
                使用Android Studio查看Android Lollipop源码
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-01-16
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/Android/">Android</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/01/16/view-android-source-code-with-androidstudio/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/16/view-android-source-code-with-androidstudio/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="Android_Studio">Android Studio</h2><p>作为Google的亲儿子,Nexus手机系列所收到的待遇大家有目共睹.Android5.0出来之后,Nexus5第一时间就升级到了最新的系统.那么作为Google亲儿子的Android Studio同样备受Google的重视,我也是第一时间从Eclipse转投到了Android Studio的怀抱中,从最初的测试版本一路升级到现在的1.0正式版本(今天发布了1.1,果断已经升级了),关于Android Studio的好处我就不用说了,下面两点就足矣让你转投Android Studio了:</p>
<ul>
<li>Android Studio是Google官方指定的,目前官网已经去掉了ADT, 大家可以在<a href="\&quot;http://developer.android.com/sdk/installing/index.html\&quot;">Android开发者官网</a> 中进行查看,目前只有Android Studio提供下载了.</li>
<li>Google也表示ADT不再进行维护了.<br>转投Android Studio时大势所趋,网上关于如何使用Android Studio的帖子也是满天飞,所以我就不再啰嗦夸奖Android Studio了.看一下下面的图,估计你就会很有欲望了.想查看详细的内容,可以查看<a href="\&quot;http://developer.android.com/tools/studio/index.html\&quot;">Android Studio官方文档</a><div class="\&quot;image-package"><a href="http://www.androidperformance.com/wp-content/uploads/2015/01/androidstudio.png" target="_blank" rel="external"><img src="http://www.androidperformance.com/wp-content/uploads/2015/01/androidstudio.png" alt="androidstudio"></a><br><div class="\&quot;image-caption\&quot;">Android Studio Preview</div><br></div>

</li>
</ul>
<h2 id="Android_5-0_:_Lollipop">Android 5.0 : Lollipop</h2><p>Android Lollipop是Google在今年推出的,关于Lollipop的详细介绍可以查看<a href="\&quot;http://developer.android.com/about/versions/lollipop.html\&quot;">Lollipop官方介绍</a> ,我也就不多说了.作为一个开发者,我们不应该停留在表面(即Lollipop的绚丽的界面,和新奇的设计语言<a href="\&quot;http://developer.android.com/about/versions/lollipop.html#Material\&quot;">Material design</a>),我们更要了解其中的原理.</p>
<h2 id="准备工作">准备工作</h2><p>在使用Android Studio查看源码之前,你需要做下面几件事:</p>
<ul>
<li>下载Android Lollipop源码(当然不一定非要是Lollipop源码,其他的版本也是可以的)</li>
<li>进行过一次完整编译(不编译是无法进行源码导入工作的)<br>以上操作可以参考<a href="\&quot;https://source.android.com/source/initializing.html\&quot;">Google 官方教程</a> 以确保万无一失(呵呵).上面的几个链接需要翻墙才可以访问,不过有兴趣看这篇文章的人,大部分应该都是知道VPN的.或者没有VPN不会翻墙的,速度去卖一个VPN,能花钱解决的事情,就不要花时间.</li>
</ul>
<h2 id="开始">开始</h2><ul>
<li>进入Android 源码根目录</li>
<li>执行<br><code>mmm development/tools/idegen/</code><br>这行命令的意思是编译idegen这个项目,生成idegen.jar文件.生成成功后,会显示这个jar包的位置,并显示 <code>#### make completed successfully (43 seconds) ####</code> ,如果编译失败了,后面会讲到这种情况(比较少见)</li>
<li>执行<br><code>sh ./development/tools/idegen/idegen.sh</code><br>这行命令的意思是生成对应的文件:android.iws, android.ipr, android.iml .如果生成失败,后面也会讲到这种情况.</li>
<li>生成对应的文件后,打开Android Studio,选择打开一个现有的Android Studio项目,选择Android源码的根目录,导入即可(起作用的是android.irp文件).在配置sdk版本之后就可以查看Android 源码了.</li>
<li>已经完成了,没有下一步了.</li>
</ul>
<h2 id="问题">问题</h2><ul>
<li><p>执行第一个命令的时候编译不过,出现这种情况的原因有好几种:</p>
<ul>
<li>Android 源码没有下载完全</li>
<li>没有进行全部编译</li>
<li>环境变量配置有问题解决方法依问题而定,网上对应的帖子很多,可以自己去找. 推荐这种问题还是去<a href="\&quot;http://www.jianshu.com/p/www.google.com\&quot;">Google</a> 和<a href="\&quot;http://www.jianshu.com/p/www.stackoverflow.com\&quot;">StackOverFlow</a> 上去问.</li>
</ul>
</li>
<li><p>执行第二个命令的时候,碰到下面的问题:</p>
<p>Exception in thread \”main\” java.io.FileNotFoundException: ./out/target/product/hammerhead/obj/GYP/shared_intermediates/res.java (Is a directory)<br>at java.io.FileInputStream.open(Native Method)<br>at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:138)<br>at java.io.FileReader.&lt;init&gt;(FileReader.java:72)<br>at Configuration.parsePackageName(Configuration.java:204)<br>at Configuration.rootOf(Configuration.java:180)<br>at Configuration.traverse(Configuration.java:140)<br>at Configuration.traverse(Configuration.java:167)<br>at Configuration.traverse(Configuration.java:167)<br>at Configuration.traverse(Configuration.java:167)<br>at Configuration.traverse(Configuration.java:167)<br>at Configuration.traverse(Configuration.java:167)<br>at Configuration.traverse(Configuration.java:167)<br>at Configuration.traverse(Configuration.java:167)<br>at Configuration.&lt;init&gt;(Configuration.java:72)<br>at Main.main(Main.java:37)</p>
</li>
</ul>
<p>解决办法是将<br><code>./out/target/product/hammerhead/obj/GYP/shared_intermediates/res.java</code><br>修改为:<br><code>./out/target/product/hammerhead/obj/GYP/shared_intermediates/res.j</code><br>即可.</p>
<h2 id="后记">后记</h2><p>使用Android Studio看Android源码很爽，下面是他们的优缺点：</p>
<h4 id="优点">优点</h4><ul>
<li>和Android 完美结合</li>
<li>代码提示很全</li>
<li>代码跳转很强</li>
<li>IDE比Eclipse好看(我说的是黑色主题)</li>
<li>插件很强大(底层是IDEA你懂得)</li>
<li>免费(SourceInsight负分,啥?你用的破解版? 当我没说)</li>
</ul>
<h4 id="缺点">缺点</h4><ul>
<li>对C＋＋代码的支持不是很好</li>
<li>有一定的上手难度<br>本文简书地址：<a href="\&quot;http://www.jianshu.com/p/c85984cf99e2\&quot;">http://www.jianshu.com/p/c85984cf99e2 </a>欢迎大家点喜欢<blockquote>
<p>作者：<a href="\&quot;http://weibo.com/1315612820/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo\&quot;" title="\&quot;个人微博\&quot;">Gracker</a></p>
<p>出处：<a href="\&quot;http://www.androidperformance.com/\&quot;" title="\&quot;网站主页\&quot;">androidperformance.com</a></p>
<p>本文版权归作者所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。</p>
<p>打赏一下： <a href="\&quot;http://weibo.com/p/1001603801588257955883?from=page_100505_profile&amp;wvr=6&amp;mod=wenzhangmod\&quot;">微博打赏</a></p>
</blockquote>
</li>
</ul>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2015/01/13/android-performance-optimization-overdraw-2/">
                Android性能优化之过渡绘制( 二)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2015-01-13
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/Android/">Android</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/01/13/android-performance-optimization-overdraw-2/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/13/android-performance-optimization-overdraw-2/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <p>上一篇<a href="\&quot;http://www.androidperformance.com/android-performance-optimization-overdraw-1.html\&quot;">文章</a>从理论的角度讲解了一下什么是过渡绘制，以及可以用来查看和确认过渡绘制的工具，还提供了一些优化过渡绘制的方法。对代码和布局比较熟悉的人，看完上一篇其实就已经可以对自己的应用进行优化了。我记得有人说过，用iphone你只需要保证苹果有节操即可，用Android你就得保证所有的Android开发者都有节操。但现实是残酷的，现在Android市场上，有很多粗制滥造的应用，其中不乏大厂之作，各位打开过渡绘制按钮，就知道我所言非虚。作为一个Android开发人员，我肯定是更希望Android能一步一步好起来，超越iphone。</p>
<p>这篇文章从实战的角度，讲解了一个过渡绘制的优化过程。当然这里用到的只是很少的一部分，毕竟每个应用差别很大，优化方式也各不一样。所以这篇文章仅供参考，想把这块做好还是要下功夫的。不过令我比较欣慰的是，在公司内推行这个优化之后，我们Flyme内部的自带应用已经做得很好了，当然还是有不少界面有优化的空间，但总体还是比较满意的。</p>
<p>如果没有看过前一篇，可以点这里：<a href="\&quot;http://www.androidperformance.com/android-performance-optimization-overdraw-1.html\&quot;" title="\&quot;Android性能优化之过渡绘制(一)\&quot;">Android性能优化之过渡绘制(一)</a></p>
<p>话不多说，来看正文吧：</p>
<h3 id="1-测试用例说明">1.测试用例说明</h3><h4 id="1-测试机器:">1.测试机器:</h4><ol>
<li>测试机器:MX3(M351)</li>
<li>固件:meizu_mx3-eng 4.4.4 KTU84P m35x.Flyme_OS_3.6.1 20140717113944 test-keys</li>
</ol>
<h4 id="2-测试应用:">2.测试应用:</h4><ol>
<li>设置</li>
<li>文件管理器</li>
</ol>
<h4 id="3-检测和消除过渡绘制的一般步骤:">3.检测和消除过渡绘制的一般步骤:</h4><ol>
<li>定位过渡绘制区域</li>
<li><p>利用Android提供的工具进行位置确认以及修改(HierarchyView , Tracer for OpenGL ES)</p>
<ol>
<li>定位到具体的视图(xml文件或者View)</li>
<li>通过代码和xml文件分析过渡绘制的原因</li>
<li>结合具体情况进行优化</li>
</ol>
</li>
<li><p>使用Lint工具进一步优化</p>
</li>
</ol>
<h4 id="4-面向人群:">4.面向人群:</h4><ol>
<li>开发人员:定位到自己负责的app之后,查看过渡绘制情况,然后针对性地进行优化(涉及到xml布局修改和Java代码的修改)</li>
<li>测试人员:打开gpu过渡绘制之后,就可以查看各个应用是否优化完成.</li>
</ol>
<h4 id="5-备注:">5.备注:</h4><ol>
<li>本教程以MX3为模板,可能有的应用在MX4上换了UI或者公共控件,所以看到的和下面的例子中呈现的不一样. 但是大概的流程的一样的,悉知.</li>
<li>如有说的不清楚的地方或者说的不对的地方,请及时与我联系,我会及时更正.谢谢.</li>
</ol>
<h3 id="2-具体步骤">2.具体步骤</h3><h5 id="2-1-定位过渡绘制区域">2.1.定位过渡绘制区域</h5><ol>
<li>打开GPU过渡绘制选项:<br>设置—辅助功能—开发人员工具—硬件加速渲染—调试GPU过渡绘制— 显示过渡绘制区域. (打开开发者模式需要在电话界面输入: <em>#</em>#6961#<em>#</em> :注：仅魅族，其余手机方法各异，点击版本号5次也比较常见))</li>
<li>Kill掉(即清后台)要测试的应用,重新打开就可以看到效果.下面以魅族Flyme3文件管理器和设置为例子,如下图<br><a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-094617.jpg\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-094617.jpg\&quot;" alt="\&quot;S40723-094617\&quot;"></a>  <a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-110629.jpg\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-110629.jpg\&quot;" alt="\&quot;S40723-110629\&quot;"></a><br>从图上可以看出,按照过渡绘制从好到坏(蓝-绿-粉红-红)来看,文件管理器的过渡绘制是非常严重的,而设置界面的过渡绘制则在可以接受的范围内.下面就以文件管理器为主要分析对象,来看看如何对文件管理器的过渡绘制进行优化.</li>
<li><p>从文件管理器的图,分析出过渡绘制区域:.</p>
<ol>
<li>首先看最上面的ActionBar和最下面的SmartBar,对比设置界面的ActionBar就可以知道,整个文件管理器存在一个不透明的背景,导致每次绘制时,都要先绘制这个看不见且不透明的背景.这个背景一般是应用的主题自带的背景,所以GPU过渡绘制显示其位蓝色,这个背景是可以进行优化的.</li>
<li>中间的内容部分,最底层是绿色,说明进行了2x的过渡绘制,去掉第一条我们提的那个全局背景,还有一层背景,也就是1x的过渡绘制,对比setting可知,这个背景色也是可以去掉的.</li>
<li>最容易看出的是这两条,我们先分析和优化这两条,然后再进行其他的优化.</li>
</ol>
</li>
</ol>
<h5 id="2-2-_使用工具进行位置确认:大概确定了过渡绘制的区域后,让我们来使用工具来进行验证和View确认-">2.2. 使用工具进行位置确认:大概确定了过渡绘制的区域后,让我们来使用工具来进行验证和View确认.</h5><ol>
<li>打开Monitor(Eclipse和Android Studio中都有快捷打开按钮,即DDMS,)</li>
<li>右上角选择 Hierarchy View,大概使用如图<br><a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image.png\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image.png\&quot;" alt="\&quot;Image\&quot;"></a><br>根节点:PhoneWindos$DecorView是整个视图的根节点,唯一的子节点是ActionBarOverlayLayout,这个Layout包含了ActionBar,应用程序,以及SmartBar.</li>
<li><p>从Hierarchy View结合代码分析出需要进行修改的区域</p>
<ol>
<li><p>上面分析过渡绘制区域的第一条,整个window存在一个背景,所以进行了一次重绘,这个背景的重绘是系统级别的,和主题有关,即这个背景是属于ActionBarOverlayLayout的.这种类型的过渡绘制解决也比较方便,在文件管理器的主Activity的onCreate方法中,加入<br><div class="\&quot;highlighted-data"></div></p>
<div class="\&quot;highlight\&quot;">

<p><span id="\&quot;LC1\&quot;" class="\&quot;line\&quot;"><span class="\&quot;hljs-keyword\&quot;">this</span>.getWindow().setBackgroundDrawableResource(android.R.color.transparent);</span><br><span id="\&quot;LC2\&quot;" class="\&quot;line\&quot;"></span></p>
</div></li>
</ol>
</li>
</ol>
<p><br><br>就可以将这个看不见的主题背景去掉.下面是去掉主题背景后的效果图(一张是划开,一张是没有划开):<br><a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-094435.jpg\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-094435.jpg\&quot;" alt="\&quot;S40723-094435\&quot;"></a>     <a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-094445.jpg\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-094445.jpg\&quot;" alt="\&quot;S40723-094445\&quot;"></a><br>对比优化前的图可以发现,背景被去掉之后,少了一层过渡绘制. ActionBar上的蓝色已经消失了.中间的内容由绿色变为蓝色,SmartBar也少了层(SmartBar在只显示返回和menu的时候,过渡绘制不是很严重,一旦增加了其他的icon,就会出现很严重的过渡绘制,这个需要注意,后续也会针对SmartBar进行优化)</p>
<pre><code>2.  上面分析的第二条说”<span class="keyword">*</span><span class="keyword">*</span>中间的内容部分,最底层是绿色,说明进行了2x的过渡绘制<span class="keyword">*</span><span class="keyword">*</span>”,现在中间部分变成了蓝色,但是这是一个全局的背景,导致右边的view拉过来之后,还是存在大量的红色和绿色. 继续分析Hierarchy View,找到中间view对应的视图:DragRelativeLayout,查看源码可知,DragRelativeLayout继承自公共控件:SlidingMenu ，SlidingMenu 由CustomViewAbove和CustomViewBehind组成,前者是上面可以左右拉动的那部分,后者是底部不能拉动的那部分(这个从HierarchyView中也可以看出来:如下图所示:
</code></pre><p><a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image1.png\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image1.png\&quot;" alt="\&quot;Image\&quot;"></a><br>点击CustomViewBehind,查看其所占的区域,就可以发现背景是这个View进行绘制的,打开CustomViewBehind的代码可以发现其构造函数中包含下面的代码:setBackgroundColor(getResources().getColor(R.color.mz_slidingmenu_background_light));这个背景是不需要的,查看源码可知,这个view会在SlidingMenu.setMenu的时候,被覆盖掉,还是看不到的.所以这一层view是可以去掉的.下面是去掉一层背景之后的预览图:<br><a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-105228.jpg\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-105228.jpg\&quot;" alt="\&quot;S40723-105228\&quot;"></a>  <img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-105302.jpg\&quot;" alt="\&quot;S40723-105302\&quot;"><br>可以看到这一层背景去掉之后,过渡绘制减轻了很多.</p>
<pre><code><span class="number">3</span>.  接着进行分析,可以看到CustomViewAbove也是存在一个过渡绘制的背景的,查看Hierarchy View的CustomViewAbove的子节点,可以看到过渡绘制是由ListView导致的.其id为:FilesList,在代码中找到它,并对他进行分析.在我将PartitionItemLayout中<span class="function"><span class="title">onDraw</span><span class="params">()</span></span>函数的setBounds去掉之后,过渡绘制进一步改善了(但是ListItem的View的颜色也比之前要浅了,这一步优化需要根据具体情况进行) 下面是优化后的效果图:
</code></pre><p><a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-152357.jpg\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-152357.jpg\&quot;" alt="\&quot;S40723-152357\&quot;"></a>   <a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-152404.jpg\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/S40723-152404.jpg\&quot;" alt="\&quot;S40723-152404\&quot;"></a><br>可以看到图中的过渡绘制已经非常少了.!点个赞!</p>
<h4 id="2-3_使用Lint工具进行进一步优化">2.3 使用Lint工具进行进一步优化</h4><ol>
<li>Lint工具的使用比较简单,根据给出的提示做对应的修改即可.有时候需要工具具体情况来确定是否需要修改. 下图是一个简单地例子.箭头处提示这个Layout或者它的父Layout是不必须的.具体修改方法即去掉FrameLayout,将RelativeLayout提升为根VIew即可.<br><a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image2.png\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image2.png\&quot;" alt="\&quot;Image\&quot;"></a></li>
<li><p>Lint工具还会针对代码中潜在的不合理或者Bed Code做出修改意见.比较重要的提示包括</p>
<ol>
<li>声明但是没有使用的变量</li>
<li>可能会产生的空指针</li>
<li>没必要书写的return,continue</li>
<li>复杂代码的简化写法</li>
<li>for循环的简化写法:foreach</li>
<li>无效的判空</li>
<li>空if</li>
<li>无效或者未使用的import</li>
</ol>
</li>
</ol>
<h4 id="2-4_使用Tracer_For_OpenGL_ES工具查看每一帧的draw情况-">2.4 使用Tracer For OpenGL ES工具查看每一帧的draw情况.</h4><ol>
<li>Tracer工具也在Android Device Monitor中.点击右上角的Tracer for OpenGL ES按钮就可以进入(如果没有这个按钮,点击旁边的Open Perspective按钮,从选项中选择Tracer for OpenGL ES即可).</li>
<li>初次打开Tracer工具,里面是没有内容的,点击右上角的两个按钮(一个是打开现有的GLTrace文件,另一个是新建GLTrace文件)<br>点击Trace按钮, 手机会自动启动应用程序并启动对应的Activity,当手机上的内容完全绘制出来之后,就可以点击Stop按钮,生成GlTrace文件.文件会自动打开.<br><a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image3.png\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image3.png\&quot;" alt="\&quot;Image\&quot;"></a></li>
<li>分析GLTrace文件<br>这张图是优化过后的图,对比优化前的图可以发现,优化后不会去绘制默认的背景图和CustomViewBehind的背景图.<br><a href="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image4.png\&quot;"><img src="\&quot;http://www.androidperformance.com/wp-content/uploads/2015/01/Image4.png\&quot;" alt="\&quot;Image\&quot;"></a><br>这只是一帧的绘制,如果多操作几下生成多个帧的绘制trace文件,会发现这两个背景会被多次的重绘,去掉后不仅会减轻过渡绘制,也会加快GUP的绘制速度.</li>
</ol>
<h3 id="3-优化建议">3.优化建议</h3><ol>
<li>ActionBar上有蓝色(紫色)说明appWindow绘制了一层背景,这层背景是可以去掉的.参考上面的教程.</li>
<li>公共控件的背景重绘请公共控件的负责人关注一下.(SmartBar在只有两个图标(back,menu)时,不存在过渡绘制,一旦加上其他的按钮,就会出现比较严重的过渡绘制,这个需要注意一下.)</li>
</ol>
<h3 id="4-其他参考资料">4.其他参考资料</h3><ol>
<li><a href="\&quot;http://blog.chengyunfeng.com/?p=458#\&quot;">http://blog.chengyunfeng.com/?p=458#</a> 翻译的一个老外的优化过程 (原链接<a href="\&quot;http://www.curious-creature.org/2012/12/01/android-performance-case-study/\&quot;">http://www.curious-creature.org/2012/12/01/android-performance-case-study/</a>)</li>
<li><a href="\&quot;http://blog.csdn.net/yihongyuelan/article/details/12169647\&quot;">http://blog.csdn.net/yihongyuelan/article/details/12169647</a> 反编译并添加gpu显示</li>
<li><a href="\&quot;http://developer.android.com/training/improving-layouts/optimizing-layout.html#Inspect\&quot;">http://developer.android.com/training/improving-layouts/optimizing-layout.html#Inspect</a> 官网资料</li>
<li><a href="\&quot;http://developer.android.com/training/improving-layouts/reusing-layouts.html\&quot;">http://developer.android.com/training/improving-layouts/reusing-layouts.html</a> 官网资料</li>
<li><a href="\&quot;http://developer.android.com/training/improving-layouts/loading-ondemand.html\&quot;">http://developer.android.com/training/improving-layouts/loading-ondemand.html</a> 官网资料</li>
<li><a href="\&quot;http://developer.android.com/training/improving-layouts/smooth-scrolling.html\&quot;">http://developer.android.com/training/improving-layouts/smooth-scrolling.html</a> 官网资料</li>
<li><a href="\&quot;http://developer.android.com/tools/help/hierarchy-viewer.html\&quot;">http://developer.android.com/tools/help/hierarchy-viewer.html</a> 官网关于hierarchy view的介绍</li>
<li><a href="\&quot;http://tools.android.com/tips/lint\&quot;">http://tools.android.com/tips/lint</a> lint工具介绍<blockquote>
<p>作者：<a href="\&quot;http://weibo.com/1315612820/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo\&quot;" title="\&quot;个人微博\&quot;">Gracker</a></p>
<p>出处：<a href="\&quot;http://www.androidperformance.com/\&quot;" title="\&quot;网站主页\&quot;">androidperformance.com</a></p>
<p>本文版权归作者所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。</p>
<p>打赏一下： <a href="\&quot;http://weibo.com/p/1001603801588257955883?from=page_100505_profile&amp;wvr=6&amp;mod=wenzhangmod\&quot;">微博打赏</a></p>
</blockquote>
</li>
</ol>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2014/10/20/android-performance-optimization-overdraw-1/">
                Android性能优化之过渡绘制(一)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-10-20
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/Android/">Android</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2014/10/20/android-performance-optimization-overdraw-1/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2014/10/20/android-performance-optimization-overdraw-1/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <p>博客有一段时间没有更新了，到了新公司后，一直比较忙，博客也更新地不那么频繁了，倒是利用这个VPS搭建的VPN每天都在用，速度也蛮不错的。最近一直在看Android上和性能相关的部分，也就是所谓的Android性能优化，才发现Android性能这一块，自己懂得还是太少了，所以从上层开始看，也算是一点一点入门吧。这个系列将讲解学习过程中总结的和性能相关的内容。</p>
<p>首先将讲解一下GPU过渡绘制，也是开发者最直接接触的部分吧，这个内容将分为两个部分来将讲，第一部分初步讲解一下gpu过渡绘制的原理，和一些优化建议，第二部分将用实际例子来讲解优化GPU过渡绘制的一般步骤。</p>
<p><strong>1. 过渡绘制概念:</strong></p>
<p>GPU过渡绘制的概念：GPU过度绘制指的是在屏幕一个像素上绘制多次(超过一次),比如一个TextView后有背景，那么显示文本的像素至少绘了两次，一次是背景，一次是文本。GPU过度绘制或多或少对性能有些影响,设备的内存带宽是有限的，当过度绘制导致应用需要更多的带宽(超过了可用带宽)的时候性能就会降低。带宽的限制每个设备都可能是不一样的。</p>
<p><strong>2. 过渡绘制的原因:</strong></p>
<p>1. 太多的View叠加</p>
<p>2. 复杂的层级叠加</p>
<p>3. 更长的inflation时间</p>
<p><strong>3. 过渡绘制和不合理的xml布局的影响:</strong></p>
<p>1. 布局文件是一个xml文件，inflate布局文件其实就是解析xml，根据标签信息创建相应的布局对象并做关联。xml中的标签和属性设置越多，节点树的深度越深，在解析时要执行的判断逻辑、函数的嵌套和递归就越多，所以时间消耗越多；</p>
<p>2. inflate操作只是布局影响的第一个环节，一个界面要显示出来，在requestLayout后还要执行一系列的measure、layout、draw的操作，每一步的执行时间都会受到布局本身的影响。而界面的最终显示是所有这些操作完成后才实现的，所以如果布局质量差，会增加每一步操作的时间成本，最终显示时间就会比较长。</p>
<p><strong>4. 优化工具介绍:Android提供了三个工具来帮助辨别和解决重绘问题：Hierachy Viewer，Tracer for OpenGL和Show GPU overdraw。前两个可以在ADT工具或者独立的monitor工具中找到，最后一个是在开发者选项的一部分。</strong></p>
<p>1. GPU过渡绘制:对于过度绘制的测试主要通过人工进行测试，也是发现应用过渡绘制的首选途径 .通过打开开发者选项中的 显示GPU过度绘制(魅族手机:设置—辅助功能—开发人员工具—硬件加速渲染—调试GPU过渡绘制— 显示过渡绘制区域. (魅族手机需要打开开发者模式：需要在电话界面输入: <em>#</em>#6961#<em>#</em> )) 来进行测试（PS：只有android4.2及以上的版本才具备此功能)</p>
<p>1. 颜色标识: 从好到差:蓝-绿-淡红-红</p>
<p>1. 蓝色1x过度绘制<br>2. 绿色2x过度绘制<br>3. 淡红色3x过度绘制<br>4. 红色超过4x过度绘制</p>
<p>2. 验收标准:</p>
<p>1. 控制过度绘制为2x<br>2. 不允许存在4x过度绘制<br>3. 不允许存在面积超过屏幕1/4区域的3x过度绘制（淡红色区域）</p>
<p>3. Lint工具:</p>
<p><a href="\"><img src="\" alt="\"></a></p>
<p>1. Eclipse中,点击即可,下面的窗口中会出现提示,根据提示和具体解决办法消除.<br>2. Android Studio自带Lint工具,不合理或者需要优化和注意的地方,会用黄色标记出来.<br>3. Lint工具不仅对布局有很好的优化建议,对代码中不合理的活着存在潜在风险的模块也会提出优化建议,所以一个好的建议是:多使用Lint工具检查自己的应用,尽量消除所有的建议.<br>4. Lint工具可以用命令行来运行,具体使用可以参考:tools.android.com<br>5. Lint工具的提升例子(摘自官方文档):</p>
<p>1. Use compound drawables(使用compound drawables) - A LinearLayout which contains an ImageView and a TextView can be more efficiently handled as a compound drawable.<br>2. Merge root frame(使用Merge根框架) - If a FrameLayout is the root of a layout and does not provide background or padding etc, it can be replaced with a merge tag which is slightly more efficient.<br>3. Useless leaf(去除无用的分支) - A layout that has no children or no background can often be removed (since it is invisible) for a flatter and more efficient layout hierarchy.<br>4. Useless parent (去除无用的父控件)- A layout with children that has no siblings, is not a ScrollView or a root layout, and does not have a background, can be removed and have its children moved directly into the parent for a flatter and more efficient layout hierarchy.<br>5. Deep layouts (注意Layout的深度) - Layouts with too much nesting are bad for performance. Consider using flatter layouts such as RelativeLayout or GridLayout to improve performance. The default maximum depth is</p>
<p>4. Hierarchy Viewer:此工具是一个ADT工具（或者monitor,最新版本的SDK建议不使用独立的HV工具,而是直接在monitor中进行操作.）的一部分，可以被用作对视图层级进行快速解读。在处理布局问题时特别有用，对于性能问题也很适用。Hierarchy Viewer默认只能在非加密设备使用，例如工程机，工程平板或者模拟器。为了能够在任何手机上使用Hierarchy Viewer，你得在你的应用中添加ViewServer，这是一个开源库,使用方法可以参考这里。连接上设备，打开Hierarchy Viewer(定位到tools/目录下，直接执行hierarchyviewer的命令，选定需要查看的Process，再点击Load View Hierarchy会显示出当前界面的布局Tree。在每个模块的Traffic light上有三个灯，分别代表了Measure, Layout and Draw三个步骤的性能。</p>
<p><strong>5. 布局优化建议:</strong></p>
<p>1. 布局原则:在Android UI布局过程中，通过遵守一些惯用、有效的布局原则，我们可以制作出高效且复用性高的UI，概括来说包括如下几点：</p>
<p>1. 尽量多使用RelativeLayout和LinearLayout, 不要使用绝对布局AbsoluteLayout，</p>
<p>1. 在布局层次一样的情况下， 建议使用LinearLayout代替RelativeLayout, 因为LinearLayout性能要稍高一点.<br>2. 在完成相对较复杂的布局时,建议使用RelativeLayout,RelativeLayout可以简单实现LinearLayout嵌套才能实现的布局.</p>
<p>2. 将可复用的组件抽取出来并通过include标签使用；<br>3. 使用ViewStub标签来加载一些不常用的布局；<br>4. 动态地inflation view性能要比SetVisiblity性能要好.当然用VIewStub是最好的选择.<br>5. 使用merge标签减少布局的嵌套层次<br>6. 去掉多余的背景颜色(查看背景颜色是否多余,可以将HierarchyView中的图导出为psd文件,然后用Photoshop查看.具体可以参考这个视频(<a href="https://www.youtube.com/watch?v=URyoiAt8098" target="_blank" rel="external">https://www.youtube.com/watch?v=URyoiAt8098</a>))</p>
<p>1. 对于有多层背景颜色的Layout来说,留最上面一层的颜色即可,其他底层的颜色都可以去掉<br>2. 对于使用Selector当背景的Layout(比如ListView的Item,会使用Selector来标记点击,选择等不同的状态),可以将normal状态的color设置为\”@android:color/transparent”,来解决对应的问题</p>
<p>8. 内嵌使用包含layout_weight属性的LinearLayout会在绘制时花费昂贵的系统资源，因为每一个子组件都需要被测量两次。在使用ListView与GridView的时候，这个问题显的尤其重要，因为子组件会重复被创建.所以要尽量避免使用Layout_weight<br>9. 使得Layout宽而浅，而不是窄而深（在Hierarchy Viewer的Tree视图里面体现）</p>
<p><strong>6. 例子</strong></p>
<p><strong>1. 过渡绘制优化较好的应用</strong></p>
<p>设置 画板 录音机（魅族自带应用）:</p>
<p><a href="\"><img src="\" alt="\"></a>  <a href="\"><img src="\" alt="\"></a>  <a href="\"><img src="\" alt="\"></a></p>
<p><strong>2. 过渡绘制优化较严重的应用</strong></p>
<p><strong>文件管理器 图库 应用中心 音乐 视频等</strong></p>
<p><a href="\"><img src="\" alt="\"></a>  <a href="\"><img src="\" alt="\"></a>  <a href="\"><img src="\" alt="\"></a></p>
<p>另外一些第三方客户端的过渡绘制也很严重，见<a href="\">微博</a></p>
<p><img src="\" alt="\">            <img src="\" alt="\"></p>
<p>  <img src="\" alt="\">          <img src="\" alt="\"></p>
<p>另外有能力看源码的同学，下面是绘制OverDraw的源码位置：/frameworks/base/libs/hwui/OpenGLRenderer.cpp,有兴趣的可以去研究研究。</p>
<pre class="\"lang:java" decode:true="" \"="" title="\"CountOverDraw\"">void OpenGLRenderer::renderOverdraw() {
    if (mCaches.debugOverdraw &amp;&amp; getTargetFbo() == 0) {
        const Rect* clip = &amp;mTilingClip;

        mCaches.enableScissor();
        mCaches.setScissor(clip-&gt;left, mFirstSnapshot-&gt;height - clip-&gt;bottom,
                clip-&gt;right - clip-&gt;left, clip-&gt;bottom - clip-&gt;top);

        // 1x overdraw
        mCaches.stencil.enableDebugTest(2);
        drawColor(mCaches.getOverdrawColor(1), SkXfermode::kSrcOver_Mode);

        // 2x overdraw
        mCaches.stencil.enableDebugTest(3);
        drawColor(mCaches.getOverdrawColor(2), SkXfermode::kSrcOver_Mode);

        // 3x overdraw
        mCaches.stencil.enableDebugTest(4);
        drawColor(mCaches.getOverdrawColor(3), SkXfermode::kSrcOver_Mode);

        // 4x overdraw and higher
        mCaches.stencil.enableDebugTest(4, true);
        drawColor(mCaches.getOverdrawColor(4), SkXfermode::kSrcOver_Mode);

        mCaches.stencil.disable();
    }
}

void OpenGLRenderer::countOverdraw() {
    size_t count = mWidth * mHeight;
    uint32_t* buffer = new uint32_t[count];
    glReadPixels(0, 0, mWidth, mHeight, GL_RGBA, GL_UNSIGNED_BYTE, &amp;buffer[0]);

    size_t total = 0;
    for (size_t i = 0; i &lt; count; i++) {
        total += buffer[i] &amp; 0xff;
    }

    mOverdraw = total / float(count);

    delete[] buffer;
}</pre>

<p>还有QA可能用得到的一个指标：OverDraw数值，这个的源码位置在Framework/base/core/java/android/view/HardwareRender.java中</p>
<pre class="\"lang:java" decode:true\"="" title="\"DrawOverDrawCount\"">private void debugOverdraw(View.AttachInfo attachInfo, Rect dirty,
                HardwareCanvas canvas, DisplayList displayList) {

            if (mDebugOverdraw == OVERDRAW_TYPE_COUNT) {
                if (mDebugOverdrawLayer == null) {
                    mDebugOverdrawLayer = createHardwareLayer(mWidth, mHeight, true);
                } else if (mDebugOverdrawLayer.getWidth() != mWidth ||
                        mDebugOverdrawLayer.getHeight() != mHeight) {
                    mDebugOverdrawLayer.resize(mWidth, mHeight);
                }

                if (!mDebugOverdrawLayer.isValid()) {
                    mDebugOverdraw = -1;
                    return;
                }

                HardwareCanvas layerCanvas = mDebugOverdrawLayer.start(canvas, dirty);
                countOverdraw(layerCanvas);
                final int restoreCount = layerCanvas.save();
                layerCanvas.drawDisplayList(displayList, null, DisplayList.FLAG_CLIP_CHILDREN);
                layerCanvas.restoreToCount(restoreCount);
                mDebugOverdrawLayer.end(canvas);

                float overdraw = getOverdraw(layerCanvas);
                DisplayMetrics metrics = attachInfo.mRootView.getResources().getDisplayMetrics();

                drawOverdrawCounter(canvas, overdraw, metrics.density);
            }
}

private void drawOverdrawCounter(HardwareCanvas canvas, float overdraw, float density) {
            final String text = String.format(\"%.2fx\", overdraw);
            final Paint paint = setupPaint(density);
            // HSBtoColor will clamp the values in the 0..1 range
            paint.setColor(Color.HSBtoColor(0.28f - 0.28f * overdraw / 3.5f, 0.8f, 1.0f));

            canvas.drawText(text, density * 4.0f, mHeight - paint.getFontMetrics().bottom, paint);
}</pre>

<p>欢迎大家一起交流。</p>
<p>下一篇文章会用一个实际案例来讲解如何优化过渡绘制。</p>
<p>&nbsp;</p>
<p>参考文章：</p>
<p>1.<a href="\"> http://blog.chengyunfeng.com/?p=458# 翻译的一个老外的优化过程</a><br>(原链接<a href="http://www.curious-creature.org/2012/12/01/android-performance-case-study/" target="_blank" rel="external">http://www.curious-creature.org/2012/12/01/android-performance-case-study/</a>)<br>2. <a href="\">http://blog.csdn.net/yihongyuelan/article/details/12169647 </a>反编译并添加gpu显示</p>
<p>3. <a href="\">http://developer.android.com/training/improving-layouts/optimizing-layout.html#Inspect</a> 官网资料</p>
<p>4. <a href="\">http://developer.android.com/training/improving-layouts/reusing-layouts.html </a>官网资料</p>
<p>5. <a href="\">http://developer.android.com/training/improving-layouts/loading-ondemand.html</a> 官网资料</p>
<p>6. <a href="\">http://developer.android.com/training/improving-layouts/smooth-scrolling.html </a>官网资料</p>
<p>7.<a href="\"> http://developer.android.com/tools/help/hierarchy-viewer.html</a> 官网关于hierarchy view的介绍</p>
<p>8. <a href="\">http://tools.android.com/tips/lint lint</a>工具介绍</p>
<blockquote>
<p><span style="\"color:" #ff0000;\"="">作者：<a href="\" title="\">Gracker</a></span><br><span style="\"color:" #ff0000;\"="">出处：<a href="\" title="\">androidperformance.com</a></span><br><span style="\"color:" #ff0000;\"="">本文版权归作者所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。</span><br><span style="\"color:" #ff0000;\"="">打赏一下： <a href="\">微博打赏</a></span></p>
</blockquote>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2014/09/10/iphone6-and-apple-watch/">
                iphone6发布会简记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-09-09
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/科技与人文/">科技与人文</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2014/09/10/iphone6-and-apple-watch/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2014/09/10/iphone6-and-apple-watch/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <p>手机：</p>
<ol>
<li>1.两款iphone：iphone6和iphone6 plus</li>
<li>iPhone 6分辨率：4.7寸1334 x 750，5.5寸1920 x 1080</li>
<li>苹果A8，64位处理器，比A7小13%，CPU快25%，图像处理快50%…苹果同时称这颗新的芯片可以让苹果保持持续的运算能力而不发出过多的热量。图中同时显示对手的芯片性能会随着运行时间下降。</li>
<li>摄像头依旧是 800 万像素，但配备了新的 iSight 传感器，对焦速度将是上一代的两倍，人脸识别速度也更快。</li>
<li>阳极氧化铝后盖，加不锈钢LOGO，新屏幕Renina HD屏幕。分辨率→iPhone 6：1334 x 750； iPhone 6 Plus：1920 x 1080；6.8 &amp; 7.1 毫米厚（5S 7.6毫米）</li>
<li>iPhone 6是数字化防抖 iPhone plus是光学防抖<br><a href="\"><img src="\" alt="\"></a></li>
<li>支持1080p的高清视频拍摄</li>
<li>更快 WIFI 模块以实现 3倍 WiFi 速度提升，并衍生出了 WIFI 通话功能。</li>
<li>续航能力比5S强，IP6支持11小时视频观看、上网，IP6 Plus支持14小时高清视频观看，IP6看高清视频可以支持一整天</li>
<li>新的运动处理器M8，可以更精确的记录你的运动状态，还带气压计，根据空气压力测量海拔高度</li>
<li>价格：<br><a href="\"><img src="\" alt="\"></a></li>
<li>19 号的首发地区共有 9 个，香港包含在内。大陆地区估计还要再等等。<br><a href="\"><img src="\" alt="\"></a></li>
<li>移动支付：主要利用了新 iPhone 配备的 NFC 模块、指纹识别和 Passbook 来实现。Apple Pay 将于 2014 年 10 月上线，适用于 iPhone 6 和 6 Plus<br><a href="\"><img src="\" alt="\"></a><a href="\"><img src="\" alt="\"></a><a href="\"><img src="\" alt="\"></a></li>
<li>iOS 8 则会在 9 月 17 日开始推送，支持设备请看图片<br><a href="\"><img src="\" alt="\"></a></li>
</ol>
<p>手表APPLE WATCH</p>
<ol>
<li>各种表带<br><a href="\"><img src="\" alt="\"></a></li>
<li>蓝宝石</li>
<li>手表侧面的圆环，应该是可以扭动的，可以放大或缩小屏幕显示内内容，或者进行功能列表选择</li>
<li>可以实现不少的功能，如接打电话，Siri 语音，回复短信，无线充电等，表盘采用了蓝宝石玻璃，不仅支持触摸，还加入了压力感应。</li>
<li>有些款的表带很不错，会自动吸附</li>
<li>Apple Watch 会有两种尺寸，三防 有18K金和玫瑰金版本</li>
<li>感应充电 把这个玩意贴在背面即可开始充电<br><a href="\"><img src="\" alt="\"></a></li>
<li>密集恐惧症患者勿入<br><a href="\"><img src="\" alt="\"></a></li>
<li>Apple Watch 也将具备基础的健康与健身功能</li>
<li>WatchKit，供第三方开发者开发适配应用</li>
<li>可以和手机进行互动<br><a href="\"><img src="\" alt="\"></a></li>
<li>支持的设备：<br><a href="\"><img src="\" alt="\"></a></li>
<li>价格：2015年开卖<br><a href="\"><img src="\" alt="\"></a></li>
<li>Apple Watch 将会有三个系列，同样也支持 Apple Pay 移动支付</li>
</ol>

          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="2014/07/28/how-to-write-a-better-ppt/">
                极简PPT的九大原则
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-07-28
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="categories/科技与人文/">科技与人文</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2014/07/28/how-to-write-a-better-ppt/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2014/07/28/how-to-write-a-better-ppt/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <div>1、能十几页就不几十页；</div>

<div>2、能用图就不用字；</div>

<div>3、能用字就不用词；</div>

<div>4、能用词就不用句；</div>

<div>5、能用句就不用篇；</div>

<div>6、能讲故事就不讲理 论；</div>

<div>7、能谈问题就不谈概念；</div>

<div>8、逻辑、逻辑、逻辑；</div>

<div>9、你不可能面面俱到，让人记住哪怕只有一件事、一句话、一个词，就是成功。</div>
          
        
      </div>
    

    
      <div class="post-footer">
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  

          </div>

          
            <div class="pagination">
              <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="page/4/">4</a><a class="extend next" rel="next" href="page/2/">&raquo;</a>
            </div>
          
        </div>

        
<div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>

<div id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    

    <div class="site-overview">
      <div class="site-author motion-element">
        <img class="site-author-image" src="images/default_avatar.jpg" alt="Gracker" />
        <p class="site-author-name">Gracker</p>
      </div>
      <p class="site-description motion-element"></p>
      <div class="site-state motion-element">
        <div class="site-state-item site-state-posts">
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">日志</span>
        </div>
        <div class="site-state-item site-state-tags">
            <span class="site-state-item-count">0</span>
            <span class="site-state-item-name">标签</span>
        </div>
        <div class="site-state-item site-state-pages">
            <span class="site-state-item-count">2</span>
            <span class="site-state-item-name">页面</span>
        </div>
      </div>

      
        <div class="feed-link motion-element">
          <a href="atom.xml">
            <i class="menu-item-icon icon-feed"></i>
            RSS
          </a>
        </div>
      

      <div class="links-of-author motion-element">
        
          
            <span class="links-of-author-item">
              <a href="https://github.com/Gracker">github</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="http://weibo.com/270099576">weibo</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="http://www.jianshu.com/users/FK4sc4/latest_articles">jianshu</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="http://www.zhihu.com/people/gracker">zhihu</a>
            </span>
          
        
      </div>

      
      

    </div>

    

  </div>
</div>


      </div>
    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2013 - 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Gracker</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".fancybox").fancybox();
    });
  </script>

  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    LogoAndMenuMotion();
    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});

    function LogoAndMenuMotion() {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        
        { e: $('.logo-line-before i'), p: { translateX: "100%" }, o: { duration: 500, sequenceQueue: false } },
        { e: $('.logo-line-after i'), p: { translateX: "-100%" }, o: { duration: 500, sequenceQueue: false } },
        
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200 } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    }


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = window.postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  

  

  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"grackertalk"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
  
</body>
</html>
