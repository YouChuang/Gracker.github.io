<!doctype html>
<html class="theme-next use-motion theme-next-next">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>




  <link rel="stylesheet" type="text/css" href="../../../../vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="../../../../css/main.css?v=0.4.0"/>





    <meta name="keywords" content="Android,Performance" />



    <link rel="alternate" href="../../../../atom.xml" title="Android Perofrmance" type="application/atom+xml" />



    <link rel="shorticon icon" type="image/x-icon" href="../../../..//favicon.ico?v=0.4.0" />




  <title> [转]Using lists in Android (ListView) // Android Perofrmance </title>
</head>

<body>
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Android Perofrmance</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
    
      
      <li class="menu-item menu-item-home">
        <a href="../../../..//">
          <i class="menu-item-icon icon-home"></i> <br />
          首页
        </a>
      </li>
    
      
      <li class="menu-item menu-item-categories">
        <a href="../../../..//categories">
          <i class="menu-item-icon icon-categories"></i> <br />
          分类
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="../../../..//archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          归档
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="../../../..//tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          标签
        </a>
      </li>
    
      
      <li class="menu-item menu-item-about">
        <a href="../../../..//about">
          <i class="menu-item-icon icon-about"></i> <br />
          关于
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
            
          

          <div id="posts" class="posts-expand">
            
  

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              [转]Using lists in Android (ListView)
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-05-31
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="../../../../categories/Android/">Android</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2014/05/31/using-listview-in-android/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2014/05/31/using-listview-in-android/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          <div class="\"titlepage\"" style="\"color:" #000000;\"=""><br><div><br><div><br><br>### 前言<br><br>(<span style="\"color:" #ff0000;\"="">强烈建议每个做Android都仔细认真地看一下)</span>如何写好一篇技术文章!对于一个搞技术的来说,写好一篇技术博客,其实是蛮难的.有时候写不下去的时候,我就会看看这篇文章,看看别人是如何写好技术文章的(这篇文章在我的印象笔记中存了很久,每次用到ListView,我都会会翻出来看看.<br><br>然则这么好的文章,我实在是不敢自己一个人私藏,所以在这里贴出来给大家分享一下.翻译就免了,很大的工程,不过这里面的英文都比较简单,如果这个都看不懂,那就别看了.但是我建议每一个搞Android的都把这篇文章仔细地看一遍,因为我见到过许多不是很规范的ListView的写法,Item都没有重用,Adapter写得很乱.之类的…<br><br>原文地址:<a href="\">http://www.vogella.com/tutorials/AndroidListView/article.html</a><br><br>### 正文<br><br></div><br><div><br><br>Copyright © 2010, 2011, 2012, 2013, 2014 Lars Vogel<br><br></div><br><div><br><br>07.01.2014<br><br></div><br><div><br><div class="\"revhistory\""><br><table summary="\"Revision" history\"=""><br><tbody><br><tr><br><th colspan="\"4\"" align="\"left\"" valign="\"top\""><strong>Revision History</strong></th><br></tr><br><tr><br><td align="\"left\"">Revision 0.1 - 4.5</td><br><td align="\"left\"">01.07.2010 - 07.01.2014</td><br><td align="\"left\""><span class="\"firstname\"">Lars<br></span><span class="\"surname\"">Vogel<br></span></td><br><td align="\"left\"">bug fixes and enhancements</td><br></tr><br></tbody><br></table><br></div><br></div><br><div><br><div class="\"abstract\""><a style="\"font-weight:" bold;="" color:="" #101010;\"="" name="\"abstract\""></a><br><br><strong>Using Android ListView, ListActivity and ListFragment</strong><br><br>This tutorial describes how to use the ListView view together with Activities and Fragments in Android. The tutorial is based on Eclipse 4.3, Java 1.6 and Android 4.4.<br><br></div><br></div><br></div><br><div></div>

<hr>
<p></p></div><p></p>
<div class="\"toc\"" style="\"color:" #000000;\"=""><br><br><strong>Table of Contents</strong><br><br><dl><dt><span class="\"section\""><a href="\">1. Android and Lists</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">1.1. Using lists in Android</a></span></dt><dt><span class="\"section\""><a href="\">1.2. Views for handling lists</a></span></dt><dt><span class="\"section\""><a href="\">1.3. Possible input types for lists</a></span></dt><dt><span class="\"section\""><a href="\">1.4. Adapters</a></span></dt><dt><span class="\"section\""><a href="\">1.5. Filtering and sorting</a></span></dt><dt><span class="\"section\""><a href="\">1.6. Data updates in the adapter</a></span></dt><dt><span class="\"section\""><a href="\">1.7. Listener</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">2. Default adapter</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">2.1. Default platform adapter</a></span></dt><dt><span class="\"section\""><a href="\">2.2. Using ArrayAdapter</a></span></dt><dt><span class="\"section\""><a href="\">2.3. ListView example with ArrayAdapter</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">3. Custom adapter implementations</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">3.1. Developing a custom adapter</a></span></dt><dt><span class="\"section\""><a href="\">3.2. Preparing a row for the list</a></span></dt><dt><span class="\"section\""><a href="\">3.3. Example for a custom adapter</a></span></dt><dt><span class="\"section\""><a href="\">3.4. Updating the data model from the adapter</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">4. ListActivity and ListFragment</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">4.1. Default container for using ListView</a></span></dt><dt><span class="\"section\""><a href="\">4.2. ListActivity and custom layout</a></span></dt><dt><span class="\"section\""><a href="\">4.3. Placeholder for an empty list</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">5. Exercise: Using ListView and ListActivity</a></span></dt><dt><span class="\"section\""><a href="\">6. Exercise: ListActivity with own layout</a></span></dt><dt><span class="\"section\""><a href="\">7. Tutorial: Implementing your own adapter</a></span></dt><dt><span class="\"section\""><a href="\">8. ListViews and performance</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">8.1. Motivation</a></span></dt><dt><span class="\"section\""><a href="\">8.2. Time consuming operations</a></span></dt><dt><span class="\"section\""><a href="\">8.3. Avoiding layout inflation and object creation</a></span></dt><dt><span class="\"section\""><a href="\">8.4. Holder Pattern</a></span></dt><dt><span class="\"section\""><a href="\">8.5. Example</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">9. Storing the selection of a view</a></span></dt><dt><span class="\"section\""><a href="\">10. Contextual action mode for ListViews</a></span></dt><dt><span class="\"section\""><a href="\">11. Implementing undo for an action</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">11.1. When should you offer an undo action?</a></span></dt><dt><span class="\"section\""><a href="\">11.2. Example</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">12. Performance Optimization</a></span></dt><dt><span class="\"section\""><a href="\">13. Tutorial: How to display two items in a ListView</a></span></dt><dt><span class="\"section\""><a href="\">14. Selecting multiple items in the ListView</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">14.1. Interaction between the model and Listview</a></span></dt><dt><span class="\"section\""><a href="\">14.2. Tutorial: Domain Model and Rows interaction</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">15. Implementing an expandable ListView</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">15.1. ExpandableListView</a></span></dt><dt><span class="\"section\""><a href="\">15.2. ExpandableListView example</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">16. Tutorial: Miscellaneous</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">16.1. Adding a longclick listener to the list items</a></span></dt><dt><span class="\"section\""><a href="\">16.2. Header and Footer</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">17. SimpleCursorAdapter</a></span></dt><dt><span class="\"section\""><a href="\">18. Additional Open Source libraries</a></span></dt><dt><span class="\"section\""><a href="\">19. Support free vogella tutorials</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">19.1. Thank you</a></span></dt><dt><span class="\"section\""><a href="\">19.2. Questions and Discussion</a></span></dt></dl></dd><dt><span class="\"section\""><a href="\">20. Links and Literature</a></span></dt><dd><dl><dt><span class="\"section\""><a href="\">20.1. Source Code</a></span></dt><dt><span class="\"section\""><a href="\">20.2. ListView Resources</a></span></dt><dt><span class="\"section\""><a href="\">20.3. vogella Resources</a></span></dt></dl></dd></dl></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"androidlists\""></a>1. Android and Lists<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"androidlists_overview\""></a>1.1. Using lists in Android<br><br></div><br>The display of elements in a list is a very common pattern in mobile applications. The user sees a list of items and can scroll through them. Such an activity is depicted in the following picture.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br>Typically the user interacts with the list via the action bar, for example, via a refresh button. Individual list items can be selected. This selection can update the action bar or can trigger a detailed screen for the selection. The following graphic sketches that. On the selection of a list item another activity is started.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"androidlists_view\""></a>1.2. Views for handling lists<br><br></div><br>Android provides the <code>ListView</code> and the <code>ExpandableListView</code> classes which is capable of displaying a scrollable list of items.<br><br>The <code>ExpandableListView</code> class supports a grouping of items.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"androidlists_inputtype\""></a>1.3. Possible input types for lists<br><br></div><br>The input to the list (items in the list) can be arbitrary Java objects. The adapter extracts the correct data from the data object and assigns this data to the <em>views</em> in the row of the <code>ListView</code>.<br><br>These items are typically called the <em>data model</em> of the list. An adapter can receive data as input.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"androidlists_adapterintro\""></a>1.4. Adapters<br><br></div><br>An <em>adapter</em> manages the data model and adapts it to the individual rows in the list view. An adapter extends the<code>BaseAdapter</code> class.<br><br>Every line in the list view consists of a layout which can be as complex as you want. A typical line in a list view has an image on the left side and two text lines in the middle as depicted in the following graphic.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br>A layout file for a such a line might look like the following.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">&lt;RelativeLayout xmlns:android=\”<a href="http://schemas.android.com/apk/res/android\" target="_blank" rel="external">http://schemas.android.com/apk/res/android\</a>“<br>    android:layout_width=\”fill_parent\”<br>    android:layout_height=\”?android:attr/listPreferredItemHeight\”<br>    android:padding=\”6dip\” &gt;<br><br>    &lt;ImageView<br>        android:id=\”@+id/icon\”<br>        android:layout_width=\”wrap_content\”<br>        android:layout_height=\”fill_parent\”<br>        android:layout_alignParentBottom=\”true\”<br>        android:layout_alignParentTop=\”true\”<br>        android:layout_marginRight=\”6dip\”<br>        android:contentDescription=\”TODO\”<br>        android:src=\”@drawable/ic_launcher\” /&gt;<br><br>    &lt;TextView<br>        android:id=\”@+id/secondLine\”<br>        android:layout_width=\”fill_parent\”<br>        android:layout_height=\”26dip\”<br>        android:layout_alignParentBottom=\”true\”<br>        android:layout_alignParentRight=\”true\”<br>        android:layout_toRightOf=\”@id/icon\”<br>        android:ellipsize=\”marquee\”<br>        android:singleLine=\”true\”<br>        android:text=\”Description\”<br>        android:textSize=\”12sp\” /&gt;<br><br>    &lt;TextView<br>        android:layout_width=\”fill_parent\”<br>        android:layout_height=\”wrap_content\”<br>        android:layout_above=\”@id/secondLine\”<br>        android:layout_alignParentRight=\”true\”<br>        android:layout_alignParentTop=\”true\”<br>        android:layout_alignWithParentIfMissing=\”true\”<br>        android:layout_toRightOf=\”@id/icon\”<br>        android:gravity=\”center_vertical\”<br>        android:text=\”Example application\”<br>        android:textSize=\”16sp\” /&gt;<br><br>&lt;/RelativeLayout&gt;</pre><br>&nbsp;<br><br>The adapter would inflate the layout for each row in its <code>getView()</code> method and assign the data to the individual views in the row.<br><br>The adapter is assigned to the <code>ListView</code> via the <code>setAdapter</code> method on the <code>ListView</code> object.<br><div class="\"tip\""><br><br>### Tip<br><br>Adapters are not only used by <code>ListView</code>, but also by other views which extend<code>AdapterView</code> as, for example, <code>Spinner</code>, <code>GridView</code>, <code>Gallery</code> and <code>StackView</code>.<br><br></div><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"androidlists_filtersort\""></a>1.5. Filtering and sorting<br><br></div><br>Filtering and sorting of the data is handled by the adapter. You need to implement the logic in your custom adapter implementation.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterown_updates\""></a>1.6. Data updates in the adapter<br><br></div><br>The <code>notifyDataSetChanged()</code> method on the adapter is called if the data has changed or if new data is available.<br><br>The <code>notifyDataSetInvalidated()</code> method is called if the data is not available anymore.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listview_adapterlistener\""></a>1.7. Listener<br><br></div><br>To react to selections in the list, set an <code>OnItemClickListener</code> to your <code>ListView</code>.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">listView.setOnItemClickListener(new OnItemClickListener() {<br>  @Override<br>  public void onItemClick(AdapterView&lt;?&gt; parent, View view,<br>    int position, long id) {<br>    Toast.makeText(getApplicationContext(),<br>      \”Click ListItem Number \” + position, Toast.LENGTH_LONG)<br>      .show();<br>  }<br>});</pre><br>&nbsp;<br><br></div><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"listview_defaultadapter\""></a>2. Default adapter<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listview_defaultadapter\""></a>2.1. Default platform adapter<br><br></div><br>Android provides default adapter implementations; the most important are <code>ArrayAdapter</code> and <code>CursorAdapter</code>.<br><br><code>ArrayAdapter</code> can handle data based on <code>Arrays</code> or <code>java.util.List</code>.<br><br><code>SimpleCursorAdapter</code> can handle database related data.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"arrayAdapter\""></a>2.2. Using ArrayAdapter<br><br></div><br>The <code>ArrayAdapter</code> class can handle a list or array of Java objects as input. Every Java object is mapped to one row. By default, it maps the <code>toString()</code> method of the object to a view in the row layout.<br><br>You can define the ID of the view in the constructor of the <code>ArrayAdapter</code> otherwise the <code>android.R.id.text1</code> ID is used as default.<br><br>The <code>ArrayAdapter</code> class allows to remove all elements in its underlying data structure with the <code>clear()</code> method call. You can then add new elements via the <code>add()</code> method or a <code>Collection</code> via the <code>addAll()</code> method.<br><br>You can also directly modify the underlying data structure and call the <code>notifyDataSetChanged()</code> method on the adapter to notify it about the changes in data.<br><div class="\"warning\""><br><br>### Warning<br><br>If you want to change the data in your adapter, the underlying data structure must support this operation. This is, for example, the case for the <code>ArrayList</code> class, but not for arrays.<br><br></div><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listview_listviewexample\""></a>2.3. ListView example with ArrayAdapter<br><br></div><br>The following listing shows a layout file called <code>activity_listviewexampleactivity.xml</code> which includes a<code>ListView</code>.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">&lt;ListView xmlns:android=\”<a href="http://schemas.android.com/apk/res/android\" target="_blank" rel="external">http://schemas.android.com/apk/res/android\</a>“<br>    android:id=\”@+id/listview\”<br>    android:layout_width=\”wrap_content\”<br>    android:layout_height=\”wrap_content\” /&gt;<br></pre><br>&nbsp;<br><br>The following example shows the usage of the <code>ListView</code> view in an activity. It uses a default layout from the Android platform for the row layout. It also demonstrates the removal of list items and uses animations for the removal.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package com.vogella.android.listview.withanimation;<br><br>public class ListViewExampleActivity extends Activity {<br><br>  @Override<br>  protected void onCreate(Bundle savedInstanceState) {<br>    super.onCreate(savedInstanceState);<br>    setContentView(R.layout.activity_listviewexampleactivity);<br><br>    final ListView listview = (ListView) findViewById(R.id.listview);<br>    String[] values = new String[] { \”Android\”, \”iPhone\”, \”WindowsMobile\”,<br>        \”Blackberry\”, \”WebOS\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”,<br>        \”Linux\”, \”OS/2\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”, \”Linux\”,<br>        \”OS/2\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”, \”Linux\”, \”OS/2\”,<br>        \”Android\”, \”iPhone\”, \”WindowsMobile\” };<br><br>    final ArrayList&lt;String&gt; list = new ArrayList&lt;String&gt;();<br>    for (int i = 0; i &lt; values.length; ++i) {<br>      list.add(values[i]);<br>    }<br>    final StableArrayAdapter adapter = new StableArrayAdapter(this,<br>        android.R.layout.simple_list_item_1, list);<br>    listview.setAdapter(adapter);<br><br>    listview.setOnItemClickListener(new AdapterView.OnItemClickListener() {<br><br>      @Override<br>      public void onItemClick(AdapterView&lt;?&gt; parent, final View view,<br>          int position, long id) {<br>        final String item = (String) parent.getItemAtPosition(position);<br>        view.animate().setDuration(2000).alpha(0)<br>            .withEndAction(new Runnable() {<br>              @Override<br>              public void run() {<br>                list.remove(item);<br>                adapter.notifyDataSetChanged();<br>                view.setAlpha(1);<br>              }<br>            });<br>      }<br><br>    });<br>  }<br><br>  private class StableArrayAdapter extends ArrayAdapter&lt;String&gt; {<br><br>    HashMap&lt;String, Integer&gt; mIdMap = new HashMap&lt;String, Integer&gt;();<br><br>    public StableArrayAdapter(Context context, int textViewResourceId,<br>        List&lt;String&gt; objects) {<br>      super(context, textViewResourceId, objects);<br>      for (int i = 0; i &lt; objects.size(); ++i) {<br>        mIdMap.put(objects.get(i), i);<br>      }<br>    }<br><br>    @Override<br>    public long getItemId(int position) {<br>      String item = getItem(position);<br>      return mIdMap.get(item);<br>    }<br><br>    @Override<br>    public boolean hasStableIds() {<br>      return true;<br>    }<br><br>  }<br><br>}</pre><br>&nbsp;<br><br></div><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"adapterown\""></a>3. Custom adapter implementations<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterown_custom\""></a>3.1. Developing a custom adapter<br><br></div><br>The <code>ArrayAdapter</code> is limited as it supports only the mapping of <code>toString()</code> to one view in the row layout. To control the data assignment and to support several views, you have to create your custom adapter implementation.<br><br>For this you would extend an existing adapter implementation or subclass the <code>BaseAdapter</code> class directly.<br><div class="\"tip\""><br><br>### Tip<br><br>Frequently you extend <code>ArrayAdapter</code> to write a custom adapter, as this is simpler than extending <code>BaseAdapter</code> directly.<br><br></div><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterown_inflating\""></a>3.2. Preparing a row for the list<br><br></div><br>The adapter needs to create a layout for each row of the list. The <code>ListView</code> instance calls the <code>getView()</code> method on the adapter for each data element. In this method the adapter creates the row layout and maps the data to the views in the layout.<br><br>This root of the layout is typically a <code>ViewGroup</code> (layout manager) and contains several other views , e.g., an<code>ImageView</code> and a <code>TextView</code>. The following graphic shows a list with different layouts for odd and even rows.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br>Within the <code>getView()</code> method you would inflate an XML based layout and then set the content of the individual views based on the Java object for this row. To inflate the XML layout file, you can use the <code>LayoutInflator</code> system service.<br><div class="\"note\""><br><br>### Note<br><br>This layout inflator service can get accessed via the <code>getLayoutInflator()</code> method of the activity or via the <code>context.getSystemService(Context.LAYOUT_INFLATER_SERVICE)</code>method call.<br><br></div><br>After the adapter inflated the layout, it searches for the relevant views in the layout and fills them with the data. The individual elements in the layout can be found via the <code>findViewById()</code> method call on the top level view.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterown_example\""></a>3.3. Example for a custom adapter<br><br></div><br>The following code shows an implementation of a custom adapter. This adapter assumes that you have two png files (no.png and yes.png) in one of your <code>res/drawable</code> folders. The coding inflates an XML layout file, finds the relevant views in the layout and sets their content based on the input data.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.content.Context;<br>import android.view.LayoutInflater;<br>import android.view.View;<br>import android.view.ViewGroup;<br>import android.widget.ArrayAdapter;<br>import android.widget.ImageView;<br>import android.widget.TextView;<br><br>public class MySimpleArrayAdapter extends ArrayAdapter&lt;String&gt; {<br>  private final Context context;<br>  private final String[] values;<br><br>  public MySimpleArrayAdapter(Context context, String[] values) {<br>    super(context, R.layout.rowlayout, values);<br>    this.context = context;<br>    this.values = values;<br>  }<br><br>  @Override<br>  public View getView(int position, View convertView, ViewGroup parent) {<br>    LayoutInflater inflater = (LayoutInflater) context<br>        .getSystemService(Context.LAYOUT<em>INFLATER_SERVICE);<br>    View rowView = inflater.inflate(R.layout.rowlayout, parent, false);<br>    TextView textView = (TextView) rowView.findViewById(R.id.label);<br>    ImageView imageView = (ImageView) rowView.findViewById(R.id.icon);<br>    textView.setText(values[position]);<br>    // change the icon for Windows and iPhone<br>    String s = values[position];<br>    if (s.startsWith(\”iPhone\”)) {<br>      imageView.setImageResource(R.drawable.no);<br>    } else {<br>      imageView.setImageResource(R.drawable.ok);<br>    }<br><br>    return rowView;<br>  }<br>}</em></pre><br>&nbsp;<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterown_interaction\""></a>3.4. Updating the data model from the adapter<br><br></div><br>The row can also contain _views which interact with the underlying data model via the adapter. For example, you can have a <code>Checkbox</code> in your row layout and if the <code>Checkbox</code> is selected, the underlying data is changed.<br><br></div><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"listactivity\""></a>4. ListActivity and ListFragment<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listactivity_overview\""></a>4.1. Default container for using ListView<br><br></div><br>Android provides specialized fragment and activity classes to simplify list handling.<br><br>The classes are the <code>ListActivity</code> class if you want to use lists in activities and the the <code>ListFragment</code> class if you want to use lists in fragments.<br><br>You do not have to assign a layout to these elements. If you do not define a layout, the activity or fragment contains a single <code>ListView</code> by default. <code>ListActivity</code> and <code>ListFragment</code> also allow you to override a <code>onListItemClick()</code>method for handling selection of list items.<br><br>Both classes allow you to set the adapter to the default <code>ListView</code> via the <code>setListAdapter()</code> method.<br><br>The following example code shows a simple <code>ListFragment</code> implementation.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.fragments;<br><br>import android.content.Intent;<br>import android.os.Bundle;<br>import android.view.View;<br>import android.widget.ArrayAdapter;<br>import android.widget.ListView;<br>import android.app.ListFragment;<br><br>public class MyListFragment extends ListFragment {<br><br>  @Override<br>  public void onActivityCreated(Bundle savedInstanceState) {<br>    super.onActivityCreated(savedInstanceState);<br>    String[] values = new String[] { \”Android\”, \”iPhone\”, \”WindowsMobile\”,<br>        \”Blackberry\”, \”WebOS\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”,<br>        \”Linux\”, \”OS/2\” };<br>    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(getActivity(),<br>        android.R.layout.simple_list_item_1, values);<br>    setListAdapter(adapter);<br>  }<br><br>  @Override<br>  public void onListItemClick(ListView l, View v, int position, long id) {<br>    // do something with the data<br>  }<br>}<br></pre><br>&nbsp;<br><br>The next example code demonstrates the usage of a <code>ListActivity</code>.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.widget.ArrayAdapter;<br><br>public class MyListActivity extends ListActivity {<br>  public void onCreate(Bundle icicle) {<br>    super.onCreate(icicle);<br>    String[] values = new String[] { \”Android\”, \”iPhone\”, \”WindowsMobile\”,<br>        \”Blackberry\”, \”WebOS\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”,<br>        \”Linux\”, \”OS/2\” };<br>    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,<br>        android.R.layout.simple_list_item_1, values);<br>    setListAdapter(adapter);<br>  }<br>}</pre><br>&nbsp;<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listactivity_layout\""></a>4.2. ListActivity and custom layout<br><br></div><br>You can use a custom layout with <code>ListActivity</code> or <code>ListFragment</code>. In this case the fragment or activity searches in the provided layout for a <code>ListView</code> with the pre-defined <code>android:id</code> attribute set to <code>@android:id/list</code>. This usage is demonstrated by the following code snippet.<br><br>&nbsp;<br><pre class="\"programlisting\""><span class="\"hl-tag\"" style="\"color:" #008800;\"="">&lt;ListView</span><br>  <span class="\"hl-attribute\"" style="\"color:" #7f0055;\"="">android:id</span>=<span class="\"hl-value\"" style="\"color:" blue;\"="">\”@android:id/list\”</span><br>  <span class="\"hl-attribute\"" style="\"color:" #7f0055;\"="">android:layout_width</span>=<span class="\"hl-value\"" style="\"color:" blue;\"="">\”match_parent\”</span><br>  <span class="\"hl-attribute\"" style="\"color:" #7f0055;\"="">android:layout_height</span>=<span class="\"hl-value\"" style="\"color:" blue;\"="">\”wrap_content\”</span><span class="\"hl-tag\"" style="\"color:" #008800;\"=""> &gt;</span><br><span class="\"hl-tag\"" style="\"color:" #008800;\"="">&lt;/ListView&gt;</span></pre><br>&nbsp;<br><div class="\"warning\""><br><br>### Warning<br><br>If you do not use this ID or do not include a <code>ListView</code> into your layout, the application crashes once you try to display the activity or the fragment.<br><br></div><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listactivity_emptyview\""></a>4.3. Placeholder for an empty list<br><br></div><br>You can also use a view with the <code>@android:id/empty</code> ID in your layout. The corresponding activity and fragment shows this view automatically if the <code>ListView</code> is empty and hides it otherwise. For example, you could display an error message in such a view.<br><br></div><br></div>

<div style="\"color:" #000000;\"="" data-type="\"ad\"" data-publisher="\"lqm.javaeclipseandroid.site\"" data-zone="\"ron\"" data-format="\"728x90\""></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"exercise_listsactivity_simple\""></a>5. Exercise: Using ListView and ListActivity<br><br></div><br>The following exercise demonstrates how to use a <code>ListView</code> in an <code>ListActivity</code>. You use the predefined<code>ArrayAdapter</code> class and an existing Android layout for the rows.<br><br>Create a new Android project called <em>de.vogella.android.listactivity</em> with the activity called <code>MyListActivity</code>.<br><br>Change <code>MyListActivity</code> class based on the the following code example. Note that the <code>setContentView()</code> method is not used.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.view.View;<br>import android.widget.ArrayAdapter;<br>import android.widget.ListView;<br>import android.widget.Toast;<br><br>public class MyListActivity extends ListActivity {<br>  public void onCreate(Bundle icicle) {<br>    super.onCreate(icicle);<br>    String[] values = new String[] { \”Android\”, \”iPhone\”, \”WindowsMobile\”,<br>        \”Blackberry\”, \”WebOS\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”,<br>        \”Linux\”, \”OS/2\” };<br>    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,<br>        android.R.layout.simple_list_item_1, values);<br>    setListAdapter(adapter);<br>  }<br><br>  @Override<br>  protected void onListItemClick(ListView l, View v, int position, long id) {<br>    String item = (String) getListAdapter().getItem(position);<br>    Toast.makeText(this, item + \” selected\”, Toast.LENGTH_LONG).show();<br>  }<br>}</pre><br>&nbsp;<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"listsactivity_layout\""></a>6. Exercise: ListActivity with own layout<br><br></div><br>In our example your will define your layout for the rows and use it in your adapter.<br><br>Create the <code>rowlayout.xml</code> layout file in the <code>res/layout</code> folder of the <code>de.vogella.android.listactivity</code> project.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">&lt;?xml version=\”1.0\” encoding=\”utf-8\”?&gt;<br>&lt;LinearLayout xmlns:android=\”<a href="http://schemas.android.com/apk/res/android\" target="_blank" rel="external">http://schemas.android.com/apk/res/android\</a>“<br>    android:layout_width=\”wrap_content\”<br>    android:layout_height=\”wrap_content\” &gt;<br><br>    &lt;ImageView<br>        android:id=\”@+id/icon\”<br>        android:layout_width=\”22px\”<br>        android:layout_height=\”22px\”<br>        android:layout_marginLeft=\”4px\”<br>        android:layout_marginRight=\”10px\”<br>        android:layout_marginTop=\”4px\”<br>        android:src=\”@drawable/ic_launcher\” &gt;<br>    &lt;/ImageView&gt;<br><br>    &lt;TextView<br>        android:id=\”@+id/label\”<br>        android:layout_width=\”wrap_content\”<br>        android:layout_height=\”wrap_content\”<br>        android:text=\”@+id/label\”<br>        android:textSize=\”20px\” &gt;<br>    &lt;/TextView&gt;<br><br>&lt;/LinearLayout&gt;</pre><br>&nbsp;<br><br>Change your activity so that is using the new layout.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.view.View;<br>import android.widget.ArrayAdapter;<br>import android.widget.ListView;<br>import android.widget.Toast;<br><br>public class MyListActivity extends ListActivity {<br>  public void onCreate(Bundle icicle) {<br>    super.onCreate(icicle);<br>    String[] values = new String[] { \”Android\”, \”iPhone\”, \”WindowsMobile\”,<br>        \”Blackberry\”, \”WebOS\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”,<br>        \”Linux\”, \”OS/2\” };<br>    // use your custom layout<br>    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,<br>        R.layout.rowlayout, R.id.label, values);<br>    setListAdapter(adapter);<br>  }<br><br>  @Override<br>  protected void onListItemClick(ListView l, View v, int position, long id) {<br>    String item = (String) getListAdapter().getItem(position);<br>    Toast.makeText(this, item + \” selected\”, Toast.LENGTH_LONG).show();<br>  }<br>}<br></pre><br>&nbsp;<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"tutorial_ownadapter\""></a>7. Tutorial: Implementing your own adapter<br><br></div><br>The following uses two images \”no.png\” and \”ok.png\”. I placed it in the \”res/drawable-mdpi\” folder. You must create your own icons. In case you do not find any icons just copy \”icon.png\” and use a drawing program to change it a little bit.<br><br>Create the class <code>MySimpleArrayAdapter</code> which will serve as our adapter.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.content.Context;<br>import android.view.LayoutInflater;<br>import android.view.View;<br>import android.view.ViewGroup;<br>import android.widget.ArrayAdapter;<br>import android.widget.ImageView;<br>import android.widget.TextView;<br><br>public class MySimpleArrayAdapter extends ArrayAdapter&lt;String&gt; {<br>  private final Context context;<br>  private final String[] values;<br><br>  public MySimpleArrayAdapter(Context context, String[] values) {<br>    super(context, R.layout.rowlayout, values);<br>    this.context = context;<br>    this.values = values;<br>  }<br><br>  @Override<br>  public View getView(int position, View convertView, ViewGroup parent) {<br>    LayoutInflater inflater = (LayoutInflater) context<br>        .getSystemService(Context.LAYOUT<em>INFLATER_SERVICE);<br>    View rowView = inflater.inflate(R.layout.rowlayout, parent, false);<br>    TextView textView = (TextView) rowView.findViewById(R.id.label);<br>    ImageView imageView = (ImageView) rowView.findViewById(R.id.icon);<br>    textView.setText(values[position]);<br>    // Change the icon for Windows and iPhone<br>    String s = values[position];<br>    if (s.startsWith(\”Windows7\”) || s.startsWith(\”iPhone\”)<br>        || s.startsWith(\”Solaris\”)) {<br>      imageView.setImageResource(R.drawable.no);<br>    } else {<br>      imageView.setImageResource(R.drawable.ok);<br>    }<br><br>    return rowView;<br>  }<br>}<br></em></pre><br>&nbsp;<br><br>To use this adapter, change the _activity to the following.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br><br>public class MyListActivity extends ListActivity {<br>  public void onCreate(Bundle icicle) {<br>    super.onCreate(icicle);<br>    String[] values = new String[] { \”Android\”, \”iPhone\”, \”WindowsMobile\”,<br>        \”Blackberry\”, \”WebOS\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”,<br>        \”Linux\”, \”OS/2\” };<br>    MySimpleArrayAdapter adapter = new MySimpleArrayAdapter(this, values);<br>    setListAdapter(adapter);<br>  }<br>}</pre><br>&nbsp;<br><br>If you run this example you should get a list with different icons for the certain elements.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"adapterperformance\""></a>8. ListViews and performance<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterperformance_motivation\""></a>8.1. Motivation<br><br></div><br>Performance is especially important on Android as users expect fast reaction times. Compared to desktop computers an Android device is relatively slow from the hardware perspective.<br><br>This part describes how to reduce these operations to implement your custom list adapter efficiently. The default Android adapters like <code>ArrayAdapter</code> are already performance optimized.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterperformance_problems\""></a>8.2. Time consuming operations<br><br></div><br>Every view which get inflated from an XML layout file will result in a Java object. Inflating layouts and creating Java objects is expensive with regards to time and memory consumption.<br><br>In addition using the <code>findViewById()</code> method is relatively time consuming, even though it is not as bad as XML inflating.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterperformance_convertview\""></a>8.3. Avoiding layout inflation and object creation<br><br></div><br>A <code>ListView</code> typically contains more data than the number of displayed rows. If the user scrolls the list, then rows and their associated views are being scrolled out of the visible area. The Java objects which represents the rows can be reused for newly visible rows.<br><br>If Android determines that a row is not visible anymore, it allows the <code>getView()</code> of the adapter method to reuse the associated view via the <code>convertView</code> parameter.<br><br>The adapter can assign new data to the views contained in the view hierarchy of the <code>convertView</code>. This avoids inflating an XML file and creating new Java objects.<br><br>In case Android cannot reuse a row, the Android system passes <code>null</code> to the <code>convertView</code> parameter. Therefore the adapter implementation needs to check for this.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterperformance_holder\""></a>8.4. Holder Pattern<br><br></div><br>The <em>View Holder</em> pattern allows to avoid the <code>findViewById()</code> method in the adapter.<br><br>A <code>ViewHolder</code> class is a static inner class in your adapter which holds references to the relevant views. in your layout. This reference is assigned to the row view as a tag via the <code>setTag()</code> method.<br><br>If we receive a <code>convertView</code> object, we can get the instance of the <code>ViewHolder</code> via the <code>getTag()</code> method and assign the new attributes to the views via the <code>ViewHolder</code> reference.<br><br>While this sounds complex this is approximately 15 % faster then using the <code>findViewById()</code> method.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"adapterperformance_example\""></a>8.5. Example<br><br></div><br>The following code shows a performance optimized adapter implementation which reuses existing views and implements the holder pattern.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.app.Activity;<br>import android.view.LayoutInflater;<br>import android.view.View;<br>import android.view.ViewGroup;<br>import android.widget.ArrayAdapter;<br>import android.widget.ImageView;<br>import android.widget.TextView;<br><br>public class MyPerformanceArrayAdapter extends ArrayAdapter&lt;String&gt; {<br>  private final Activity context;<br>  private final String[] names;<br><br>  static class ViewHolder {<br>    public TextView text;<br>    public ImageView image;<br>  }<br><br>  public MyPerformanceArrayAdapter(Activity context, String[] names) {<br>    super(context, R.layout.rowlayout, names);<br>    this.context = context;<br>    this.names = names;<br>  }<br><br>  @Override<br>  public View getView(int position, View convertView, ViewGroup parent) {<br>    View rowView = convertView;<br>    // reuse views<br>    if (rowView == null) {<br>      LayoutInflater inflater = context.getLayoutInflater();<br>      rowView = inflater.inflate(R.layout.rowlayout, null);<br>      // configure view holder<br>      ViewHolder viewHolder = new ViewHolder();<br>      viewHolder.text = (TextView) rowView.findViewById(R.id.TextView01);<br>      viewHolder.image = (ImageView) rowView<br>          .findViewById(R.id.ImageView01);<br>      rowView.setTag(viewHolder);<br>    }<br><br>    // fill data<br>    ViewHolder holder = (ViewHolder) rowView.getTag();<br>    String s = names[position];<br>    holder.text.setText(s);<br>    if (s.startsWith(\”Windows7\”) || s.startsWith(\”iPhone\”)<br>        || s.startsWith(\”Solaris\”)) {<br>      holder.image.setImageResource(R.drawable.no);<br>    } else {<br>      holder.image.setImageResource(R.drawable.ok);<br>    }<br><br>    return rowView;<br>  }<br>}</pre><br>&nbsp;<br><br></div><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"listview_selection\""></a>9. Storing the selection of a view<br><br></div><br>By default a <code>ListView</code> has no selection mode active. You can activate it via the <code>setChoiceMode()</code> method call. Pass<code>ListView.CHOICE_MODE_MULTIPLE</code> for multiple selections or <code>ListView.CHOICE_MODE_SINGLE</code> for single selections to this method.<br><br>To get the selected items of a <code>ListView</code>, use the <code>getCheckedItemPosition()</code> for a single selection method or<code>listView.getCheckedItemPositions()</code> for multiple selections. . If you have stable ID, you could also use the<code>getCheckedItemIds()</code> method to get the selected IDs.<br><br>Android already provides a default layout for this: the <code>android.R.layout.simple_list_item_multiple_choice</code> layout which contains a configured <code>CheckedTextView</code> view.<br><br>The following activities demonstrate how to use these selection modes. If you use these modes, the <code>ListView</code>stores the selected values. It is not persisted in your data model.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package com.vogella.android.listview.selection.multi;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.view.Menu;<br>import android.view.MenuItem;<br>import android.widget.ArrayAdapter;<br>import android.widget.ListView;<br>import android.widget.Toast;<br><br>import com.vogella.android.listview.selection.R;<br><br>public class MainActivity extends ListActivity {<br><br>  @Override<br>  protected void onCreate(Bundle savedInstanceState) {<br>    super.onCreate(savedInstanceState);<br>    String[] values = new String[] { \”a\”, \”b\”, \”c\”, \”d\”, \”e\”, \”f\”, \”g\”,<br>        \”h\”, \”i\”, \”j\”, \”k\”, \”l\”, \”m\”, \”n\”, \”o\”, \”p\”, \”q\”, \”r\”, \”s\”,<br>        \”t\”, \”u\”, \”w\”, \”x\”, \”y\”, \”z\” };<br><br>    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,<br>        android.R.layout.simple_list_item_multiple_choice, values);<br>    setListAdapter(adapter);<br>    getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE);<br>  }<br><br>  @Override<br>  public boolean onCreateOptionsMenu(Menu menu) {<br>    getMenuInflater().inflate(R.menu.main, menu);<br>    return true;<br>  }<br><br>  @Override<br>  public boolean onOptionsItemSelected(MenuItem item) {<br>    Toast.makeText(this,<br>        String.valueOf(getListView().getCheckedItemCount()),<br>        Toast.LENGTH_LONG).show();<br>    return true;<br>  }<br>}</pre><br>&nbsp;<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package com.vogella.android.listview.selection.single;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.view.Menu;<br>import android.view.MenuItem;<br>import android.widget.ArrayAdapter;<br>import android.widget.ListView;<br>import android.widget.Toast;<br><br>public class MainActivity extends ListActivity {<br><br>  @Override<br>  protected void onCreate(Bundle savedInstanceState) {<br>    super.onCreate(savedInstanceState);<br>    String[] values = new String[] { \”a\”, \”b\”, \”c\”, \”d\”, \”e\”, \”f\”, \”g\”,<br>        \”h\”, \”i\”, \”j\”, \”k\”, \”l\”, \”m\”, \”n\”, \”o\”, \”p\”, \”q\”, \”r\”, \”s\”,<br>        \”t\”, \”u\”, \”w\”, \”x\”, \”y\”, \”z\” };<br><br>    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,<br>        android.R.layout.simple_list_item_single_choice, values);<br>    setListAdapter(adapter);<br>    getListView().setChoiceMode(ListView.CHOICE_MODE_SINGLE);<br>  }<br><br>  @Override<br>  public boolean onCreateOptionsMenu(Menu menu) {<br>    getMenuInflater().inflate(R.menu.main, menu);<br>    return true;<br>  }<br><br>  @Override<br>  public boolean onOptionsItemSelected(MenuItem item) {<br>    Toast.makeText(this,<br>        String.valueOf(getListView().getCheckedItemCount()),<br>        Toast.LENGTH_LONG).show();<br>    return true;<br>  }<br>}</pre><br>&nbsp;<br><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"listview_actionbar\""></a>10. Contextual action mode for ListViews<br><br></div><br>The following assumes that you already familiar with the concept of the <em>ActionBar</em> and contextual action mode in general. This part will explain how to use contextual action mode for a <code>ListView</code> selection.<br><br>To assign a contextual action mode to a long click on an individual item, use the method<code>setOnItemLongClickListener()</code> on <code>ListView</code>. This methods includes information about the selected item. In this method you can start the <code>ActionMode</code>.<br><br>The following examples demonstrate that. It assumes that you have a menu XML file defined called<code>rowselection.xml</code> and that this menu contains one entry with the <em><code>@+id/menuitem1_show</code></em> ID.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.view.ActionMode;<br>import android.view.Menu;<br>import android.view.MenuInflater;<br>import android.view.MenuItem;<br>import android.view.View;<br>import android.widget.AdapterView;<br>import android.widget.AdapterView.OnItemLongClickListener;<br>import android.widget.Toast;<br><br>public class MyListActivityActionbar extends ListActivity {<br><br>  protected Object mActionMode;<br>  public int selectedItem = -1;<br><br>  public void onCreate(Bundle icicle) {<br>    super.onCreate(icicle);<br>    setContentView(R.layout.main);<br>    String[] values = new String[] { \”Android\”, \”iPhone\”, \”WindowsMobile\”,<br>        \”Blackberry\”, \”WebOS\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”,<br>        \”Linux\”, \”OS/2\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”, \”Linux\”,<br>        \”OS/2\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”, \”Linux\”, \”OS/2\” };<br><br>    MySimpleArrayAdapter adapter = new MySimpleArrayAdapter(this, values);<br>    setListAdapter(adapter);<br><br>    getListView().setOnItemLongClickListener(new OnItemLongClickListener() {<br><br>      @Override<br>      public boolean onItemLongClick(AdapterView&lt;?&gt; parent, View view,<br>          int position, long id) {<br><br>        if (mActionMode != null) {<br>          return false;<br>        }<br>        selectedItem = position;<br><br>        // start the CAB using the ActionMode.Callback defined above<br>        mActionMode = MyListActivityActionbar.this<br>            .startActionMode(mActionModeCallback);<br>        view.setSelected(true);<br>        return true;<br>      }<br>    });<br>  }<br><br>  private ActionMode.Callback mActionModeCallback = new ActionMode.Callback() {<br><br>    // called when the action mode is created; startActionMode() was called<br>    public boolean onCreateActionMode(ActionMode mode, Menu menu) {<br>      // Inflate a menu resource providing context menu items<br>      MenuInflater inflater = mode.getMenuInflater();<br>      // assumes that you have \”contexual.xml\” menu resources<br>      inflater.inflate(R.menu.rowselection, menu);<br>      return true;<br>    }<br><br>    // the following method is called each time<br>    // the action mode is shown. Always called after<br>    // onCreateActionMode, but<br>    // may be called multiple times if the mode is invalidated.<br>    public boolean onPrepareActionMode(ActionMode mode, Menu menu) {<br>      return false; // Return false if nothing is done<br>    }<br><br>    // called when the user selects a contextual menu item<br>    public boolean onActionItemClicked(ActionMode mode, MenuItem item) {<br>      switch (item.getItemId()) {<br>      case R.id.menuitem1_show:<br>        show();<br>        // the Action was executed, close the CAB<br>        mode.finish();<br>        return true;<br>      default:<br>        return false;<br>      }<br>    }<br><br>    // called when the user exits the action mode<br>    public void onDestroyActionMode(ActionMode mode) {<br>      mActionMode = null;<br>      selectedItem = -1;<br>    }<br>  };<br><br>  private void show() {<br>    Toast.makeText(MyListActivityActionbar.this,<br>        String.valueOf(selectedItem), Toast.LENGTH_LONG).show();<br>  }<br>}</pre><br>&nbsp;<br><br>If you start your application and long press on an item in the list, you get your contextual action bar.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"listview_undoaction\""></a>11. Implementing undo for an action<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listview_undoaction1\""></a>11.1. When should you offer an undo action?<br><br></div><br>It is good practice to allow the user to undo critical actions. Such a critical action is, for example, the deletion of list items.<br><br>A proven pattern to handle this undo option is to offer a selection at the end of the screen. This selection vanishes after a predefined time or once the user continues to interact with the application.<br><br>For example, the Gmail application implements such a behavior.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listview_undoaction2\""></a>11.2. Example<br><br></div><br>The following description contains an example for implementing an undo action. It uses an animation to phase out the undo button automatically out after a while.<br><br>For this example create a new project called <em>com.vogella.android.userinterface.undo</em> based on the <em>BlankTemplate_template.<br><br>Create the following layout for your _activity</em>. It uses a <code>FrameLayout</code> to show two different parts of the user interface. The button bar is initially hidden. The button uses a drawable. Either add such a drawable to your project or remove the reference.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">&lt;FrameLayout xmlns:android=\”<a href="http://schemas.android.com/apk/res/android\" target="_blank" rel="external">http://schemas.android.com/apk/res/android\</a>“<br>    xmlns:tools=\”<a href="http://schemas.android.com/tools\" target="_blank" rel="external">http://schemas.android.com/tools\</a>“<br>    android:layout<em>width=\”match_parent\”<br>    android:layout_height=\”match_parent\” &gt;<br><br>    &lt;RelativeLayout<br>        android:layout_width=\”match_parent\”<br>        android:layout_height=\”match_parent\”<br>        tools:context=\”.MainActivity\” &gt;<br><br>        &lt;ListView<br>            android:id=\”@+id/listview\”<br>            android:layout_width=\”match_parent\”<br>            android:layout_height=\”match_parent\” &gt;<br>        &lt;/ListView&gt;<br>    &lt;/RelativeLayout&gt;<br><br>    &lt;LinearLayout<br>        android:id=\”@+id/undobar\”<br>        android:visibility=\”gone\”<br>        android:layout_width=\”wrap_content\”<br>        android:layout_height=\”wrap_content\”<br>        android:layout_gravity=\”bottom|center_horizontal\”<br>        android:layout_margin=\”20dp\”<br>        android:alpha=\”100\”<br>        android:background=\”#808080\”<br>        android:dividerPadding=\”11dp\”<br>        android:padding=\”4dp\” &gt;<br><br>        &lt;TextView<br>            android:id=\”@+id/undobar_message\”<br>            android:layout_width=\”wrap_content\”<br>            android:layout_height=\”wrap_content\”<br>            android:text=\”Deleted\”<br>            android:textAppearance=\”?android:attr/textAppearanceMedium\”<br>            android:textColor=\”#fff\” /&gt;<br><br>        &lt;Button<br>            android:id=\”@+id/undobar_button\”<br>            android:layout_width=\”wrap_content\”<br>            android:layout_height=\”wrap_content\”<br>            android:layout_marginLeft=\”30dp\”<br>            android:onClick=\”onClick\”<br>            android:background=\”#808080\”<br>            android:drawableLeft=\”@drawable/ic_undobar_undo\”<br>            android:text=\”Undo\”<br>            android:textAppearance=\”?android:attr/textAppearanceMedium\”<br>            android:textColor=\”#fff\” /&gt;<br>    &lt;/LinearLayout&gt;<br><br>&lt;/FrameLayout&gt;</em></pre><br>&nbsp;<br><br>Change your _activity so that it is similar to the following code. The Android project wizard in Eclipse already generated an <code>ActionBar</code> entry. This entry is used in the following code. If in doubt, create your own <code>ActionBar</code> entry.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package com.vogella.android.userinterface.undo;<br><br>import android.app.Activity;<br>import android.os.Bundle;<br>import android.view.Menu;<br>import android.view.MenuItem;<br>import android.view.View;<br>import android.widget.ArrayAdapter;<br>import android.widget.ListView;<br>import android.widget.Toast;<br><br>import com.vogella.android.actionbar.undo.R;<br><br>public class MainActivity extends Activity {<br><br>  private View viewContainer;<br><br>  @Override<br>  protected void onCreate(Bundle savedInstanceState) {<br>    super.onCreate(savedInstanceState);<br>    setContentView(R.layout.activity<em>main);<br>    ListView l = (ListView) findViewById(R.id.listview);<br>    String[] values = new String[] { \”Ubuntu\”, \”Android\”, \”iPhone\”,<br>        \”Windows\”, \”Ubuntu\”, \”Android\”, \”iPhone\”, \”Windows\” };<br>    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,<br>        android.R.layout.simple_list_item_1, values);<br>    viewContainer = findViewById(R.id.undobar);<br>    l.setAdapter(adapter);<br>  }<br><br>  @Override<br>  public boolean onCreateOptionsMenu(Menu menu) {<br>    // Inflate the menu; this adds items to the action bar if it is present.<br>    getMenuInflater().inflate(R.menu.activity_main, menu);<br>    return true;<br>  }<br><br>  @Override<br>  public boolean onOptionsItemSelected(MenuItem item) {<br>    showUndo(viewContainer);<br>    return true;<br>  }<br><br>  public void onClick(View view) {<br>    Toast.makeText(this, \”Deletion undone\”, Toast.LENGTH_LONG).show();<br>    viewContainer.setVisibility(View.GONE);<br>  }<br><br>  public static void showUndo(final View viewContainer) {<br>    viewContainer.setVisibility(View.VISIBLE);<br>    viewContainer.setAlpha(1);<br>    viewContainer.animate().alpha(0.4f).setDuration(5000)<br>        .withEndAction(new Runnable() {<br><br>          @Override<br>          public void run() {<br>            viewContainer.setVisibility(View.GONE);<br>          }<br>        });<br><br>  }<br>}</em></pre><br>&nbsp;<br><br>If you select the entry in the _ActionBar, the button bar becomes visible for 5 seconds.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br></div><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"listsactivity_performance\""></a>12. Performance Optimization<br><br></div><br>The following will implement a performance optimized version of the adapter from the previous example.<br><br>Create the following <code>MyPerformanceArrayAdapter</code> class.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.app.Activity;<br>import android.view.LayoutInflater;<br>import android.view.View;<br>import android.view.ViewGroup;<br>import android.widget.ArrayAdapter;<br>import android.widget.ImageView;<br>import android.widget.TextView;<br><br>public class MyPerformanceArrayAdapter extends ArrayAdapter&lt;String&gt; {<br>  private final Activity context;<br>  private final String[] names;<br><br>  static class ViewHolder {<br>    public TextView text;<br>    public ImageView image;<br>  }<br><br>  public MyPerformanceArrayAdapter(Activity context, String[] names) {<br>    super(context, R.layout.rowlayout, names);<br>    this.context = context;<br>    this.names = names;<br>  }<br><br>  @Override<br>  public View getView(int position, View convertView, ViewGroup parent) {<br>    View rowView = convertView;<br>    // reuse views<br>    if (rowView == null) {<br>      LayoutInflater inflater = context.getLayoutInflater();<br>      rowView = inflater.inflate(R.layout.rowlayout, null);<br>      // configure view holder<br>      ViewHolder viewHolder = new ViewHolder();<br>      viewHolder.text = (TextView) rowView.findViewById(R.id.TextView01);<br>      viewHolder.image = (ImageView) rowView<br>          .findViewById(R.id.ImageView01);<br>      rowView.setTag(viewHolder);<br>    }<br><br>    // fill data<br>    ViewHolder holder = (ViewHolder) rowView.getTag();<br>    String s = names[position];<br>    holder.text.setText(s);<br>    if (s.startsWith(\”Windows7\”) || s.startsWith(\”iPhone\”)<br>        || s.startsWith(\”Solaris\”)) {<br>      holder.image.setImageResource(R.drawable.no);<br>    } else {<br>      holder.image.setImageResource(R.drawable.ok);<br>    }<br><br>    return rowView;<br>  }<br>}</pre><br>&nbsp;<br><br>Use your new adapter in your <em>activity</em>. If you run the application it should look the same but it will be much faster, especially for large datasets.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br><br>public class MyListActivity extends ListActivity {<br>  public void onCreate(Bundle icicle) {<br>    super.onCreate(icicle);<br>    String[] values = new String[] { \”Android\”, \”iPhone\”, \”WindowsMobile\”,<br>        \”Blackberry\”, \”WebOS\”, \”Ubuntu\”, \”Windows7\”, \”Max OS X\”,<br>        \”Linux\”, \”OS/2\” };<br>    setListAdapter(new MyPerformanceArrayAdapter(this, values));<br>  }<br><br>}</pre><br>&nbsp;<br><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"tutorial_twolistitems\""></a>13. Tutorial: How to display two items in a ListView<br><br></div><br>You can use the <code>SimpleAdapter</code> class to show the data of two elements. This class expects a Array of Strings (<code>from</code>data) in which the fields of the input data are defined. It also requires a Array of ints which defines the IDs of the widgets in the layout for the row to which these fields are mapped.<br><br>The actual data is then a list of Maps. The Map defines for each field in the from data a value.<br><br>The following shows an example which reuses an predefined layout from Android for the row.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import java.util.ArrayList;<br>import java.util.HashMap;<br>import java.util.Map;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.widget.SimpleAdapter;<br><br>public class MyTwoListItemsActivity extends ListActivity {<br>  protected void onCreate(Bundle savedInstanceState) {<br>    super.onCreate(savedInstanceState);<br>    ArrayList&lt;Map&lt;String, String&gt;&gt; list = buildData();<br>    String[] from = { \”name\”, \”purpose\” };<br>    int[] to = { android.R.id.text1, android.R.id.text2 };<br><br>    SimpleAdapter adapter = new SimpleAdapter(this, list,<br>        android.R.layout.simple_list_item_2, from, to);<br>    setListAdapter(adapter);<br>  }<br><br>  private ArrayList&lt;Map&lt;String, String&gt;&gt; buildData() {<br>    ArrayList&lt;Map&lt;String, String&gt;&gt; list = new ArrayList&lt;Map&lt;String, String&gt;&gt;();<br>    list.add(putData(\”Android\”, \”Mobile\”));<br>    list.add(putData(\”Windows7\”, \”Windows7\”));<br>    list.add(putData(\”iPhone\”, \”iPhone\”));<br>    return list;<br>  }<br><br>  private HashMap&lt;String, String&gt; putData(String name, String purpose) {<br>    HashMap&lt;String, String&gt; item = new HashMap&lt;String, String&gt;();<br>    item.put(\”name\”, name);<br>    item.put(\”purpose\”, purpose);<br>    return item;<br>  }<br><br>}</pre><br>&nbsp;<br><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"listviewselection\""></a>14. Selecting multiple items in the ListView<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listviewselection_data\""></a>14.1. Interaction between the model and Listview<br><br></div><br>Frequently you need to select items in your <code>ListView</code>. As the row of the <code>ListView</code> are getting recycled you cannot store the selection on the <code>View</code> level.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br>Selection is just one possible example but you can imange other interaction between your row and model.<br><br>To persist the selection you have to update your data model with the selected state.<br><br>To update the data model in your <code>ListView</code> you define your own <code>Adapter</code> class. In this adapter class you attach a listener to the <code>View</code> which is responsible for selecting the model element. If selected you update the state in the model which you can add as a tag to the View to have access to it.<br><br>The following example demonstrates how to use standard Java object and how to interact from the <code>Views</code> with the model.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"listadvanced_interactive\""></a>14.2. Tutorial: Domain Model and Rows interaction<br><br></div><br>Continue to use the <code>de.vogella.android.listactivity</code> project.<br><br>Create the following <code>Model</code> which hold the name and the information if this element is currently selected.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>public class Model {<br><br>  private String name;<br>  private boolean selected;<br><br>  public Model(String name) {<br>    this.name = name;<br>    selected = false;<br>  }<br><br>  public String getName() {<br>    return name;<br>  }<br><br>  public void setName(String name) {<br>    this.name = name;<br>  }<br><br>  public boolean isSelected() {<br>    return selected;<br>  }<br><br>  public void setSelected(boolean selected) {<br>    this.selected = selected;<br>  }<br>}</pre><br>&nbsp;<br><br>Create the following new layout file called <code>rowbuttonlayout.xml</code>.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">&lt;?xml version=\”1.0\” encoding=\”utf-8\”?&gt;<br>&lt;RelativeLayout xmlns:android=\”<a href="http://schemas.android.com/apk/res/android\" target="_blank" rel="external">http://schemas.android.com/apk/res/android\</a>“<br>    android:layout<em>width=\”match_parent\”<br>    android:layout_height=\”wrap_content\” &gt;<br><br>    &lt;TextView<br>        android:id=\”@+id/label\”<br>        android:layout_width=\”wrap_content\”<br>        android:layout_height=\”wrap_content\”<br>        android:text=\”@+id/label\”<br>        android:textSize=\”30px\” &gt;<br>    &lt;/TextView&gt;<br><br>    &lt;CheckBox<br>        android:id=\”@+id/check\”<br>        android:layout_width=\”wrap_content\”<br>        android:layout_height=\”wrap_content\”<br>        android:layout_alignParentRight=\”true\”<br>        android:layout_marginLeft=\”4px\”<br>        android:layout_marginRight=\”10px\” &gt;<br>    &lt;/CheckBox&gt;<br><br>&lt;/RelativeLayout&gt;</em></pre><br>&nbsp;<br><br>Create the following <code>Adapter</code>. This adapter adds a listener on the <code>Checkbox</code> view . If the checkbox is selected the underlying data of the model is changed. <code>Checkbox</code> gets the corresponding model element assigned via the<code>getTag()</code> method.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import java.util.List;<br><br>import android.app.Activity;<br>import android.view.LayoutInflater;<br>import android.view.View;<br>import android.view.ViewGroup;<br>import android.widget.ArrayAdapter;<br>import android.widget.CheckBox;<br>import android.widget.CompoundButton;<br>import android.widget.TextView;<br><br>public class InteractiveArrayAdapter extends ArrayAdapter&lt;Model&gt; {<br><br>  private final List&lt;Model&gt; list;<br>  private final Activity context;<br><br>  public InteractiveArrayAdapter(Activity context, List&lt;Model&gt; list) {<br>    super(context, R.layout.rowbuttonlayout, list);<br>    this.context = context;<br>    this.list = list;<br>  }<br><br>  static class ViewHolder {<br>    protected TextView text;<br>    protected CheckBox checkbox;<br>  }<br><br>  @Override<br>  public View getView(int position, View convertView, ViewGroup parent) {<br>    View view = null;<br>    if (convertView == null) {<br>      LayoutInflater inflator = context.getLayoutInflater();<br>      view = inflator.inflate(R.layout.rowbuttonlayout, null);<br>      final ViewHolder viewHolder = new ViewHolder();<br>      viewHolder.text = (TextView) view.findViewById(R.id.label);<br>      viewHolder.checkbox = (CheckBox) view.findViewById(R.id.check);<br>      viewHolder.checkbox<br>          .setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {<br><br>            @Override<br>            public void onCheckedChanged(CompoundButton buttonView,<br>                boolean isChecked) {<br>              Model element = (Model) viewHolder.checkbox<br>                  .getTag();<br>              element.setSelected(buttonView.isChecked());<br><br>            }<br>          });<br>      view.setTag(viewHolder);<br>      viewHolder.checkbox.setTag(list.get(position));<br>    } else {<br>      view = convertView;<br>      ((ViewHolder) view.getTag()).checkbox.setTag(list.get(position));<br>    }<br>    ViewHolder holder = (ViewHolder) view.getTag();<br>    holder.text.setText(list.get(position).getName());<br>    holder.checkbox.setChecked(list.get(position).isSelected());<br>    return view;<br>  }<br>}</pre><br>&nbsp;<br><br>Finally change your _activity to the following.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import java.util.ArrayList;<br>import java.util.List;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.widget.ArrayAdapter;<br><br>public class MyList extends ListActivity {<br><br>/<em>* Called when the activity is first created. </em>/<br><br>  public void onCreate(Bundle icicle) {<br>    super.onCreate(icicle);<br>    // create an array of Strings, that will be put to our ListActivity<br>    ArrayAdapter&lt;Model&gt; adapter = new InteractiveArrayAdapter(this,<br>        getModel());<br>    setListAdapter(adapter);<br>  }<br><br>  private List&lt;Model&gt; getModel() {<br>    List&lt;Model&gt; list = new ArrayList&lt;Model&gt;();<br>    list.add(get(\”Linux\”));<br>    list.add(get(\”Windows7\”));<br>    list.add(get(\”Suse\”));<br>    list.add(get(\”Eclipse\”));<br>    list.add(get(\”Ubuntu\”));<br>    list.add(get(\”Solaris\”));<br>    list.add(get(\”Android\”));<br>    list.add(get(\”iPhone\”));<br>    // Initially select one of the items<br>    list.get(1).setSelected(true);<br>    return list;<br>  }<br><br>  private Model get(String s) {<br>    return new Model(s);<br>  }<br><br>}</pre><br><div class="\"hl-tag\"" style="\"color:" #008800;\"=""></div><br>If you start your app you should be able to flag items. These changes will be reflected in your model.<br><br></div><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"expandablelistview\""></a>15. Implementing an expandable ListView<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"expandablelistview_concept\""></a>15.1. ExpandableListView<br><br></div><br>The <code>ExpandableListView</code> is similar to <code>ListView</code> but allow you to define groups and details for this group.<code>ExpandableListView</code> expects and adapter of type <code>BaseExpandableListAdapter</code>.<br><br>In this case you have to define two layouts, one for the group and another one for the details row.<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"expandablelistview_example\""></a>15.2. ExpandableListView example<br><br></div><br>In the following example you create an expandable listview similar to the following screenshot.<br><br>&nbsp;<br><div class="\"mediaobject\""><img src="\" alt="\"></div><br>&nbsp;<br><br>Create a project called <em>com.vogella.android.listview.expandable</em> with the activity called <code>MainActivity</code>.<br><br>Create or adjust the following layout files. First <code>layout/activity_main.xml</code>.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">&lt;LinearLayout xmlns:android=\”<a href="http://schemas.android.com/apk/res/android\" target="_blank" rel="external">http://schemas.android.com/apk/res/android\</a>“<br>    xmlns:tools=\”<a href="http://schemas.android.com/tools\" target="_blank" rel="external">http://schemas.android.com/tools\</a>“<br>    android:id=\”@+id/LinearLayout1\”<br>    android:layout_width=\”match_parent\”<br>    android:layout_height=\”match_parent\”<br>    android:paddingBottom=\”@dimen/activity_vertical_margin\”<br>    android:paddingLeft=\”@dimen/activity_horizontal_margin\”<br>    android:paddingRight=\”@dimen/activity_horizontal_margin\”<br>    android:paddingTop=\”@dimen/activity_vertical_margin\”<br>    tools:context=\”.MainActivity\” &gt;<br><br>    &lt;ExpandableListView<br>        android:id=\”@+id/listView\”<br>        android:layout_width=\”match_parent\”<br>        android:layout_height=\”wrap_content\” &gt;<br>    &lt;/ExpandableListView&gt;<br><br>&lt;/LinearLayout&gt;</pre><br>&nbsp;<br><br>Afterwards create <code>layout/listrow_group.xml</code>.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">&lt;CheckedTextView xmlns:android=\”<a href="http://schemas.android.com/apk/res/android\" target="_blank" rel="external">http://schemas.android.com/apk/res/android\</a>“<br>    xmlns:tools=\”<a href="http://schemas.android.com/tools\" target="_blank" rel="external">http://schemas.android.com/tools\</a>“<br>    android:id=\”@+id/textView1\”<br>    android:layout_width=\”wrap_content\”<br>    android:layout_height=\”?android:attr/listPreferredItemHeight\”<br>    android:layout_marginLeft=\”8dp\”<br>    android:drawableRight=\”@drawable/ic_launcher\”<br>    android:gravity=\”left\”<br>    android:paddingLeft=\”32dp\”<br>    android:paddingTop=\”8dp\”<br>    android:text=\”Test\”<br>    android:textSize=\”14sp\”<br>    android:textAlignment=\”textEnd\”<br>    android:textStyle=\”bold\” /&gt;</pre><br>&nbsp;<br><br>The last required layout is <code>layout/listrow_details.xml</code>.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">&lt;LinearLayout xmlns:android=\”<a href="http://schemas.android.com/apk/res/android\" target="_blank" rel="external">http://schemas.android.com/apk/res/android\</a>“<br>    xmlns:tools=\”<a href="http://schemas.android.com/tools\" target="_blank" rel="external">http://schemas.android.com/tools\</a>“<br>    android:layout_width=\”match_parent\”<br>    android:layout_height=\”40dp\”<br>    android:clickable=\”true\”<br>    android:orientation=\”vertical\”<br>    android:paddingLeft=\”40dp\”<br>    tools:context=\”.MainActivity\” &gt;<br><br>    &lt;TextView<br>        android:id=\”@+id/textView1\”<br>        android:layout_width=\”wrap_content\”<br>        android:layout_height=\”wrap_content\”<br>        android:drawableLeft=\”@drawable/ic_launcher\”<br>        android:drawablePadding=\”5dp\”<br>        android:gravity=\”center_vertical\”<br>        android:text=\”@string/hello_world\”<br>        android:textSize=\”14sp\”<br>        android:textStyle=\”bold\” &gt;<br>    &lt;/TextView&gt;<br><br>    &lt;View<br>        android:layout_width=\”match_parent\”<br>        android:layout_height=\”1dp\”<br>        android:background=\”@android:color/black\” /&gt;<br><br>&lt;/LinearLayout&gt;</pre><br>&nbsp;<br><br>Create the following class which hold your domain model for the <code>ExpandableListView</code>.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package com.vogella.android.listview.expandable;<br><br>import java.util.ArrayList;<br>import java.util.List;<br><br>public class Group {<br><br>  public String string;<br>  public final List&lt;String&gt; children = new ArrayList&lt;String&gt;();<br><br>  public Group(String string) {<br>    this.string = string;<br>  }<br><br>}</pre><br>&nbsp;<br><br>Finally create the adapter as described by the following listing and change the activity to the code provided below.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package com.vogella.android.listview.expandable;<br><br>import android.app.Activity;<br>import android.util.SparseArray;<br>import android.view.LayoutInflater;<br>import android.view.View;<br>import android.view.View.OnClickListener;<br>import android.view.ViewGroup;<br>import android.widget.BaseExpandableListAdapter;<br>import android.widget.CheckedTextView;<br>import android.widget.TextView;<br>import android.widget.Toast;<br><br>public class MyExpandableListAdapter extends BaseExpandableListAdapter {<br><br>  private final SparseArray&lt;Group&gt; groups;<br>  public LayoutInflater inflater;<br>  public Activity activity;<br><br>  public MyExpandableListAdapter(Activity act, SparseArray&lt;Group&gt; groups) {<br>    activity = act;<br>    this.groups = groups;<br>    inflater = act.getLayoutInflater();<br>  }<br><br>  @Override<br>  public Object getChild(int groupPosition, int childPosition) {<br>    return groups.get(groupPosition).children.get(childPosition);<br>  }<br><br>  @Override<br>  public long getChildId(int groupPosition, int childPosition) {<br>    return 0;<br>  }<br><br>  @Override<br>  public View getChildView(int groupPosition, final int childPosition,<br>      boolean isLastChild, View convertView, ViewGroup parent) {<br>    final String children = (String) getChild(groupPosition, childPosition);<br>    TextView text = null;<br>    if (convertView == null) {<br>      convertView = inflater.inflate(R.layout.listrow_details, null);<br>    }<br>    text = (TextView) convertView.findViewById(R.id.textView1);<br>    text.setText(children);<br>    convertView.setOnClickListener(new OnClickListener() {<br>      @Override<br>      public void onClick(View v) {<br>        Toast.makeText(activity, children,<br>            Toast.LENGTH_SHORT).show();<br>      }<br>    });<br>    return convertView;<br>  }<br><br>  @Override<br>  public int getChildrenCount(int groupPosition) {<br>    return groups.get(groupPosition).children.size();<br>  }<br><br>  @Override<br>  public Object getGroup(int groupPosition) {<br>    return groups.get(groupPosition);<br>  }<br><br>  @Override<br>  public int getGroupCount() {<br>    return groups.size();<br>  }<br><br>  @Override<br>  public void onGroupCollapsed(int groupPosition) {<br>    super.onGroupCollapsed(groupPosition);<br>  }<br><br>  @Override<br>  public void onGroupExpanded(int groupPosition) {<br>    super.onGroupExpanded(groupPosition);<br>  }<br><br>  @Override<br>  public long getGroupId(int groupPosition) {<br>    return 0;<br>  }<br><br>  @Override<br>  public View getGroupView(int groupPosition, boolean isExpanded,<br>      View convertView, ViewGroup parent) {<br>    if (convertView == null) {<br>      convertView = inflater.inflate(R.layout.listrow_group, null);<br>    }<br>    Group group = (Group) getGroup(groupPosition);<br>    ((CheckedTextView) convertView).setText(group.string);<br>    ((CheckedTextView) convertView).setChecked(isExpanded);<br>    return convertView;<br>  }<br><br>  @Override<br>  public boolean hasStableIds() {<br>    return false;<br>  }<br><br>  @Override<br>  public boolean isChildSelectable(int groupPosition, int childPosition) {<br>    return false;<br>  }<br>}</pre><br>&nbsp;<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package com.vogella.android.listview.expandable;<br><br>import java.util.ArrayList;<br><br>import android.app.Activity;<br>import android.os.Bundle;<br>import android.util.SparseArray;<br>import android.view.Menu;<br>import android.widget.ExpandableListView;<br><br>public class MainActivity extends Activity {<br>  // more efficient than HashMap for mapping integers to objects<br>  SparseArray&lt;Group&gt; groups = new SparseArray&lt;Group&gt;();<br><br>  @Override<br>  protected void onCreate(Bundle savedInstanceState) {<br>    super.onCreate(savedInstanceState);<br>    setContentView(R.layout.activity_main);<br>    createData();<br>    ExpandableListView listView = (ExpandableListView) findViewById(R.id.listView);<br>    MyExpandableListAdapter adapter = new MyExpandableListAdapter(this,<br>        groups);<br>    listView.setAdapter(adapter);<br>  }<br><br>  public void createData() {<br>    for (int j = 0; j &lt; 5; j++) {<br>      Group group = new Group(\”Test \” + j);<br>      for (int i = 0; i &lt; 5; i++) {<br>        group.children.add(\”Sub Item\” + i);<br>      }<br>      groups.append(j, group);<br>    }<br>  }<br><br>}</pre><br>&nbsp;<br><br></div><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"miscellaneous\""></a>16. Tutorial: Miscellaneous<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"miscellaneous_longclick\""></a>16.1. Adding a longclick listener to the list items<br><br></div><br>You can also add a <code>LongItemClickListener</code> to the <code>View</code>. For this receive the <code>ListView</code> via the <code>getListVIew()</code> method and set the <code>LongItemClickListener</code> via the setOnItemLongClickListener() method.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity;<br><br>import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.view.View;<br>import android.widget.AdapterView;<br>import android.widget.AdapterView.OnItemLongClickListener;<br>import android.widget.ArrayAdapter;<br>import android.widget.ListView;<br>import android.widget.Toast;<br><br>public class MyList extends ListActivity {<br><br>/<strong> Called when the activity is first created. */<br><br>  public void onCreate(Bundle icicle) {<br>    super.onCreate(icicle);<br>    // create an array of Strings, that will be put to our ListActivity<br>    String[] names = new String[] { \”Linux\”, \”Windows7\”, \”Eclipse\”, \”Suse\”,<br>        \”Ubuntu\”, \”Solaris\”, \”Android\”, \”iPhone\” };<br>    ArrayAdapter&lt;String&gt; adapter = new MyPerformanceArrayAdapter(this, names);<br>    setListAdapter(adapter);<br>    ListView list = getListView();<br>    list.setOnItemLongClickListener(new OnItemLongClickListener() {<br><br>      @Override<br>      public boolean onItemLongClick(AdapterView&lt;?&gt; parent, View view,<br>          int position, long id) {<br>        Toast.makeText(MyList.this,<br>            \”Item in position \” + position + \” clicked\”,<br>            Toast.LENGTH_LONG).show();<br>        // Return true to consume the click event. In this case the<br>        // onListItemClick listener is not called anymore.<br>        return true;<br>      }<br>    });<br>  }<br><br>  @Override<br>  protected void onListItemClick(ListView l, View v, int position, long id) {<br>    super.onListItemClick(l, v, position, id);<br>    // Get the item that was clicked<br>    Object o = this.getListAdapter().getItem(position);<br>    String keyword = o.toString();<br>    Toast.makeText(this, \”You selected: \” + keyword, Toast.LENGTH_SHORT)<br>        .show();<br><br>  }<br><br>}</strong></pre><br><div class="\"hl-tag\"" style="\"color:" #008800;\"=""></div><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"miscellaneous_headerfooter\""></a>16.2. Header and Footer<br><br></div><br>You can of course put arbitrary <code>Views</code> elements around your ListView. For example you can define a layout with two<code>TextViews</code> and a <code>ListView</code> between them. In this case the two TextViews will always be visible above the List (header) and the other will be visible below the ListView. If you want to display a list header or list footer only at the see the beginning or end of the list you can use the <code>addHeaderView()</code> method or <code>addFooterView()</code> method on the<code>ListView</code> class.<br><br>package de.vogella.android.listactivity;<br><pre class="\"lang:java" decode:true="" programlisting\"="">import android.app.ListActivity;<br>import android.os.Bundle;<br>import android.view.View;<br>import android.widget.ArrayAdapter;<br>import android.widget.ListView;<br><br>public class MyList extends ListActivity {<br><br>/ Called when the activity is first created. */<br><br>  public void onCreate(Bundle icicle) {<br>    super.onCreate(icicle);<br>    // create an array of Strings, that will be put to our ListActivity<br>    String[] names = new String[] { \”Linux\”, \”Windows7\”, \”Eclipse\”, \”Suse\”,<br>        \”Ubuntu\”, \”Solaris\”, \”Android\”, \”iPhone\”, \”Linux\”, \”Windows7\”,<br>        \”Eclipse\”, \”Suse\”, \”Ubuntu\”, \”Solaris\”, \”Android\”, \”iPhone\” };<br>    View header = getLayoutInflater().inflate(R.layout.header, null);<br>    View footer = getLayoutInflater().inflate(R.layout.footer, null);<br>    ListView listView = getListView();<br>    listView.addHeaderView(header);<br>    listView.addFooterView(footer);<br>    setListAdapter(new ArrayAdapter&lt;String&gt;(this,<br>        android.R.layout.simple_list_item_single_choice,<br>        android.R.id.text1, names));<br><br>  }<br>}</pre><br></div><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"cursor\""></a>17. SimpleCursorAdapter<br><br></div><br>In case you work with a content provider or directly with the database you can use the <code>SimpleCursorAdapter</code> to define the data for your <code>ListView</code>. The following will demonstrates how to access the Contacts ContentProvider.<br><br>Create a new Android project called \”de.vogella.android.listactivity.cursor\” with the <em>activity</em> called <em>MyListActivity</em>. Change <code>MyListActivity</code> to the following.<br><br>&nbsp;<br><pre class="\"lang:java" decode:true="" programlisting\"="">package de.vogella.android.listactivity.cursor;<br><br>import android.app.ListActivity;<br>import android.database.Cursor;<br>import android.net.Uri;<br>import android.os.Bundle;<br>import android.provider.ContactsContract;<br>import android.widget.ListAdapter;<br>import android.widget.SimpleCursorAdapter;<br><br>public class MyListActivity extends ListActivity {<br><br>/<em>* Called when the activity is first created. </em>/<br><br>  @Override<br>  public void onCreate(Bundle savedInstanceState) {<br>    super.onCreate(savedInstanceState);<br>    Cursor mCursor = getContacts();<br>    startManagingCursor(mCursor);<br>    // now create a new list adapter bound to the cursor.<br>    // SimpleListAdapter is designed for binding to a Cursor.<br>    ListAdapter adapter = new SimpleCursorAdapter(this, // Context.<br>        android.R.layout.two_line_list_item, // Specify the row template<br>                            // to use (here, two<br>                            // columns bound to the<br>                            // two retrieved cursor<br>                            // rows).<br>        mCursor, // Pass in the cursor to bind to.<br>        // Array of cursor columns to bind to.<br>        new String[] { ContactsContract.Contacts._ID,<br>            ContactsContract.Contacts.DISPLAY_NAME },<br>        // Parallel array of which template objects to bind to those<br>        // columns.<br>        new int[] { android.R.id.text1, android.R.id.text2 });<br><br>    // Bind to our new adapter.<br>    setListAdapter(adapter);<br>  }<br><br>  private Cursor getContacts() {<br>    // Run query<br>    Uri uri = ContactsContract.Contacts.CONTENT_URI;<br>    String[] projection = new String[] { ContactsContract.Contacts._ID,<br>        ContactsContract.Contacts.DISPLAY_NAME };<br>    String selection = ContactsContract.Contacts.IN_VISIBLE_GROUP + \” = \’\”<br>        + (\”1\”) + \”\’\”;<br>    String[] selectionArgs = null;<br>    String sortOrder = ContactsContract.Contacts.DISPLAY_NAME<br>        + \” COLLATE LOCALIZED ASC\”;<br><br>    return managedQuery(uri, projection, selection, selectionArgs,<br>        sortOrder);<br>  }<br><br>}<br></pre><br><div class="\"hl-tag\"" style="\"color:" #008800;\"=""></div><br>Make sure you give your application the permission to read the contacts. (Uses Permissions \”android.permission.READ_CONTACTS\” in AndroidManifest.xml)<br><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"actionbar_libraries\""></a>18. Additional Open Source libraries<br><br></div><br>Sometimes having to press a refresh button on the ActionBar to refresh data can be annoying for the user. Chris Banes has implemented an Open Source library to implement the pull to refresh pattern for a <code>Listview</code>. <a href="https://github.com/chrisbanes/Android-PullToRefresh" target="_blank" rel="external">https://github.com/chrisbanes/Android-PullToRefresh</a>.<br><br>Also you may want to use the swipe to dismiss gesture to delete items from a ListView. Roman Nurik provides an example for this at <a href="\">Android swipe-to-dismiss library</a> which Jake Wharton backported to earlier Android releases at <a href="\">SwipeToDismissNOA</a>.<br><br></div>

<div class="\"section\"" style="\"color:" #000000;\"=""><br><div class="\"titlepage\""><br><br>## <a style="\"color:" #101010;\"="" name="\"thankyou\""></a>19. Support free vogella tutorials<br><br></div><br>Maintaining high quality free online tutorials is a lot of work. Please support free tutorials by donating or by reporting typos and factual errors.<br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"thankyou\""></a>19.1. Thank you<br><br></div><br><div class="\"titlepage\""><br><br>## 20. Links and Literature<br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"sourcecode\""></a>20.1. Source Code<br><br></div><br><a href="\">Source Code of Examples</a><br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"resources_listview\""></a>20.2. ListView Resources<br><br></div><br><a href="\">ListView demo which uses 3D effects (Github)</a><br><br><a href="\">ListView with section headers (Github)</a><br><br></div><br><div class="\"section\""><br><div class="\"titlepage\""><br><br>### <a style="\"color:" #101010;\"="" name="\"resources_general\""></a>20.3. vogella Resources<br><br></div><br><a href="\">vogella Training</a> Android and Eclipse Training from the vogella team<br><br><a href="\">Android Tutorial</a> Introduction to Android Programming<br><br><a href="\">GWT Tutorial</a> Program in Java, compile to JavaScript and HTML<br><br><a href="\">Eclipse RCP Tutorial</a> Create native applications in Java<br><br><a href="\">JUnit Tutorial</a> Test your application<br><br><a href="\">Git Tutorial</a> Put all your files in a distributed version control system<br><br></div><br>&nbsp;<br><br>&nbsp;<br><br>Please consider a contribution if this article helped you.<br><br></div><br></div>
        
      </div>
    

    
      <div class="post-footer">
        

        
          <div class="post-nav">
            <div class="post-nav-prev post-nav-item">
              
                <a href="../../../06/01/android-frame-animation/">Android Frame animation模拟脉搏跳动小动画</a>
              
            </div>

            <div class="post-nav-next post-nav-item">
              
                <a href="../android-tips-round-up-2/">[译]Android小技巧(2)</a>
              
            </div>
          </div>
        

        
        
      </div>
    
  </div>



  
    <div class="comments" id="comments">
      
        <div class="ds-thread" data-thread-key="2014/05/31/using-listview-in-android/"
             data-title="[转]Using lists in Android (ListView)" data-url="http://androidperformance.com/2014/05/31/using-listview-in-android/">
        </div>

      
    </div>
  

          </div>

          
        </div>

        
<div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>

<div id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
          文章目录
        </li>
        <li class="sidebar-nav-overview" data-target="site-overview">
          站点概览
        </li>
      </ul>
    

    <div class="site-overview">
      <div class="site-author motion-element">
        <img class="site-author-image" src="../../../../images/default_avatar.jpg" alt="Gracker" />
        <p class="site-author-name">Gracker</p>
      </div>
      <p class="site-description motion-element"></p>
      <div class="site-state motion-element">
        <div class="site-state-item site-state-posts">
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">日志</span>
        </div>
        <div class="site-state-item site-state-tags">
            <span class="site-state-item-count">0</span>
            <span class="site-state-item-name">标签</span>
        </div>
        <div class="site-state-item site-state-pages">
            <span class="site-state-item-count">2</span>
            <span class="site-state-item-name">页面</span>
        </div>
      </div>

      
        <div class="feed-link motion-element">
          <a href="../../../../atom.xml">
            <i class="menu-item-icon icon-feed"></i>
            RSS
          </a>
        </div>
      

      <div class="links-of-author motion-element">
        
          
            <span class="links-of-author-item">
              <a href="https://github.com/Gracker">github</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="http://weibo.com/270099576">weibo</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="http://www.jianshu.com/users/FK4sc4/latest_articles">jianshu</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="http://www.zhihu.com/people/gracker">zhihu</a>
            </span>
          
        
      </div>

      
      

    </div>

    
      <div class="post-toc-wrap sidebar-panel-active">
        <div class="post-toc-indicator-top post-toc-indicator"></div>
        <div class="post-toc">
          
          
            <p class="post-toc-empty">此文章未包含目录</p>
          
        </div>
        <div class="post-toc-indicator-bottom post-toc-indicator"></div>
      </div>
    

  </div>
</div>


      </div>
    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2013 - 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Gracker</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="../../../../vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="../../../../vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".fancybox").fancybox();
    });
  </script>

  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="../../../../vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="../../../../vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    LogoAndMenuMotion();
    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});

    function LogoAndMenuMotion() {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        
        { e: $('.logo-line-before i'), p: { translateX: "100%" }, o: { duration: 500, sequenceQueue: false } },
        { e: $('.logo-line-after i'), p: { translateX: "-100%" }, o: { duration: 500, sequenceQueue: false } },
        
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200 } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    }


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = window.postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  
  
<script type="text/javascript" id="bootstrap.scrollspy.custom">
  /* ========================================================================
  * Bootstrap: scrollspy.js v3.3.2
  * http://getbootstrap.com/javascript/#scrollspy
  * ========================================================================
  * Copyright 2011-2015 Twitter, Inc.
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
  * ======================================================================== */

  /**
   * Custom by iissnan
   *
   * - Add a `clear.bs.scrollspy` event.
   * - Esacpe targets selector.
   */


  +function ($) {
    'use strict';

    // SCROLLSPY CLASS DEFINITION
    // ==========================

    function ScrollSpy(element, options) {
      this.$body          = $(document.body)
      this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)
      this.options        = $.extend({}, ScrollSpy.DEFAULTS, options)
      this.selector       = (this.options.target || '') + ' .nav li > a'
      this.offsets        = []
      this.targets        = []
      this.activeTarget   = null
      this.scrollHeight   = 0

      this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))
      this.refresh()
      this.process()
    }

    ScrollSpy.VERSION  = '3.3.2'

    ScrollSpy.DEFAULTS = {
      offset: 10
    }

    ScrollSpy.prototype.getScrollHeight = function () {
      return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }

    ScrollSpy.prototype.refresh = function () {
      var that          = this
      var offsetMethod  = 'offset'
      var offsetBase    = 0

      this.offsets      = []
      this.targets      = []
      this.scrollHeight = this.getScrollHeight()

      if (!$.isWindow(this.$scrollElement[0])) {
        offsetMethod = 'position'
        offsetBase   = this.$scrollElement.scrollTop()
      }

      this.$body
        .find(this.selector)
        .map(function () {
          var $el   = $(this)
          var href  = $el.data('target') || $el.attr('href')
          var $href = /^#./.test(href) && $(escapeSelector(href)) // Need to escape selector.

          return ($href
            && $href.length
            && $href.is(':visible')
            && [[$href[offsetMethod]().top + offsetBase, href]]) || null
        })
        .sort(function (a, b) { return a[0] - b[0] })
        .each(function () {
          that.offsets.push(this[0])
          that.targets.push(this[1])
        })


    }

    ScrollSpy.prototype.process = function () {
      var scrollTop    = this.$scrollElement.scrollTop() + this.options.offset
      var scrollHeight = this.getScrollHeight()
      var maxScroll    = this.options.offset + scrollHeight - this.$scrollElement.height()
      var offsets      = this.offsets
      var targets      = this.targets
      var activeTarget = this.activeTarget
      var i

      if (this.scrollHeight != scrollHeight) {
        this.refresh()
      }

      if (scrollTop >= maxScroll) {
        return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
      }

      if (activeTarget && scrollTop < offsets[0]) {
        $(this.selector).trigger('clear.bs.scrollspy')  // Add a custom event.
        this.activeTarget = null
        return this.clear()
      }

      for (i = offsets.length; i--;) {
        activeTarget != targets[i]
          && scrollTop >= offsets[i]
          && (!offsets[i + 1] || scrollTop <= offsets[i + 1])
          && this.activate(targets[i])
      }
    }

    ScrollSpy.prototype.activate = function (target) {
      this.activeTarget = target

      this.clear()

      var selector = this.selector +
        '[data-target="' + target + '"],' +
        this.selector + '[href="' + target + '"]'

      var active = $(selector)
        .parents('li')
        .addClass('active')

      if (active.parent('.dropdown-menu').length) {
        active = active
          .closest('li.dropdown')
          .addClass('active')
      }

      active.trigger('activate.bs.scrollspy')
    }

    ScrollSpy.prototype.clear = function () {
      $(this.selector)
        .parentsUntil(this.options.target, '.active')
        .removeClass('active')
    }


    // SCROLLSPY PLUGIN DEFINITION
    // ===========================

    function Plugin(option) {
      return this.each(function () {
        var $this   = $(this)
        var data    = $this.data('bs.scrollspy')
        var options = typeof option == 'object' && option

        if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
        if (typeof option == 'string') data[option]()
      })
    }

    var old = $.fn.scrollspy

    $.fn.scrollspy             = Plugin
    $.fn.scrollspy.Constructor = ScrollSpy


    // SCROLLSPY NO CONFLICT
    // =====================

    $.fn.scrollspy.noConflict = function () {
      $.fn.scrollspy = old
      return this
    }


    // SCROLLSPY DATA-API
    // ==================

    $(window).on('load.bs.scrollspy.data-api', function () {
      $('[data-spy="scroll"]').each(function () {
        var $spy = $(this)
        Plugin.call($spy, $spy.data())
      })
    })

  }(jQuery);
</script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0 && isDesktop()) {
        setTimeout(function () {
          $('.sidebar-toggle').trigger('click');
        }, 800);
      }
    });
  </script>




  

  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"grackertalk"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
  
</body>
</html>
