<!doctype html>
<html class="theme-next use-motion theme-next-next">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>




  <link rel="stylesheet" type="text/css" href="../../../../vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="../../../../css/main.css?v=0.4.0"/>





    <meta name="keywords" content="Android,Performance" />



    <link rel="alternate" href="../../../../atom.xml" title="Android Perofrmance" type="application/atom+xml" />



    <link rel="shorticon icon" type="image/x-icon" href="../../../..//favicon.ico?v=0.4.0" />




  <title> 使用Wordpress建立个人独立博客 // Android Perofrmance </title>
</head>

<body>
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Android Perofrmance</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>


  <ul id="menu" class="menu">
    
      
      <li class="menu-item menu-item-home">
        <a href="../../../..//">
          <i class="menu-item-icon icon-home"></i> <br />
          首页
        </a>
      </li>
    
      
      <li class="menu-item menu-item-categories">
        <a href="../../../..//categories">
          <i class="menu-item-icon icon-categories"></i> <br />
          分类
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="../../../..//archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          归档
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="../../../..//tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          标签
        </a>
      </li>
    
      
      <li class="menu-item menu-item-about">
        <a href="../../../..//about">
          <i class="menu-item-icon icon-about"></i> <br />
          关于
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
            
          

          <div id="posts" class="posts-expand">
            
  

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              使用Wordpress建立个人独立博客
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            发表于 2014-02-26
          
        </span>

        
          
            <span class="post-category">
              &nbsp; | &nbsp; 分类于
              
                <a href="../../../../categories/Wordpress/">Wordpress</a>

                
                

              
            </span>
          
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2014/02/26/build-your-own-blog-by-wordpress/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/26/build-your-own-blog-by-wordpress/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          <p><a href="\"><img src="\" alt="\"></a></p>
<p>配图来自网络。</p>
<h1 id="个人吐槽阶段">个人吐槽阶段</h1><p>说到建立独立博客，很多人都很不屑地说，CSDN、博客园不是也提供博客地址么？为什么要花这么大力气，自己搭建一个博客呢？举个不太恰当的例子，很多人刚毕业没钱，在外边租房子，提供租房服务的很多，一租好几年，但每个人都想拥有自己的房子。这独立博客就相当于自己的房子，自己的房子用起来，当然就要比租的房子用起来要那么用心一点，有空就搞个装修啊，买点家具啊，修个游泳池啊（想多了），养点花花草草猫猫狗狗之类的。租的房子，能住人绝对不养狗，能叫外面绝对不下厨。不能比啊不能比，这是个态度问题。</p>
<h1 id="准备阶段">准备阶段</h1><p>废话说了这么多，还是尽快切入主题。说到个人建站，网上教程一堆一堆的，我自然也不会自己一个一个地去摸索。我主要参考的文章是Mac君的《趣谈个人建站》：<a href="\" title="\">http://macshuo.com/?p=547</a>。Mac君使用的是godaddy+ubuntu+linode。而我的不一样的点是我在国内买的域名：阿里云万网：<a href="\" title="\">http://www.net.cn/</a>。下面的内容大部分都来自Mac君的博文《趣谈个人建站》：<a href="\" title="\">http://macshuo.com/?p=547</a>。</p>
<p>重复造轮子的行为是不被大家认可的，但我这里还是要重复造轮子，原因如下：1.本人的部分步骤和原文不太一样，直接说哪里哪里不一样，会有点麻烦。 2.原文中有些没有涉及到的东西，我会在这里讲清楚，因为我跟着他的步骤走的时候，有时候会掉到坑里，爬很久才出来。 3.各位想建站的同学可以直接跟着本文的教程就可以建好，不必再切来切去。里面红色的部分是我的注释，是我遇到的问题和解决办法，希望大家别再入黑胡同。</p>
<p>搭建个人站点，大致需要做这么几件事情：</p>
<ul>
<li>一台具备公网IP的服务器</li>
<li>安装操作系统，搭建环境</li>
<li>购买域名，域名绑定IP</li>
<li>部署应用程序</li>
</ul>
<p>基本上这四套组合拳打完，你的个人网站就算建起来了，后续的事情就是添砖加瓦和蓬荜生辉了。</p>
<a id="more"></a>
<p>好把我们依次介绍：</p>
<h1 id="服务器">服务器</h1><p>大部分公司都会有自己的服务器和公网IP，要么托管要么自建机房。但对于个人用户来说，就没必要费时费力做这个事情了，购买一个VPS（Virtual Private Server）即可。什么是VPS，建议大家去维基百科上查一下，简单来说就是你会拥有一台虚拟主机，除了看不见机箱之外，你可以像操作一台实体服务器那样操作它，独立操作系统和硬盘空间、独立内存和CPU资源、独立的执行程序和系统配置等，可以自己安装操作系统和软件，独立重启等等。</p>
<p>在VPS的选择上，我用的是Linode。Linode是一家来自于米帝的专注于提供 Linux VPS 的服务提供商， 虚拟化技术采用了Xen，Linode的含义是Linux Node。注意，这里的操作系统是Linux，我推荐所有个人建站都采用Linux，不解释，如果你想采用Windows Server，后面的内容就不用看了。</p>
<p>Linode在国内外口碑都不错，价格适中，质量可靠，童叟无欺。Linode提供了各种Linux操作系统供选择，比如Ubuntu、Redhat、Debian、CentOS等等，装系统和重装系统都非常简单。</p>
<p>好，我们下面简单说一下步骤，访问<a href="\" title="\">https://manager.linode.com/session/signup</a><br>填写邮箱、用户名密码，就算注册成功了，Linode会给你发封邮件确认，打开那个确认链接，剩下的大家都会。</p>
<p>Linode通过它的ticket system（一套支持系统）提供7 x 24 x 365的支持服务，看清楚，不是7 x 24 x 365的不停机服务，我现在特别烦一些企业客户，一谈就说永不宕机，特么除了上帝谁能保证永不宕机？时间长了自个都得宕！另外Linode还提供了4小时的免费试用服务，比较厚道，如果你试试觉得不爽还可以选择不玩。</p>
<p>选择继续，就可以选机房了，Linode目前提供了东京和欧美等地的机房选择，我选了东京机房，据说是针对亚太地区用户的需求新开辟的，速度很快。然后选操作系统，设置硬盘大小、root密码等，点击「Rebuild」，你就进入了VPS的控制台，等Host Job Queue的所有任务都是绿色的Success，就可以点击「Boot」，启动系统。然后找到Remote Access这个标签，点进去就可以找到这台服务器的访问IP，打开终端，输入ssh root@x.x.x.x，就可以登录系统了，看到了吧，very simple！<span style="\"color:" #ff6600;\"="">（现在Linode已经不提供免费试用服务了，你只能先付款，然后才能使用。不过可以七天内退款）</span></p>
<p>试用之后，如果你觉得可以，点击Account标签，完善自己的信息，选择服务器配置，支付信息，然后就可以完整支付流程了。</p>
<p>我选的是Linode 1024套餐（24 GB DISK, 2000 GB），按照年付费的话230刀左右，大家这两天赞助的碎银子，差不过够一年年费了：）支付方式包括Visa，MasterCard，American Express，只有要信用卡还是很方便的。</p>
<p>另外需要注意的一点是，拿到了IP之后，一定要在不翻##墙的情况下测试一下是否可以正常访问。我就遇到这个问题了，在国内没法访问，但是挂了VPN的就可以，我估计是哪个倒霉孩子以前用过，被墙之后不用了。</p>
<p>不得已我发起了一个Ticket（支持问题），说我在中国大陆不能访问这个IP，但通过VPN可以，那哥们响应倒是挺快，但显然不懂我朝行情，让我执行mtr –r x.x.x.x，mtr可以结合ping、nslookup、tracert诊断网络传输问题。我只得把数据返给他，结果人家还要其他数据，我就不耐烦了，用蹩脚的英文给丫解释了一下什么是伟大的墙，基本意思就是少特么废话，赶紧给我换个IP。那哥们看我气势挺盛，赶紧给我换了个IP，我一试没问题了，说了声三克油，他说威尔卡姆，这事算结了。两人共交手五个回合，用时2小时，效率还可以。</p>
<p>好，服务器部分就介绍到这里。以下是我的linode推荐码，如果大家要购买Linode服务，可以用这个链接。</p>
<p><a href="\">http://www.linode.com/?r=6bd100da844d8d2c191680a4792610467ce9052</a></p>
<p><span style="\"color:" #ff6600;\"="">（上面的是Mac君的推荐码，我的推荐码是: a96df99ce34b5e0f76695558608c87fb2db5cc03。推荐链接是：<a href="https://www.linode.com/?r=a96df99ce34b5e0f76695558608c87fb2db5cc03" target="_blank" rel="external">https://www.linode.com/?r=a96df99ce34b5e0f76695558608c87fb2db5cc03</a></span>）</p>
<hr>
<h1 id="搭建环境">搭建环境</h1><blockquote>
<p>我选用的服务器是Ubuntu12.04，64位。以下内容均基于该环境描述。</p>
</blockquote>
<p>拿到了主机IP，你就算拿到了新房的钥匙，但是离入住还远着呢，因为你那个主机现在就是个毛坯房，除了进去看看，什么都不能干。好，下面我们做一下简装修。</p>
<p>1、创建用户</p>
<p>第一次登录需要root用户，什么是root？root就是整个Linux操作系统最牛逼的主，他想干嘛就干嘛，他想删谁就删谁，他是光他是电他是唯一的神话，他就是我朝就是我D，所以非常危险，你们懂的。如果用root执行一下rm -rf，那整个锡安就会被抹掉，尼奥也拯救不了，如果root愿意，他可以抹掉你曾经存在过的所有痕迹。所以，我们不能没事就用root进去耍，为了解决这个问题，我们必须要建立一个agent，平时是普通用户，关键时刻充当root的角色。</p>
<p>具体操作如下：</p>
<p>首先用root登录系统</p>
<pre><code>ssh root@x.x.x.x`&lt;/pre&gt;

创建一个新用户，用户名随你喜欢，比如叫做mactalk

&lt;pre&gt;`adduser mactalk`&lt;/pre&gt;

按照提示信息输入密码和相关信息，就可以完成操作。完成之后系统就会自动建立/home/mactalk路径。

然后是授权，输入

&lt;pre&gt;`visudo`&lt;/pre&gt;

在编辑器中找到如下内容：

&lt;pre&gt;`root    ALL=(ALL:ALL) ALL`&lt;/pre&gt;

在下面加一行

&lt;pre&gt;`mactalk    ALL=(ALL:ALL) ALL`&lt;/pre&gt;

通过ctrl+x保存退出即可。然后就可以退出root，用mactalk重新登录（ssh mactalk@x.x.x.x），登录进来默认目录在/home/mactalk下，当你想行使root权限时，请在命令之前增加sudo，按照系统提示输入密码即可执行操作。

2、选择<span class="keyword">shell</span>

用户建好了，下面我们为用户选择一种<span class="keyword">shell</span>，估计小白看到这个又毛了，啥是<span class="keyword">shell</span>？

<span class="keyword">shell</span>就是Linux的一个外壳，你理解成衣服也行。它负责外界与Linux内核的交互，接收用户或其他应用程序的命令，然后把这些命令转化成内核能理解的语言，传给内核，内核是真正干活的，干完之后再把结果返回用户或应用程序。比如你对<span class="keyword">shell</span>说，「你好」，<span class="keyword">shell</span>就跑到内核那说，「老大，有人问候你呢」，内核就不耐烦的说，「有事说事，我特么忙着呢」，<span class="keyword">shell</span>就把这条信息反馈给你，大致就是这样。以前讲<span class="keyword">Mac</span>技巧的时候，经常跟大家说在终端里输入一些命令，那就是<span class="keyword">Mac</span>的<span class="keyword">shell</span>，都是一脉相承的。

Linux提供了很多种<span class="keyword">Shell</span>，你要问我为什么要有这么多，我只能告诉你，你为毛同类型的衣服有那么多件？花色，质地还不一样。写程序比买衣服复杂多了，而且程序员是不惮于把事情搞复杂的，牛程序员看到不爽的<span class="keyword">shell</span>，就会自己重新写一套，慢慢形成了一些标准，常用的<span class="keyword">shell</span>有这么几种，<span class="keyword">sh</span>、bash、csh、zsh等，想知道你的系统有几种<span class="keyword">shell</span>，可以通过以下命令查看：

&lt;pre&gt;`<span class="keyword">cat</span> /etc/shells`&lt;/pre&gt;

这些<span class="keyword">shell</span>我就不解释了，维基百科和百度百科都写的很清楚，总之，坊间流传，普通程序员用bash，文艺程序员用zsh，XX程序员直接用原生的<span class="keyword">sh</span>，我建议大家文艺一点，用zsh好一些，功能也最强大。目前各个版本的Linux默认的<span class="keyword">shell</span>都是bash，如果你想用zsh，需要安装一下，如下：

&lt;pre&gt;`sudo apt-get install zsh`&lt;/pre&gt;

具体的配置我就不介绍了，感兴趣的读者，可以参考

[http:<span class="comment">//leeiio.me/bash-to-zsh-for-mac/](\)</span>

3、通用工具

介绍几个简单的工具，建站必备。
</code></pre><ul>
<li>wget，命令行下载工具，安装<code>sudo apt-get install wget</code>，使用方式后面会介绍。</li>
<li>tmux，一个优秀的终端复用软件，类似GNU Screen，但来自于OpenBSD，采用BSD授权。使用它最直观的好处就是，通过一个终端登录远程主机并运行tmux后，在其中可以开启多个控制台而无需再「浪费」多余的终端来连接这台远程主机。好吧，这句话有点绕，简单说就是用tmux打开的会话可以一直驻留在服务器上，下次去看时还是上次来的样子。就像你是某个酒店的VIP客户，住完之后不会人走茶凉，也不会断电，下次去时茶还热着，灯也亮着，就这样。安装方式<code>sudo apt-get install tmux</code>，对使用方式感兴趣的读者去查一下吧，中文介绍很多，记住，热键是ctrl+b。</li>
<li><p>vim，在Linux上少不了编辑文件，我推荐Vim和Emacs，一个是编辑器之神，一个是神的编辑器（或者是伪装成操作系统的编辑器），我是Vim党，目前在学习Emacs。我之前写过一个Vim系列，有兴趣的可以去看：<a href="\">http://www.cnblogs.com/chijianqiang/tag/vim/</a>从原理到配置、使用都有非常详细的介绍，那也是个大坑，还没写完，但写了MacTalk就变成顾此坑失彼坑了。</p>
<p>差不多就这几个，其他的工具随用随装吧。</p>
<p><span style="\"color:" #ff6600;\"="">（上面基本照着做就可以了，记住你的用户名，别乱起就可以了。ssh不懂的自己去脑补，至于Vim这个东西，如果以前没有接触过，那google一下基本用法也是很有必要的。酷壳博主的这篇《简明Vim练级攻略》给大家推荐一下：<a href="http://coolshell.cn/articles/5426.html）" target="_blank" rel="external">http://coolshell.cn/articles/5426.html）</a></span></p>
<hr>
<h1 id="域名和DNS">域名和DNS</h1><p>服务器和环境构建都写完了，今天介绍一下域名和DNS的那点事儿，稍微复杂一点的软件部分放在最后说。</p>
<p>域名是什么东西呢？就是一个网站的标识和入口，由「.」分隔开的字符串构成，洋名叫Domain Name，比如苹果公司网站的域名就是<a href="\" title="\">apple.com</a>，在浏览器地址栏输入这个域名，就可以访问苹果的网站了。为什么要有域名呢，有了公网IP，不就可以访问网站了么？</p>
<p>咳，这么说吧，如果有人说找个地方聚聚，你说，咱们经度116.46、纬度39.92，不见不散！地方倒是对，但是估计实名菜刀和无名臭鞋就飞过来了。IP地址就是你的服务器在互联网世界的经纬度，域名就是对应IP的门牌号码，就像人们能记住门牌号记不住经纬度一样，在网络世界里，大家都是记域名的。与现实世界不同的是，门牌号和实际地址正常情况都是一对一的，而域名和IP地址是多对一的，也就是说，只要你有一个公网IP，就可以申请多个域名，对应多个应用，非常方便。</p>
<p>现在你知道了吧，要建站，必须要有域名。能够提供域名的厂商很多，国内外都有。不过我强烈推荐大家购买国外厂商的域名，免去提交材料和备案之苦，国外动动鼠标和小手分分钟搞定的事情，国内要提交各种材料、备案、定期监管balabala……具体差异大家看看<a href="\" title="\">www.apple.com.cn</a>和<a href="\">www.apple.com</a>两个网站的底部知道了，苹果中国的底部有「京公安网安备 11010500896|京ICP备10214630」，再看看米帝的网站，毛都没有，都是自己的网站信息，我们只能说，米帝的监管制度太不健全了，真为他们捉鸡！</p>
<p>国外的域名厂商推荐<a href="\">www.godaddy.com</a>和<a href="\">www.name.com</a>，都不错。我使用的是<a href="\">Godaddy</a>。</p>
<p>Godaddy是全球最大的域名注册服务商，全球市场占有率超过30%，一般情况下不会被我朝屏蔽。如果屏蔽了Godaddy，会导致在大陆无法访问全球近三分之一的网站，所以相对安全，相对，你懂的。另外Godaddy开始支持支付宝了，对我朝臣民来说付费变得方便无比。</p>
<p>在域名选择上，最好满足这几点要求：有意义、好记、简短，另外尽可能使用com（通用顶级域名）。申请步骤也很简单，访问<a href="\">www.godaddy.com</a>，在搜索框输入你想要购买的域名，点击搜索，你会看到这个域名的具体信息，是否被使用，相关域名，价格等信息，域名后缀一般有com、net、me、us、info等，建议选com，不建议选info，据说info结尾的网站大部分是垃圾网站，会被搜索引擎屏蔽。</p>
<p>选好域名后，点Add，加入购物车，如果不需要其他服务，一路Continue即可，最后设置支付信息，支付宝在最后一列，然后「Place Your Order」，根据提示注册和支付即可。价格与域名信息相关，一般几美元到10几美元不等。</p>
<p>购买完成之后，进入Godaddy的域名管理控制台，找到你购买的域名，把域名和你的IP地址绑定起来，就可以通过域名访问你的网站了。这里就涉及到DNS了。</p>
<p>DNS的洋名一般说成Domain Name System，就是给域名提供服务的。光有域名没用，还得有相关的服务能够把域名解析成IP地址才行，DNS就干这事。DNS的扩展性非常好，不依靠单一的巨型主机索引，而是通过分布式系统提供服务，全球能够提供DNS服务的服务器多如牛毛数不胜数，但大哥级别的根服务只有13台，目前的分布是：主根服务器美国1个，设置在弗吉尼亚州的杜勒斯；辅根服务器美国9个，瑞典、荷兰、日本各1个，旗下是各个级别的域名服务器。</p>
<p>DNS的工作方式挺复杂，有兴趣的直接去Google吧，我简单描述一下，大致的场景是这样的，比如小明是个DNS服务器，有一天你想访问<a href="\" title="\">macshuo.com</a>，就问，「小明啊，我想去听听MacTalk，怎么走呢？」，作为忠诚的DNS战士，小明的服务态度是值得赞赏的，如果他知道的话，就会立刻告诉你地址，比如从这个街区左转左转左转再左转balabala……如果丫不知道也没关系，他会反馈给上级主管，说「最近有人新建了个MacTalk网站，我这还没记录地址，你晓得不？」，上级部门如果知道就会把地址发给小明，说「你丫长点记性，把这地址记下来行不？别特么老问了，最近自媒体网站可真多啊，哎……」，这样小明就会把地址告诉你，并且用心的把这个地址记到自己的小本本上，下次有人再问，就直接告诉人家答案了。如果上级部门也不知道，那就继续问，直到反馈到根服务器为止，反正只要你注册了，总能找到。差不多就这样吧。</p>
<p>Godaddy默认提供了DNS服务，点击DNS Manager，在弹出的设置面板中设置你的网站IP即可，具体的图文教程网络上很多，我就不费那事了。但是我的使用结果是，Godaddy提供的DNS在国内访问不太稳定，时不时就不能访问了，具体为啥我也不清楚。因为购买了Linode服务，我最后采用了Linode的DNS，具体的做法是：</p>
</li>
</ul>
<ol>
<li>登录<a href="\" title="\">linode.com</a>，点击DNS Manager标签，进入管理控制台</li>
<li>选择Add a domain zone</li>
<li>填写域名、邮件地址和IP</li>
<li><p>点击Add a Master Zone，就算完成了</p>
<p>最后一步就是在Godaddy的控制台里设置一下Linode的DNS服务器，很简单就不描述了。</p>
<p><span style="\"color:" #ff6600;\"="">（Mac君在Godaddy买的域名，Godaddy买的域名货真价实，童叟无欺，但我当时贪图便宜，在万网买了个域名，价格大家可以自己去两个网站对比一下，万网的性价比要高一些。在Linode中设置好域名后，需要到万网那里设置一下DNS，我是设置的Linode提供的DNS（在linode的控制台里面可以看到），将此DNS复制到万网管理台的DNS设置里面即可）</span></p>
<hr>
<h1 id="应用程序和部署">应用程序和部署</h1><p>经过前面三篇系列文章的介绍之后，我们现在房子也有了，做了简装修，还申请了地址和门牌号，最后一步就是入住，也就是部署你的应用程序。</p>
<p>针对网站提供的服务不同，需要不同的技术选型，我的需求就是做个风格简约的博客，用来存放MacTalk的文章，同时有个地方能够随意发表一些个人观点，就这么简单，所以针对这个需求进行选择即可。大家将来建站的时候也是一样，明确自己的需求，不要为未来买单，尽量搞的轻量级一些，最忌讳给的是龙套的钱，您自个却按照男猪脚进行角色扮演，不提倡。</p>
<p>搭建轻量级的博客不建议使用.Net或JavaEE的技术，这些技术都比较重，必要性不大。Php、Python、Ruby相关的框架都是可选的技术。因为我对Python相对熟悉一些，最初想找个开源的Python Blog框架，不过后来综合对比了一下，发现在个人博客领域，WordPress基本上无出其右，技术成熟、安装方便、性能稳定、插件众多，实在是居家建站、个人扯淡之必备良药，就是它了。</p>
<p>在确定了基本需求和工具之后，我们看看涉及到哪些技术：</p>
<p>1、Nginx Nginx是一款高性能的HTTP服务器软件，由俄罗斯的一位大牛Igor Sysoev开发的，源代码以类BSD许可证的形式发布。Nginx的设计非常轻量级，由内核和模块组成，内核微小简洁，模块功能强大，静态编译。Nginx做的事情简单来说就是，接收客户端（浏览器）的HTTP请求，然后通过映射机制把不同类型的请求交给不同的模块去处理，比如html、图片、css等可以交给静态资源模块处理，还可以做压缩、缓存等，php、python等类型的请求则交给FastCGI模块去处理，完成业务逻辑。</p>
<p>什么是FastCGI呢？这玩意就等于是HTTP服务器和动态脚本语言通信的接口，就像一个粘合剂一样把HTTP请求和动态脚本处理整合在一起，顾名思义，处理速度非常Fast！</p>
<p>Nginx可以说是HTTP服务器软件市场的新贵，目前国内很多大型网站都采用了Nginx作为默认的web服务器，比如阿里、腾讯、新浪等等，国外就更多了。当然，在Nginx未涉足江湖之前，这个领域的大哥叫做Apache，那时候几乎所有的HTTP Server都是清一色的Apache，一时之间风头无两。但是这哥们大哥做久了就不思进取，跟国内很多大佬一个德性，没竞争对手时就特么不知道改进，直到Nginx出来抢了丫半壁江山，现在知道努力了，当初干嘛去了？</p>
<p>那么Nginx比Apache优秀在哪呢？</p>
</li>
</ol>
<ul>
<li>Nginx的所有模块都是全静态编译的，启动Nginx后，Nginx的模块被自动加载，静态库执行效率更高。</li>
<li>Nginx支持epoll（Linux系列）和kqueue（BSD系列）I/O事件通知机制。完，又特么出现两个名词！这让人情何以堪、文何以完啊？简单说说epoll吧。epoll是Linux2.6正式引入的提高网络I/O的处理方法，它的几个优点是：单一进程打开的FD（文件描述符）数量仅受限于操作系统，1GB内存的机器上大约是10万左右，这一点大大提升了处理海量请求的能力；采用共享内存的模式避免内存拷贝；随着打开FD的数量增加，I/O效率不会线性下降。总之，大家知道epoll很牛逼就是了。</li>
<li><p>Nginx支持多进程的工作方式，Nginx启动后会有一个master进程，多个worker进程。worker进程一般对应服务器的CPU数量，你有个8核的CPU，最好把worker设置为8。master负责接收外界信号，并向worker发送信号，监控worker的运行状况，当worker挂掉的时候，启动新的worker。写到这我发现，这特么活脱脱就是一个地主老财打压长工的模式啊！<br>尤其是Nginx的不中断重启机制，当系统配置变化需要重新启动Nginx时，我们就给地主（master）发个消息，说这批长工（worker）太老了，都得换掉，你看着办。地主收到消息后就开始偷偷雇佣新的长工（worker），然后假惺惺的告诉老长工，把手头的活干完就行了，别太累了，啊。这时候如果有新的请求，就会交给新长工干，等所有的老长工把活都干完了，就直接fire，绝不留情。这样，整个服务无中断重启过程就完成了，就特么一个字，黑！<br>当然长工（worker）也不是省油的等，他们干活的过程非常复杂，会用到我们上文中提到的epoll机制，如果有人感兴趣，以后再讲吧，这么写下去这个系列就没完了。</p>
<p>Nginx功能非常强大，一本书也写不完，我简单就说这么几句。老话，有兴趣的，用Google百度一下！</p>
<p>大概了解了Nginx的工作机制，下面安装就比较简单了，Nginx可以编译安装，也可以在线安装，对于普通用户来说，使用apt-get在线安装即可，省得自己去找依赖关系。</p>
<pre>`#安装
sudo apt-get install nginx
#启动
sudo service nginx start`</pre>

<p>如果安装和启动都没有问题，我们再调整几个参数就可以了。</p>
<p>找到/etc/nginx/nginx.conf，做以下几个改动：</p>
</li>
<li><p>把worker_processes设置为服务器的CPU核数</p>
</li>
<li>在event里增加use epoll</li>
<li><p>把worker_connections的值设置大一点，如果是1G内存，不要大于100000/worker_processes。</p>
<p>其他的采用默认值即可，然后重新加载参数：</p>
<pre>`sudo nginx -s reload`</pre>

<p>好，Nginx就算妥了，后续在安装PHP和WordPress时还要做一些配置。</p>
<blockquote>
<p>我有时候觉得，当我们在计算机领域遇到问题的时候，总会出现一些技术神山上的神人，他们时不时会俯视一下凡人的IT世界，高兴了就顺手解决几个bug，发明几个新玩意，epoll和Nginx就是这些玩意，我们用好就已经心满意足袅。</p>
</blockquote>
<p>2、MySQL</p>
<p>MySQL是应用最为广泛的开源数据库，这个没什么可说的，非常成熟的技术，直接安装即可：</p>
<pre>`sudo apt-get install mysql-server`</pre>

<p>安装过程中，MySQL会提示你设置root密码（root的作用参考之前介绍的，把操作系统换成数据库即可）。如果安装时没设置密码，等MySQL起来后用mysqladmin改也行，用sql改也行，简单不啰嗦。</p>
<p><span style="\"color:" #ff6600;\"="">(注：这里Mac君没有说sql的基本操作，我这里简单说一下。安装好mySql之后，执行 ：</span></p>
<p><span style="\"color:" #ff6600;\"="">mysql -u root -p+你安装时的密码     </span></p>
<p><span style="\"color:" #ff6600;\"=""> -p和密码之间没有分隔符。进入后 ,就是MySql的基本操作，记得每一条命令以；结尾</span></p>
<p><span style="\"color:" #ff6600;\"="">1、 显示数据库：show databases;</span></p>
<p><span style="\"color:" #ff6600;\"="">2、 建数据库：create database  [if not exists] 数据库名;</span><br><span style="\"color:" #ff6600;\"="">3、 建数据表： create table [if not exists] 表名 (字段名1   类型。。。。。。。。)</span><br><span style="\"color:" #ff6600;\"="">create table student (编号 int auto_increment primary key, 姓名 varchar(10));</span><br><span style="\"color:" #ff6600;\"="">注意:设置了自动增长,就要定为主键,如果选择了BIT 类型,0不显示,非0显示为一个特殊符号!</span><br><span style="\"color:" #ff6600;\"="">4、 显示数据表:show tables;</span><br><span style="\"color:" #ff6600;\"="">5、 删除库: drop database [if exists] 库名; </span><br><span style="\"color:" #ff6600;\"="">6、 删除表: drop table   [if exists] 表名;</span><br><span style="\"color:" #ff6600;\"="">7、 显示表结构: desc 表名</span><br><span style="\"color:" #ff6600;\"="">8、 如何修改表结构:增长一个字段; alter table 表名 add 字段名  类型</span><br><span style="\"color:" #ff6600;\"="">9、 删除一个字段: alter table  表名 drop 字段名</span><br><span style="\"color:" #ff6600;\"="">10、修改一个字段的属性:  alter table 表名modify 字段 新属性</span><br><span style="\"color:" #ff6600;\"="">11、修改主键: 增加一个主键  alter table 表名 add primary key(字段名)</span><br><span style="\"color:" #ff6600;\"="">12、删除一个主键  alter table 表名  drop primary key(字段名)</span></p>
<p><span style="\"color:" #ff6600;\"="">之后还要修改一下字符集，可以参照这里：<a href="\" title="\">http://database.51cto.com/art/201010/229167.htm</a>)</span></p>
<p>3、PHP</p>
<p>WordPresss是基于PHP开发的，所以我们得为WordPress准备好环境，安装PHP。</p>
<pre>`sudo apt-get install php5
sudo apt-get install php5-fpm`</pre>

<p>php5-fpm是PHP FastCGI的实现之一，能够更好的管理PHP进程，控制内存使用，平滑重载等，现在我们都用它！</p>
<p>下面做一点简单配置，打开php.ini文件：</p>
<pre>`sudo vim /etc/php5/fpm/php.ini`</pre>

<p>找到cgi.fix_pathinfo=1这一行，把1改为0。 值为1时，php的解释器会尽可能的去解析客户端请求的文件各种类型，这会引发一些安全漏洞，设置为0时，解释器只会去解析特定的文件类型，设置为0是一种相对安全的处理策略。</p>
<p>修改www.conf：</p>
<pre>`sudo vim /etc/php5/fpm/pool.d/www.conf`</pre>

<p>把 <code>listen = 127.0.0.1:9000</code> 修改为 <code>listen = /var/run/php5-fpm.sock</code>，前者是走TCP socket，后者是Unix domain socket，如果服务都在同一台机器上，建议使用后者，效率更好一些。</p>
<p>重新启动PHP，这部分的配置就算完成了：</p>
<pre>`sudo service php5-fpm restart`</pre>

<p>4、WordPress</p>
<p>好的，我们从后场断球后左冲右突，盘过对方和我方的所有进攻和防守队员，来到球门前面，发现就差最后一关：WordPress。下面我们看看如何安装和配置WordPress。</p>
<p>首先下载WordPress的最新版本，我用了中文版，下载和解压缩：</p>
<pre>`wget http://cn.wordpress.org/wordpress-3.5.1-zh_CN.tar.gz
tar -xzvf wordpress-3.5.1-zh_CN.tar.gz 

<span style="\"font-family:" georgia,="" \'times="" new="" roman\',="" \'bitstream="" charter\',="" times,="" serif;="" font-size:="" 14px;="" line-height:="" 1.5em;="" color:="" #ff6600;\"="">（注：这里Mac君用的3.5.1，现在3.8.1为最新版本，建议用最新版本即可
</span>`
<span style="\"color:" #ff6600;\"="">`wget http://cn.wordpress.org/wordpress-3.8.1-zh_CN.tar.gz
tar -xzvf wordpress-3.8.1-zh_CN.tar.gz `</span>
`<span style="\"font-family:" georgia,="" \'times="" new="" roman\',="" \'bitstream="" charter\',="" times,="" serif;="" font-size:="" 14px;="" line-height:="" 1.5em;\"=""><span style="\"color:" #ff6600;\"="">）</span>
在MySQL中为WordPress创建用户和数据库，这部分很简单就不描述了。我们设定数据库为wordpress，用户名为mactalk，并且把数据库编码改为UTF-8。</span>`</pre>

<p>在解压好的wordpress文件夹下，执行：</p>
<pre>`cp wp-config-sample.php wp-config.php
vim ~/wordpress/wp-config.php`</pre>

<p>按照文件内容注释填写数据库名称、用户名、密码、数据库编码使用UTF-8，然后保存退出。</p>
<p>为wordpress创建www文件夹，并且把完整的wordpress目录复制到www文件夹下，并设置相关权限：</p>
<pre>`sudo mkdir -p /var/www

sudo cp -r ~/wordpress/* /var/www

cd /var/www/

sudo chown www-data:www-data * -R 

sudo usermod -a -G www-data username   <span style="\"color:" #ff6600;\"="">（注：这里的username就是你当前登录的用户名）</span>`</pre>

<p>安装php的MySQL驱动</p>
<pre>`sudo apt-get install php5-mysql`</pre>

<p>设置虚拟主机：</p>
<p>在/etc/nginx/sites-available下创建文件wordpress</p>
<pre>`sudo vim wordpress`</pre>

<p>内容如下：</p>
<pre>`server {
    listen   80;

    root /var/www;
    index index.php index.html index.htm;

    #根据 IP 或域名自定义 <span style="\"color:" #ff6600;\"=""> （注：这里只需要修改后面的3.3.3.3\. 改成你的ip或者域名都可以）
</span>    server_name 3.3.3.3;

    location / {
        try_files $uri $uri/ /index.php?q=$uri&amp;$args;
    }

    error_page 404 /404.html;

    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
          root /usr/share/nginx/www;
    }

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9$
    location ~ .php$ {
        #fastcgi_pass 127.0.0.1:9000;
        # With php5-fpm:
        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
    }
}`</pre>

<p>这个文件的作用就是把Nginx和WordPress粘合在一起，接收客户端的请求并反馈响应结果。有几点要注意的是，root设置为/var/www/，index部分增加index.php，fastcgi_pass对应之前设置的unix socket：unix:/var/run/php5-fpm.sock。<span style="\"color:" #ff6600;\"="">（注：这段话只是说明一下上面的文件有什么改动，并不需要自己去操作，特别注意最后要删除default文件，不然在重启nginz时会报一个80端口已经被其他server占用的错误。）</span></p>
<p>为wordpress文件建立软连接：</p>
<pre>`sudo ln -s /etc/nginx/sites-available/wordpress /etc/nginx/sites-enabled/wordpress`</pre>

<p>最后重新启动nginx和php5-fpm，就算大功告成了：</p>
<p><pre>`sudo service nginx restartsudo<br>service php5-fpm restart</pre></p>
</li>
</ul>
<p>如果一切正常的话，访问你的域名或者公网IP，就可以看到wordpress的提示页面，根据信息提示初始化数据库，创建管理员，基本框架就算建好了，之后就是完善和优化，比如性能优化、主题选择、配置信息、插件选择、扩展开发等等，大家慢慢体会吧。<span style="\"line-height:" 1.5em;\"=""> </span></p>
<p>下面是本人配置好wordpress之后的画面：一段很有趣的话，开始你的博客之旅把。</p>
<p><a href="\"><img src="\" alt="\"></a></p>
<p>之后会有一个系列，来讲wordpress使用过程中遇到的问题和心得。有问题欢迎留言交流。</p>
<blockquote>
<p><span style="\"color:" #ff0000;\"="">作者：<a href="\" title="\">Gracker</a></span><br><span style="\"color:" #ff0000;\"="">出处：<a href="\" title="\">androidperformance.com</a></span><br><span style="\"color:" #ff0000;\"="">本文版权归作者所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。</span><br><span style="\"color:" #ff0000;\"="">打赏一下： <a href="\">微博打赏</a></span></p>
</blockquote>

        
      </div>
    

    
      <div class="post-footer">
        

        
          <div class="post-nav">
            <div class="post-nav-prev post-nav-item">
              
                <a href="../../../03/01/life-and-college-about-gracker/">大学 毕业 工作</a>
              
            </div>

            <div class="post-nav-next post-nav-item">
              
                <a href="../../24/hello-gracker-blog-was-build/">Gracker的个人博客开通了！</a>
              
            </div>
          </div>
        

        
        
      </div>
    
  </div>



  
    <div class="comments" id="comments">
      
        <div class="ds-thread" data-thread-key="2014/02/26/build-your-own-blog-by-wordpress/"
             data-title="使用Wordpress建立个人独立博客" data-url="http://androidperformance.com/2014/02/26/build-your-own-blog-by-wordpress/">
        </div>

      
    </div>
  

          </div>

          
        </div>

        
<div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>

<div id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
          文章目录
        </li>
        <li class="sidebar-nav-overview" data-target="site-overview">
          站点概览
        </li>
      </ul>
    

    <div class="site-overview">
      <div class="site-author motion-element">
        <img class="site-author-image" src="../../../../images/default_avatar.jpg" alt="Gracker" />
        <p class="site-author-name">Gracker</p>
      </div>
      <p class="site-description motion-element"></p>
      <div class="site-state motion-element">
        <div class="site-state-item site-state-posts">
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </div>
        <div class="site-state-item site-state-tags">
            <span class="site-state-item-count">0</span>
            <span class="site-state-item-name">标签</span>
        </div>
        <div class="site-state-item site-state-pages">
            <span class="site-state-item-count">3</span>
            <span class="site-state-item-name">页面</span>
        </div>
      </div>

      
        <div class="feed-link motion-element">
          <a href="../../../../atom.xml">
            <i class="menu-item-icon icon-feed"></i>
            RSS
          </a>
        </div>
      

      <div class="links-of-author motion-element">
        
          
            <span class="links-of-author-item">
              <a href="https://github.com/Gracker">github</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="http://weibo.com/270099576">weibo</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="http://www.jianshu.com/users/FK4sc4/latest_articles">jianshu</a>
            </span>
          
            <span class="links-of-author-item">
              <a href="http://www.zhihu.com/people/gracker">zhihu</a>
            </span>
          
        
      </div>

      
      

    </div>

    
      <div class="post-toc-wrap sidebar-panel-active">
        <div class="post-toc-indicator-top post-toc-indicator"></div>
        <div class="post-toc">
          
          
            <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#个人吐槽阶段"><span class="nav-number">1.</span> <span class="nav-text">个人吐槽阶段</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#准备阶段"><span class="nav-number">2.</span> <span class="nav-text">准备阶段</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#服务器"><span class="nav-number">3.</span> <span class="nav-text">服务器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#搭建环境"><span class="nav-number">4.</span> <span class="nav-text">搭建环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#域名和DNS"><span class="nav-number">5.</span> <span class="nav-text">域名和DNS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#应用程序和部署"><span class="nav-number">6.</span> <span class="nav-text">应用程序和部署</span></a></li></ol></div>
          
        </div>
        <div class="post-toc-indicator-bottom post-toc-indicator"></div>
      </div>
    

  </div>
</div>


      </div>
    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2013 - 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Gracker</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="../../../../vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="../../../../vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".fancybox").fancybox();
    });
  </script>

  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="../../../../vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="../../../../vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    LogoAndMenuMotion();
    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});

    function LogoAndMenuMotion() {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        
        { e: $('.logo-line-before i'), p: { translateX: "100%" }, o: { duration: 500, sequenceQueue: false } },
        { e: $('.logo-line-after i'), p: { translateX: "-100%" }, o: { duration: 500, sequenceQueue: false } },
        
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200 } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    }


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = window.postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  
  
<script type="text/javascript" id="bootstrap.scrollspy.custom">
  /* ========================================================================
  * Bootstrap: scrollspy.js v3.3.2
  * http://getbootstrap.com/javascript/#scrollspy
  * ========================================================================
  * Copyright 2011-2015 Twitter, Inc.
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
  * ======================================================================== */

  /**
   * Custom by iissnan
   *
   * - Add a `clear.bs.scrollspy` event.
   * - Esacpe targets selector.
   */


  +function ($) {
    'use strict';

    // SCROLLSPY CLASS DEFINITION
    // ==========================

    function ScrollSpy(element, options) {
      this.$body          = $(document.body)
      this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)
      this.options        = $.extend({}, ScrollSpy.DEFAULTS, options)
      this.selector       = (this.options.target || '') + ' .nav li > a'
      this.offsets        = []
      this.targets        = []
      this.activeTarget   = null
      this.scrollHeight   = 0

      this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))
      this.refresh()
      this.process()
    }

    ScrollSpy.VERSION  = '3.3.2'

    ScrollSpy.DEFAULTS = {
      offset: 10
    }

    ScrollSpy.prototype.getScrollHeight = function () {
      return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }

    ScrollSpy.prototype.refresh = function () {
      var that          = this
      var offsetMethod  = 'offset'
      var offsetBase    = 0

      this.offsets      = []
      this.targets      = []
      this.scrollHeight = this.getScrollHeight()

      if (!$.isWindow(this.$scrollElement[0])) {
        offsetMethod = 'position'
        offsetBase   = this.$scrollElement.scrollTop()
      }

      this.$body
        .find(this.selector)
        .map(function () {
          var $el   = $(this)
          var href  = $el.data('target') || $el.attr('href')
          var $href = /^#./.test(href) && $(escapeSelector(href)) // Need to escape selector.

          return ($href
            && $href.length
            && $href.is(':visible')
            && [[$href[offsetMethod]().top + offsetBase, href]]) || null
        })
        .sort(function (a, b) { return a[0] - b[0] })
        .each(function () {
          that.offsets.push(this[0])
          that.targets.push(this[1])
        })


    }

    ScrollSpy.prototype.process = function () {
      var scrollTop    = this.$scrollElement.scrollTop() + this.options.offset
      var scrollHeight = this.getScrollHeight()
      var maxScroll    = this.options.offset + scrollHeight - this.$scrollElement.height()
      var offsets      = this.offsets
      var targets      = this.targets
      var activeTarget = this.activeTarget
      var i

      if (this.scrollHeight != scrollHeight) {
        this.refresh()
      }

      if (scrollTop >= maxScroll) {
        return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
      }

      if (activeTarget && scrollTop < offsets[0]) {
        $(this.selector).trigger('clear.bs.scrollspy')  // Add a custom event.
        this.activeTarget = null
        return this.clear()
      }

      for (i = offsets.length; i--;) {
        activeTarget != targets[i]
          && scrollTop >= offsets[i]
          && (!offsets[i + 1] || scrollTop <= offsets[i + 1])
          && this.activate(targets[i])
      }
    }

    ScrollSpy.prototype.activate = function (target) {
      this.activeTarget = target

      this.clear()

      var selector = this.selector +
        '[data-target="' + target + '"],' +
        this.selector + '[href="' + target + '"]'

      var active = $(selector)
        .parents('li')
        .addClass('active')

      if (active.parent('.dropdown-menu').length) {
        active = active
          .closest('li.dropdown')
          .addClass('active')
      }

      active.trigger('activate.bs.scrollspy')
    }

    ScrollSpy.prototype.clear = function () {
      $(this.selector)
        .parentsUntil(this.options.target, '.active')
        .removeClass('active')
    }


    // SCROLLSPY PLUGIN DEFINITION
    // ===========================

    function Plugin(option) {
      return this.each(function () {
        var $this   = $(this)
        var data    = $this.data('bs.scrollspy')
        var options = typeof option == 'object' && option

        if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
        if (typeof option == 'string') data[option]()
      })
    }

    var old = $.fn.scrollspy

    $.fn.scrollspy             = Plugin
    $.fn.scrollspy.Constructor = ScrollSpy


    // SCROLLSPY NO CONFLICT
    // =====================

    $.fn.scrollspy.noConflict = function () {
      $.fn.scrollspy = old
      return this
    }


    // SCROLLSPY DATA-API
    // ==================

    $(window).on('load.bs.scrollspy.data-api', function () {
      $('[data-spy="scroll"]').each(function () {
        var $spy = $(this)
        Plugin.call($spy, $spy.data())
      })
    })

  }(jQuery);
</script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0 && isDesktop()) {
        setTimeout(function () {
          $('.sidebar-toggle').trigger('click');
        }, 800);
      }
    });
  </script>




  

  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"grackertalk"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
  
</body>
</html>
